<!DOCTYPE html>
<!-- saved from url=(0038)https://zhuanlan.zhihu.com/p/667521327 -->
<html lang="zh" data-hairline="true" class="itcauecng" data-theme="light" data-darkreader-mode="dynamic" data-darkreader-scheme="dark" data-darkreader-proxy-injected="true" data-rh="data-theme"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--text" media="screen"></style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble.gtx-bubble, .captcheck_answer_label > input + img, span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"], span[data-href^="https://www.hcaptcha.com/"] > #icon, ::-webkit-calendar-picker-indicator, img.Wirisformula {
    filter: invert(100%) hue-rotate(180deg) contrast(90%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}
[data-darkreader-inline-stopcolor] {
  stop-color: var(--darkreader-inline-stopcolor) !important;
}
[data-darkreader-inline-bg] {
  background: var(--darkreader-inline-bg) !important;
}
[data-darkreader-inline-invert] {
    filter: invert(100%) hue-rotate(180deg);
}</style><style class="darkreader darkreader--variables" media="screen">:root {
   --darkreader-neutral-background: #131516;
   --darkreader-neutral-text: #d8d4cf;
   --darkreader-selection-background: #004daa;
   --darkreader-selection-text: #e8e6e3;
}</style><style class="darkreader darkreader--root-vars" media="screen"></style><style class="darkreader darkreader--user-agent" media="screen">@layer {
html {
    background-color: #181a1b !important;
}
html {
    color-scheme: dark !important;
}
iframe {
    color-scheme: initial;
}
html, body {
    background-color: #181a1b;
}
html, body {
    border-color: #736b5e;
    color: #e8e6e3;
}
a {
    color: #3391ff;
}
table {
    border-color: #545b5e;
}
mark {
    color: #e8e6e3;
}
::placeholder {
    color: #b2aba1;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #404400 !important;
    color: #e8e6e3 !important;
}
::selection {
    background-color: #004daa !important;
    color: #e8e6e3 !important;
}
::-moz-selection {
    background-color: #004daa !important;
    color: #e8e6e3 !important;
}
}</style><title>cute 之 简单GEMM实现 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=10,chrome=1"><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"><meta data-rh="true" name="keywords" content="GPU 通用计算,高性能计算,人工智能"><meta data-rh="true" name="description" content="前面的文章我们对cute提供的核心数据结构和抽象进行了一系列的介绍，包括 Layout、Tensor、MMA和Copy。本文我们将利用这些概念和抽象实现一个简单版本的矩阵乘法。在介绍具体实现之前，我们首先介绍BLAS约定和深度…"><meta data-rh="true" property="og:title" content="cute 之 简单GEMM实现"><meta data-rh="true" property="og:url" content="https://zhuanlan.zhihu.com/p/667521327"><meta data-rh="true" property="og:description" content="前面的文章我们对cute提供的核心数据结构和抽象进行了一系列的介绍，包括 Layout、Tensor、MMA和Copy。本文我们将利用这些概念和抽象实现一个简单版本的矩阵乘法。在介绍具体实现之前，我们首先介绍BLAS约定和深度…"><meta data-rh="true" property="og:image" content="https://pic1.zhimg.com/v2-689e4c7afc578c580763b34c7bed1d02_720w.jpg?source=172ae18b"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="og:site_name" content="知乎专栏"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.81060cab.png"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.81060cab.png" sizes="152x152"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.d5793cac.png" sizes="120x120"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.7abf3393.png" sizes="76x76"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.362a8eac.png" sizes="60x60"><link crossorigin="" rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico"><link crossorigin="" rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/heifetz/search.xml" title="知乎"><link rel="dns-prefetch" href="https://static.zhimg.com/"><link rel="dns-prefetch" href="https://pica.zhimg.com/"><link rel="dns-prefetch" href="https://picx.zhimg.com/"><link rel="dns-prefetch" href="https://pic1.zhimg.com/"><link rel="dns-prefetch" href="https://pic2.zhimg.com/"><link rel="dns-prefetch" href="https://pic3.zhimg.com/"><link rel="dns-prefetch" href="https://pic4.zhimg.com/"><link rel="dns-prefetch" href="https://static.zhihu.com/"><style data-emotion-css="9mvwt1">:root{--zhc-padding-horizontal:20px;--zhc-padding-vertical:16px;--zhc-notification-top:75px;--app-padding:16px;--app-header-height:52px;--app-max-width:640px;--app-width:1000px;--app-font-size:15px;}</style><style class="darkreader darkreader--sync" media="screen"></style><script nonce="" data-web-reporter-config="{&quot;platform&quot;:&quot;web&quot;,&quot;project&quot;:&quot;heifetz&quot;}">!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).webReporter={})}(this,function(e){"use strict";var t={},n=!1,o=function(){var e,o,r,a,i;return n||(e=document.querySelector("script[data-web-reporter-config]"),o=e&&e.dataset.webReporterConfig||"{}",r=JSON.parse(o),a=r.platform,i=r.project,t={platform:a,project:i},n=!0),t};function r(e){return a(function(){return localStorage.getItem(e)})()}function a(e){return function(){try{return e.apply(void 0,arguments)}catch(e){}}}var i=a(function(e,t){var n={platform:"web",project:o().project,clientTimestamp:+new Date};!function(e,t,n){"1"===r("weber:logenabled")&&console.log("[web-reporter]%o",{type:e,base:t,data:n})}(e,n,t),function(e,t){var n=btoa(JSON.stringify(t));if("undefined"!=typeof Blob&&window.navigator&&window.navigator.sendBeacon){var o=new Blob([n],{type:"text/plain"});navigator.sendBeacon(e,o)}else{var r=new XMLHttpRequest;r.open("POST",e),r.withCredentials=!1,r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),r.send(n)}}(r("weber:api")||"https://apm.zhihu.com/collector/web_json",{type:e,base:n,data:t})});e.report=i,Object.defineProperty(e,"__esModule",{value:!0})});
</script><link href="./cute 之 简单GEMM实现 - 知乎_files/1907.216a26f4.3a30d0c778e087df9648.css" crossorigin="" rel="stylesheet"><style class="darkreader darkreader--sync" media="screen"></style><link href="./cute 之 简单GEMM实现 - 知乎_files/column.216a26f4.c878ff8b92c3fa3efa99.css" crossorigin="" rel="stylesheet"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" type="text/css" href="./cute 之 简单GEMM实现 - 知乎_files/user-hover-card.216a26f4.0e3930e2ffc649f7ed8b.css" crossorigin="anonymous"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" type="text/css" href="./cute 之 简单GEMM实现 - 知乎_files/GoodsRecommendGoodsCardList.216a26f4.d95ce79191cdf8d7ac28.css" crossorigin="anonymous"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" type="text/css" href="./cute 之 简单GEMM实现 - 知乎_files/report_modals.216a26f4.370935343bb8c3bca346.css" crossorigin="anonymous"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" type="text/css" href="./cute 之 简单GEMM实现 - 知乎_files/632.216a26f4.b3e609d82ae4a031d7a1.css" crossorigin="anonymous"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" type="text/css" href="./cute 之 简单GEMM实现 - 知乎_files/ECommerceAd.216a26f4.c90979d08ed65b86fc8f.css" crossorigin="anonymous"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" type="text/css" href="./cute 之 简单GEMM实现 - 知乎_files/1468.216a26f4.101bb14a2c1d8d20b744.css" crossorigin="anonymous"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" type="text/css" href="./cute 之 简单GEMM实现 - 知乎_files/EditableV2.216a26f4.6c9301eaad8df7e50cb2.css" crossorigin="anonymous"><style class="darkreader darkreader--sync" media="screen"></style><script nonce="">!function(){"use strict";!function(e,n){var r=[];function t(e){return function(){r.push([e,arguments])}}n.Raven={captureException:t("captureException"),captureMessage:t("captureMessage"),captureBreadcrumb:t("captureBreadcrumb")};var a,o,c,i,s,u="undefined"!=typeof DOMError;function d(e){var n=e instanceof Error||e instanceof ErrorEvent||u&&e instanceof DOMError||e instanceof DOMException;Raven.captureException(n?e:new Error(e.message||e.reason))}n.addEventListener("unhandledrejection",d),n.addEventListener("error",d,!0),a=e.src,o=e,c=function(){r.forEach(function(e){var n;(n=Raven)[e[0]].apply(n,e[1])}),n.removeEventListener("unhandledrejection",d),n.removeEventListener("error",d,!0)},i=document.head||document.getElementsByTagName("head")[0],(s=document.createElement("script")).crossOrigin=o.crossOrigin,s.dataset.sentryConfig=o["data-sentry-config"],s.onload=c,s.src=a,i.appendChild(s)}({"defer":true,"crossOrigin":"anonymous","src":"https://unpkg.zhimg.com/@cfe/sentry-script@1.3.1/dist/init.js","data-sentry-config":"{\"dsn\":\"https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224\",\"sampleRate\":0.1,\"release\":\"1460-273bc90e\",\"ignoreErrorNames\":[\"NetworkError\",\"SecurityError\"],\"ignoreErrorsPreset\":\"ReactApp\",\"tags\":{\"app_name\":\"heifetz\"}}"},window)}();
</script><script crossorigin="anonymous" data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;1460-273bc90e&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrorsPreset&quot;:&quot;ReactApp&quot;,&quot;tags&quot;:{&quot;app_name&quot;:&quot;heifetz&quot;}}" src="./cute 之 简单GEMM实现 - 知乎_files/init.js"></script><meta name="darkreader" content="b7ee56eb408a4a17919dcf6f56ba4aeb"><style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: #7b5300 !important;
    border-color: #d8b013 !important;
    color: #f3e8c8 !important;
}
#vimvixen-console-frame {
    color-scheme: light !important;
}
::placeholder {
    opacity: 0.5 !important;
}
#edge-translate-panel-body,
.MuiTypography-body1,
.nfe-quote-text {
    color: var(--darkreader-neutral-text) !important;
}
gr-main-header {
    background-color: #0f3a48 !important;
}
.tou-z65h9k,
.tou-mignzq,
.tou-1b6i2ox,
.tou-lnqlqk {
    background-color: var(--darkreader-neutral-background) !important;
}
.tou-75mvi {
    background-color: #032029 !important;
}
.tou-ta9e87,
.tou-1w3fhi0,
.tou-1b8t2us,
.tou-py7lfi,
.tou-1lpmd9d,
.tou-1frrtv8,
.tou-17ezmgn {
    background-color: #0a0a0a !important;
}
.tou-uknfeu {
    background-color: #231603 !important;
}
.tou-6i3zyv {
    background-color: #19576c !important;
}
div.mermaid-viewer-control-panel .btn {
    background-color: var(--darkreader-neutral-background);
    fill: var(--darkreader-neutral-text);
}
svg g rect.er {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.entityBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxOdd {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxEven {
    fill: var(--darkreader-selection-background);
    fill-opacity: 0.8 !important;
}
svg rect.er.relationshipLabelBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g g.nodes rect,
svg g g.nodes polygon {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.task {
    fill: var(--darkreader-selection-background) !important;
}
svg line.messageLine0,
svg line.messageLine1 {
    stroke: var(--darkreader-neutral-text) !important;
}
div.mermaid .actor {
    fill: var(--darkreader-neutral-background) !important;
}
mitid-authenticators-code-app > .code-app-container {
    background-color: white !important;
    padding-top: 1rem;
}
iframe#unpaywall[src$="unpaywall.html"] {
    color-scheme: light !important;
}
embed[type="application/pdf"][src="about:blank"] { filter: invert(100%) contrast(90%); }</style><style data-emotion-css="55n9hh">.css-55n9hh{position:fixed;top:0;right:0;left:0;z-index:101;display:none;height:2px;pointer-events:none;background:#1772F6;-webkit-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1l12z7y">.css-1l12z7y{box-shadow:0px 16px 32px rgba(0,0,0,0.04);}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1hlrcxk">.css-1hlrcxk{-webkit-transition-property:fill;transition-property:fill;-webkit-transition-duration:0.25s;transition-duration:0.25s;-webkit-transition-timing-function:ease-in;transition-timing-function:ease-in;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="icip60">.css-icip60{border-radius:2px;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="fnnb9l">.css-fnnb9l{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#ffffff;width:30px;height:30px;border-radius:2px;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="78p1r9">.css-78p1r9{box-sizing:border-box;margin:0;min-width:0;margin-left:auto;margin-right:auto;max-width:690px;margin-top:0;}@media screen and (min-width:40em){.css-78p1r9{margin-top:1em;}}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1vssajs">.css-1vssajs{position:relative;padding-bottom:63.5%;height:0;border-radius:inherit;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="18bmt9c">.css-18bmt9c{box-sizing:border-box;margin:0;min-width:0;position:relative;padding-bottom:63.5%;height:0;border-radius:inherit;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1ld0bim">.css-1ld0bim{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:inherit;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="uodor8">.css-uodor8{border-radius:50%;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1syywx2">.css-1syywx2{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#ffffff;width:38px;height:38px;border-radius:50%;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="4gq0sj">.css-4gq0sj{box-sizing:border-box;margin:0;min-width:0;color:#09408e;display:inline-block;margin-left:.3em;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1ldqog6">.css-1ldqog6{-webkit-transform:scale(1.1);-ms-transform:scale(1.1);transform:scale(1.1);}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="z4ujak">.css-z4ujak{color:#8491a5;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1od93p9">.css-1od93p9{margin-top:16px;position:relative;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="376mun">.css-376mun{position:relative;display:inline;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1dlndns">.css-1dlndns{position:absolute;left:NaNpx;top:0;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="ldd79s">.css-ldd79s{box-sizing:border-box;margin:0;min-width:0;position:absolute;left:NaNpx;top:0;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="dg64xe">.css-dg64xe .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(248,248,250,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-dg64xe .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-dg64xe .FileLinkCard-info{margin-left:12px;}.css-dg64xe .FileLinkCard-name{color:#191B1F;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-dg64xe .FileLinkCard-meta{color:#9196a1;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-dg64xe .FileLinkCard-source{white-space:pre;}.css-dg64xe img[data-uncomfortable]{content:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20344.88888888888886%20194%22%3E%3CforeignObject%20width%3D%22344.88888888888886%22%20height%3D%22194%22%3E%0A%20%20%20%20%20%20%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22font-size%3A%2013px%3B%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20Microsoft%20YaHei%2C%20sans-serif%3B%20color%3A%20%23fff%3B%20width%3A100%25%3B%20height%3A194px%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3A%20flex%3B%20flex-direction%3A%20column%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20height%3A%20100%25%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22currentColor%22%3E%3Cpath%20d%3D%22M8%203.65a7%207%200%2000-1.353.128.65.65%200%2011-.25-1.275A8.3%208.3%200%20018%202.35c2.387%200%204.172.954%205.357%202.125C14.511%205.615%2015.15%207.022%2015.15%208c0%20.621-.257%201.391-.699%202.134a7.076%207.076%200%2001-1.403%201.68l.495.46a.65.65%200%2011-.886.951l-.998-.929a.645.645%200%2001-.104-.097L9.73%2010.501a.647.647%200%2001-.29.301%203.15%203.15%200%2001-4.313-4.094.647.647%200%2001.234-.275L3.908%205.08a5.774%205.774%200%2000-1.283%201.522C2.282%207.198%202.15%207.707%202.15%208c0%20.522.41%201.616%201.407%202.6.965.954%202.43%201.75%204.443%201.75.468%200%20.905-.043%201.311-.12a.65.65%200%2001.243%201.277A8.322%208.322%200%20018%2013.65c-2.387%200-4.172-.954-5.357-2.125C1.49%2010.385.85%208.978.85%208c0-.598.238-1.333.648-2.046A7.054%207.054%200%20012.95%204.188l-.547-.509a.65.65%200%2011.886-.951l8.8%208.194a5.793%205.793%200%20001.244-1.453c.372-.624.516-1.163.516-1.469%200-.522-.41-1.616-1.407-2.6-.965-.954-2.43-1.75-4.443-1.75zM6.29%207.296a1.85%201.85%200%20002.534%202.36l-2.535-2.36zM8%204.85a.65.65%200%20100%201.3%201.85%201.85%200%20011.843%201.694.65.65%200%20101.296-.11A3.15%203.15%200%20008%204.85z%22%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22margin%3A%20.6em%200%201.2em%22%3E%E8%AF%A5%E5%9B%BE%E7%89%87%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%BC%95%E8%B5%B7%E4%B8%8D%E9%80%82%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style%3D%22padding%3A%204px%201em%3B%20font-size%3A%201.1em%3B%20color%3A%20inherit%3B%20background%3A%20none%3B%20border%3A%201px%20solid%20rgba%28255%2C255%2C255%2C.5%29%3B%20border-radius%3A%209999px%3B%22%3E%E7%BB%A7%E7%BB%AD%E6%9F%A5%E7%9C%8B%3C%2Fbutton%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2FforeignObject%3E%3C%2Fsvg%3E);width:100%;height:194px;background:url(https://pic1.zhimg.com/v2-cf70d0759d787c70091857151c1cad4a.jpeg) no-repeat rgba(191,191,191,0.7);background-size:cover;cursor:pointer!important;}.css-dg64xe img.content_image[data-size="normal"],.css-dg64xe img.origin_image[data-size="normal"]{width:100%;max-width:100%;}.css-dg64xe img.content_image[data-size="small"],.css-dg64xe img.origin_image[data-size="small"]{width:320px;max-width:100%;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1vqsdx1">.css-1vqsdx1 .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#f8f8fa;}.css-1vqsdx1 .LinkCard.new,.css-1vqsdx1 .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1vqsdx1 .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-1vqsdx1 .LinkCard.new .LinkCard-contents .loading{height:14px;background:#ebeced;border-radius:7px;}.css-1vqsdx1 .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-1vqsdx1 .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#191B1F;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-1vqsdx1 .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#9196a1;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1vqsdx1 .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#373a40;}.css-1vqsdx1 .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#9196a1;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1vqsdx1 .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-1vqsdx1 .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(196,199,206,0.3);}.css-1vqsdx1 .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-1vqsdx1 .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-1vqsdx1 .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#ebeced;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-1vqsdx1 .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ebeced;color:#c4c7ce;}.css-1vqsdx1 .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#9196a1;}.css-1vqsdx1 .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-1vqsdx1 .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-1vqsdx1 .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#373a40;}.css-1vqsdx1 .LinkCard.new .LinkCard-richText .text{color:#373a40;}.css-1vqsdx1 .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-1vqsdx1 .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-1vqsdx1 .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-1vqsdx1 .LinkCard.old,.css-1vqsdx1 .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(248,248,250,0.88);color:#c4c7ce;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#ebeced;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#ebeced;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="yxro2d">.css-yxro2d .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-yxro2d .LinkCard.old,.css-yxro2d .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-yxro2d .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(248,248,250,0.88);color:#c4c7ce;}.css-yxro2d .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#ebeced;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-yxro2d .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#ebeced;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-yxro2d .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#f8f8fa;}.css-yxro2d .LinkCard.new,.css-yxro2d .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-yxro2d .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-yxro2d .LinkCard.new .LinkCard-contents .loading{height:14px;background:#ebeced;border-radius:7px;}.css-yxro2d .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-yxro2d .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#191B1F;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yxro2d .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-yxro2d .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-yxro2d .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-yxro2d .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-yxro2d .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#9196a1;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yxro2d .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#373a40;}.css-yxro2d .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#9196a1;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yxro2d .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-yxro2d .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(196,199,206,0.3);}.css-yxro2d .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-yxro2d .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-yxro2d .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#ebeced;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-yxro2d .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ebeced;color:#c4c7ce;}.css-yxro2d .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#9196a1;}.css-yxro2d .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-yxro2d .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-yxro2d .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#373a40;}.css-yxro2d .LinkCard.new .LinkCard-richText .text{color:#373a40;}.css-yxro2d .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-yxro2d .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-yxro2d .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(248,248,250,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-yxro2d .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-yxro2d .FileLinkCard-info{margin-left:12px;}.css-yxro2d .FileLinkCard-name{color:#191B1F;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-yxro2d .FileLinkCard-meta{color:#9196a1;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-yxro2d .FileLinkCard-source{white-space:pre;}.css-yxro2d img[data-uncomfortable]{content:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20344.88888888888886%20194%22%3E%3CforeignObject%20width%3D%22344.88888888888886%22%20height%3D%22194%22%3E%0A%20%20%20%20%20%20%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22font-size%3A%2013px%3B%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20Microsoft%20YaHei%2C%20sans-serif%3B%20color%3A%20%23fff%3B%20width%3A100%25%3B%20height%3A194px%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3A%20flex%3B%20flex-direction%3A%20column%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20height%3A%20100%25%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22currentColor%22%3E%3Cpath%20d%3D%22M8%203.65a7%207%200%2000-1.353.128.65.65%200%2011-.25-1.275A8.3%208.3%200%20018%202.35c2.387%200%204.172.954%205.357%202.125C14.511%205.615%2015.15%207.022%2015.15%208c0%20.621-.257%201.391-.699%202.134a7.076%207.076%200%2001-1.403%201.68l.495.46a.65.65%200%2011-.886.951l-.998-.929a.645.645%200%2001-.104-.097L9.73%2010.501a.647.647%200%2001-.29.301%203.15%203.15%200%2001-4.313-4.094.647.647%200%2001.234-.275L3.908%205.08a5.774%205.774%200%2000-1.283%201.522C2.282%207.198%202.15%207.707%202.15%208c0%20.522.41%201.616%201.407%202.6.965.954%202.43%201.75%204.443%201.75.468%200%20.905-.043%201.311-.12a.65.65%200%2001.243%201.277A8.322%208.322%200%20018%2013.65c-2.387%200-4.172-.954-5.357-2.125C1.49%2010.385.85%208.978.85%208c0-.598.238-1.333.648-2.046A7.054%207.054%200%20012.95%204.188l-.547-.509a.65.65%200%2011.886-.951l8.8%208.194a5.793%205.793%200%20001.244-1.453c.372-.624.516-1.163.516-1.469%200-.522-.41-1.616-1.407-2.6-.965-.954-2.43-1.75-4.443-1.75zM6.29%207.296a1.85%201.85%200%20002.534%202.36l-2.535-2.36zM8%204.85a.65.65%200%20100%201.3%201.85%201.85%200%20011.843%201.694.65.65%200%20101.296-.11A3.15%203.15%200%20008%204.85z%22%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22margin%3A%20.6em%200%201.2em%22%3E%E8%AF%A5%E5%9B%BE%E7%89%87%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%BC%95%E8%B5%B7%E4%B8%8D%E9%80%82%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style%3D%22padding%3A%204px%201em%3B%20font-size%3A%201.1em%3B%20color%3A%20inherit%3B%20background%3A%20none%3B%20border%3A%201px%20solid%20rgba%28255%2C255%2C255%2C.5%29%3B%20border-radius%3A%209999px%3B%22%3E%E7%BB%A7%E7%BB%AD%E6%9F%A5%E7%9C%8B%3C%2Fbutton%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2FforeignObject%3E%3C%2Fsvg%3E);width:100%;height:194px;background:url(https://pic1.zhimg.com/v2-cf70d0759d787c70091857151c1cad4a.jpeg) no-repeat rgba(191,191,191,0.7);background-size:cover;cursor:pointer!important;}.css-yxro2d img.content_image[data-size="normal"],.css-yxro2d img.origin_image[data-size="normal"]{width:100%;max-width:100%;}.css-yxro2d img.content_image[data-size="small"],.css-yxro2d img.origin_image[data-size="small"]{width:320px;max-width:100%;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1ygg4xu animation-1yvu044">.css-1ygg4xu{word-break:break-word;line-height:1.6;}.css-1ygg4xu > [data-first-child]{margin-top:0;}.css-1ygg4xu > :last-child{margin-bottom:0;}.css-1ygg4xu h1,.css-1ygg4xu h2{clear:left;margin-top:calc((1.4em * 2) / 1.2);margin-bottom:calc(1.4em / 1.2);font-size:1.2em;line-height:1.5;font-weight:600;}.css-1ygg4xu h3,.css-1ygg4xu h4,.css-1ygg4xu h5,.css-1ygg4xu h6{clear:left;margin-top:calc((1.4em * 1.5) / 1.1);margin-bottom:calc(1.4em / 1.1);font-size:1.1em;line-height:1.5;font-weight:600;}.css-1ygg4xu u{-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #373a40;}.css-1ygg4xu b{font-weight:600;}.css-1ygg4xu sup{font-size:0.8em;}.css-1ygg4xu sup[data-draft-type='reference']{color:#09408e;}.css-1ygg4xu a:focus{outline:none;-webkit-transition:box-shadow 0.3s;transition:box-shadow 0.3s;}html[data-focus-visible] .css-1ygg4xu a:focus{box-shadow:0 0 0 2px #ffffff,0 0 0 4px rgba(23,114,246,0.3);}.css-1ygg4xu a.ztext-link,.css-1ygg4xu a.internal,.css-1ygg4xu a.external{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:1px solid #81858f;}.css-1ygg4xu a.ztext-link:hover,.css-1ygg4xu a.internal:hover,.css-1ygg4xu a.external:hover{color:#09408e;border-bottom:1px solid #09408e;}.css-1ygg4xu a.ztext-link > .ellipsis::after,.css-1ygg4xu a.internal > .ellipsis::after,.css-1ygg4xu a.external > .ellipsis::after{content:'...';}.css-1ygg4xu a.ztext-link > .invisible,.css-1ygg4xu a.internal > .invisible,.css-1ygg4xu a.external > .invisible{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;}.css-1ygg4xu a.ztext-link u,.css-1ygg4xu a.internal u,.css-1ygg4xu a.external u{border:none;}.css-1ygg4xu a.member_mention{color:#09408e;}.css-1ygg4xu a.member_mention:hover{border-bottom:1px solid #09408e;}.css-1ygg4xu a.UserLink-link{color:#09408e;}.css-1ygg4xu a.UserLink-link:hover{border-bottom:1px solid #09408e;}.css-1ygg4xu p{margin:1.4em 0;}.css-1ygg4xu p.ztext-empty-paragraph{margin:calc((2.8em- (1.4em * 2 + 1.6em)) / 2) 0;}.css-1ygg4xu p.ztext-empty-paragraph + .ztext-empty-paragraph{margin:1.4em 0;}.css-1ygg4xu hr{margin:4em auto;width:240px;max-width:100%;border:none;border-top:1px solid #c4c7ce;}.css-1ygg4xu img[eeimg]{max-width:100%;vertical-align:middle;}.css-1ygg4xu img[eeimg="1"]{margin:0 3px;max-width:calc(100% - 6px);display:inline-block;}.css-1ygg4xu img[eeimg="2"]{margin:1.4em auto;display:block;}.css-1ygg4xu blockquote{margin:1.4em 0;padding-left:1em;color:#535861;border-left:3px solid #c4c7ce;}.css-1ygg4xu ol,.css-1ygg4xu ul{margin:1.4em 0;padding:0;width:100%;}.css-1ygg4xu ol ol,.css-1ygg4xu ul ol,.css-1ygg4xu ol ul,.css-1ygg4xu ul ul{margin:0;}.css-1ygg4xu ol li::before,.css-1ygg4xu ul li::before{width:1em;}.css-1ygg4xu ol > ol,.css-1ygg4xu ul > ol,.css-1ygg4xu ol > ul,.css-1ygg4xu ul > ul{padding-left:1em;box-sizing:border-box;}.css-1ygg4xu ul>li{display:table;width:100%;list-style:none;}.css-1ygg4xu ul>li::before{display:table-cell;content:'•  ';white-space:pre;}.css-1ygg4xu ol{counter-reset:ol;}.css-1ygg4xu ol > li{display:table;width:100%;list-style:none;}.css-1ygg4xu ol > li::before{display:table-cell;text-align:right;counter-increment:ol;content:counter(ol) '. ';white-space:pre;}.css-1ygg4xu ol ol{counter-reset:ol2;}.css-1ygg4xu ol ol li::before{counter-increment:ol2;content:counter(ol2) '. ';}.css-1ygg4xu ol ol ol{counter-reset:ol3;}.css-1ygg4xu ol ol ol li::before{counter-increment:ol3;content:counter(ol3) '. ';}.css-1ygg4xu ol ol ol ol{counter-reset:ol4;}.css-1ygg4xu ol ol ol ol li::before{counter-increment:ol4;content:counter(ol4) '. ';}.css-1ygg4xu figure{margin:1.4em 0;}.css-1ygg4xu figure .content_image,.css-1ygg4xu figure .origin_image{margin:0 auto;}.css-1ygg4xu figure figcaption{margin-top:calc(0.6em / 0.9);padding:0 1em;font-size:0.9em;line-height:1.5;text-align:center;color:#9196a1;}.css-1ygg4xu figure + figure{margin-top:calc(1.4em * 1.6);}.css-1ygg4xu figure[data-size='small'],.css-1ygg4xu figure:not([data-size]) > [data-size='small']{clear:both;}.css-1ygg4xu figure[data-size='left'],.css-1ygg4xu figure:not([data-size]) > [data-size='left']{float:left;margin:0 20px 20px 0;max-width:33%;}.css-1ygg4xu figure[data-size='right'],.css-1ygg4xu figure:not([data-size]) > [data-size='right']{float:right;margin:0 0 20px 20px;max-width:33%;}.css-1ygg4xu figure[data-size='collapse']{margin-bottom:0;}.css-1ygg4xu figure[data-size='collapse'] + figure{margin-top:0;}.css-1ygg4xu .content_image,.css-1ygg4xu .origin_image{display:block;max-width:100%;height:auto;margin:1.4em auto;}.css-1ygg4xu .content_image[data-size='small'],.css-1ygg4xu .origin_image[data-size='small']{max-width:40%;}.css-1ygg4xu .content_image.zh-lightbox-thumb,.css-1ygg4xu .origin_image.zh-lightbox-thumb{cursor:-webkit-zoom-in;cursor:-moz-zoom-in;cursor:zoom-in;}.css-1ygg4xu code{margin:0 2px;padding:3px 4px;border-radius:3px;font-family:Menlo,Monaco,Consolas,'Andale Mono','lucida console','Courier New',monospace;font-size:0.9em;background-color:#f8f8fa;}.css-1ygg4xu pre{margin:1.4em 0;padding:calc(0.8em / 0.9);font-size:0.9em;word-break:initial;word-wrap:initial;white-space:pre;overflow:auto;-webkit-overflow-scrolling:touch;background:#f8f8fa;border-radius:4px;}.css-1ygg4xu pre code{margin:0;padding:0;font-size:inherit;border-radius:0;background-color:inherit;}.css-1ygg4xu li pre{white-space:pre-wrap;}.css-1ygg4xu table[data-draft-type='table']{border-collapse:collapse;font-size:15px;margin:1.4em auto;max-width:100%;table-layout:fixed;text-align:left;width:100%;}.css-1ygg4xu table[data-draft-type='table'][data-size='small']{min-width:260px;width:40%;}.css-1ygg4xu table[data-draft-type='table'][data-row-style='striped'] tr:nth-of-type(2n + 1){background:#f8f8fa;}.css-1ygg4xu table[data-draft-type='table'] td,.css-1ygg4xu table[data-draft-type='table'] th{border:1px solid #c4c7ce;line-height:24px;height:24px;padding:3px 12px;}.css-1ygg4xu table[data-draft-type='table'] th{background:#ebeced;color:#191B1F;font-weight:500;}.css-1ygg4xu .video-box,.css-1ygg4xu .link-box{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:1.4em 0;overflow:auto;white-space:normal;cursor:pointer;border:solid 1px #ebeced;border-radius:4px;}.css-1ygg4xu .lazy[data-lazy-status]{background-color:#f8f8fa;}.css-1ygg4xu .lazy[data-lazy-status="ok"]{background-color:transparent;-webkit-animation:animation-1yvu044 0.5s ease-in;animation:animation-1yvu044 0.5s ease-in;}.css-1ygg4xu .highlight{margin:1em 0;}.css-1ygg4xu .highlight pre{margin:0;}.css-1ygg4xu .highlight .hll{background-color:#f8f8fa;}.css-1ygg4xu .highlight .c{font-style:italic;color:#9196a1;}.css-1ygg4xu .highlight .err{color:#D95350;}.css-1ygg4xu .highlight .k{font-weight:600;}.css-1ygg4xu .highlight .o{font-weight:600;}.css-1ygg4xu .highlight .cm{font-style:italic;color:#9196a1;}.css-1ygg4xu .highlight .cp{font-weight:600;color:#9196a1;}.css-1ygg4xu .highlight .c1{font-style:italic;color:#9196a1;}.css-1ygg4xu .highlight .cs{font-style:italic;font-weight:600;color:#9196a1;}.css-1ygg4xu .highlight .gd{color:#F05159;}.css-1ygg4xu .highlight .ge{font-style:italic;}.css-1ygg4xu .highlight .gr{color:#D95350;}.css-1ygg4xu .highlight .gh{color:#9196a1;}.css-1ygg4xu .highlight .gi{color:#12b370;}.css-1ygg4xu .highlight .go{color:#81858f;}.css-1ygg4xu .highlight .gp{color:#535861;}.css-1ygg4xu .highlight .gs{font-weight:600;}.css-1ygg4xu .highlight .gu{color:#9196a1;}.css-1ygg4xu .highlight .gt{color:#D95350;}.css-1ygg4xu .highlight .kc{font-weight:600;}.css-1ygg4xu .highlight .kd{font-weight:600;}.css-1ygg4xu .highlight .kn{font-weight:600;}.css-1ygg4xu .highlight .kp{font-weight:600;}.css-1ygg4xu .highlight .kr{font-weight:600;}.css-1ygg4xu .highlight .kt{font-weight:600;color:#09408e;}.css-1ygg4xu .highlight .m{color:#1772F6;}.css-1ygg4xu .highlight .s{color:#D95350;}.css-1ygg4xu .highlight .na{color:#1772F6;}.css-1ygg4xu .highlight .nb{color:#1772F6;}.css-1ygg4xu .highlight .nc{font-weight:600;color:#09408e;}.css-1ygg4xu .highlight .no{color:#1772F6;}.css-1ygg4xu .highlight .ni{color:#6A5FF3;}.css-1ygg4xu .highlight .ne{font-weight:600;color:#D95350;}.css-1ygg4xu .highlight .nf{font-weight:600;color:#D95350;}.css-1ygg4xu .highlight .nn{color:#535861;}.css-1ygg4xu .highlight .nt{color:#09408e;}.css-1ygg4xu .highlight .nv{color:#1772F6;}.css-1ygg4xu .highlight .ow{font-weight:600;}.css-1ygg4xu .highlight .w{color:#adb0b7;}.css-1ygg4xu .highlight .mf{color:#1772F6;}.css-1ygg4xu .highlight .mh{color:#1772F6;}.css-1ygg4xu .highlight .mi{color:#1772F6;}.css-1ygg4xu .highlight .mo{color:#1772F6;}.css-1ygg4xu .highlight .sb{color:#D95350;}.css-1ygg4xu .highlight .sc{color:#D95350;}.css-1ygg4xu .highlight .sd{color:#D95350;}.css-1ygg4xu .highlight .s2{color:#D95350;}.css-1ygg4xu .highlight .se{color:#D95350;}.css-1ygg4xu .highlight .sh{color:#D95350;}.css-1ygg4xu .highlight .si{color:#D95350;}.css-1ygg4xu .highlight .sx{color:#D95350;}.css-1ygg4xu .highlight .sr{color:#A5542F;}.css-1ygg4xu .highlight .s1{color:#D95350;}.css-1ygg4xu .highlight .ss{color:#D95350;}.css-1ygg4xu .highlight .bp{color:#9196a1;}.css-1ygg4xu .highlight .vc{color:#1772F6;}.css-1ygg4xu .highlight .vg{color:#1772F6;}.css-1ygg4xu .highlight .vi{color:#1772F6;}.css-1ygg4xu .highlight .il{color:#1772F6;}.css-1ygg4xu .highlight::-webkit-scrollbar{width:6px;height:6px;}.css-1ygg4xu .highlight::-webkit-scrollbar-thumb:horizontal{background-color:rgba(25,27,31,0.5);border-radius:6px;}.css-1ygg4xu .highlight::-webkit-scrollbar-thumb:horizontal:hover{background-color:rgba(25,27,31,0.6);}.css-1ygg4xu .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-1ygg4xu .LinkCard.old,.css-1ygg4xu .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1ygg4xu .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(248,248,250,0.88);color:#c4c7ce;}.css-1ygg4xu .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#ebeced;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-1ygg4xu .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-1ygg4xu .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1ygg4xu .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#ebeced;}.css-1ygg4xu .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-1ygg4xu .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-1ygg4xu .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#f8f8fa;}.css-1ygg4xu .LinkCard.new,.css-1ygg4xu .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1ygg4xu .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-1ygg4xu .LinkCard.new .LinkCard-contents .loading{height:14px;background:#ebeced;border-radius:7px;}.css-1ygg4xu .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-1ygg4xu .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#191B1F;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1ygg4xu .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1ygg4xu .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-1ygg4xu .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-1ygg4xu .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-1ygg4xu .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#9196a1;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1ygg4xu .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#373a40;}.css-1ygg4xu .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#9196a1;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1ygg4xu .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-1ygg4xu .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(196,199,206,0.3);}.css-1ygg4xu .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-1ygg4xu .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-1ygg4xu .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#ebeced;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-1ygg4xu .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ebeced;color:#c4c7ce;}.css-1ygg4xu .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#9196a1;}.css-1ygg4xu .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-1ygg4xu .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-1ygg4xu .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#373a40;}.css-1ygg4xu .LinkCard.new .LinkCard-richText .text{color:#373a40;}.css-1ygg4xu .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-1ygg4xu .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-1ygg4xu .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(248,248,250,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-1ygg4xu .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-1ygg4xu .FileLinkCard-info{margin-left:12px;}.css-1ygg4xu .FileLinkCard-name{color:#191B1F;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1ygg4xu .FileLinkCard-meta{color:#9196a1;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-1ygg4xu .FileLinkCard-source{white-space:pre;}.css-1ygg4xu img[data-uncomfortable]{content:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20344.88888888888886%20194%22%3E%3CforeignObject%20width%3D%22344.88888888888886%22%20height%3D%22194%22%3E%0A%20%20%20%20%20%20%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22font-size%3A%2013px%3B%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20Microsoft%20YaHei%2C%20sans-serif%3B%20color%3A%20%23fff%3B%20width%3A100%25%3B%20height%3A194px%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3A%20flex%3B%20flex-direction%3A%20column%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20height%3A%20100%25%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22currentColor%22%3E%3Cpath%20d%3D%22M8%203.65a7%207%200%2000-1.353.128.65.65%200%2011-.25-1.275A8.3%208.3%200%20018%202.35c2.387%200%204.172.954%205.357%202.125C14.511%205.615%2015.15%207.022%2015.15%208c0%20.621-.257%201.391-.699%202.134a7.076%207.076%200%2001-1.403%201.68l.495.46a.65.65%200%2011-.886.951l-.998-.929a.645.645%200%2001-.104-.097L9.73%2010.501a.647.647%200%2001-.29.301%203.15%203.15%200%2001-4.313-4.094.647.647%200%2001.234-.275L3.908%205.08a5.774%205.774%200%2000-1.283%201.522C2.282%207.198%202.15%207.707%202.15%208c0%20.522.41%201.616%201.407%202.6.965.954%202.43%201.75%204.443%201.75.468%200%20.905-.043%201.311-.12a.65.65%200%2001.243%201.277A8.322%208.322%200%20018%2013.65c-2.387%200-4.172-.954-5.357-2.125C1.49%2010.385.85%208.978.85%208c0-.598.238-1.333.648-2.046A7.054%207.054%200%20012.95%204.188l-.547-.509a.65.65%200%2011.886-.951l8.8%208.194a5.793%205.793%200%20001.244-1.453c.372-.624.516-1.163.516-1.469%200-.522-.41-1.616-1.407-2.6-.965-.954-2.43-1.75-4.443-1.75zM6.29%207.296a1.85%201.85%200%20002.534%202.36l-2.535-2.36zM8%204.85a.65.65%200%20100%201.3%201.85%201.85%200%20011.843%201.694.65.65%200%20101.296-.11A3.15%203.15%200%20008%204.85z%22%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22margin%3A%20.6em%200%201.2em%22%3E%E8%AF%A5%E5%9B%BE%E7%89%87%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%BC%95%E8%B5%B7%E4%B8%8D%E9%80%82%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style%3D%22padding%3A%204px%201em%3B%20font-size%3A%201.1em%3B%20color%3A%20inherit%3B%20background%3A%20none%3B%20border%3A%201px%20solid%20rgba%28255%2C255%2C255%2C.5%29%3B%20border-radius%3A%209999px%3B%22%3E%E7%BB%A7%E7%BB%AD%E6%9F%A5%E7%9C%8B%3C%2Fbutton%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2FforeignObject%3E%3C%2Fsvg%3E);width:100%;height:194px;background:url(https://pic1.zhimg.com/v2-cf70d0759d787c70091857151c1cad4a.jpeg) no-repeat rgba(191,191,191,0.7);background-size:cover;cursor:pointer!important;}.css-1ygg4xu img.content_image[data-size="normal"],.css-1ygg4xu img.origin_image[data-size="normal"]{width:100%;max-width:100%;}.css-1ygg4xu img.content_image[data-size="small"],.css-1ygg4xu img.origin_image[data-size="small"]{width:320px;max-width:100%;}@-webkit-keyframes animation-1yvu044{from{opacity:0;}to{opacity:1;}}@keyframes animation-1yvu044{from{opacity:0;}to{opacity:1;}}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="ch8ocw">.css-ch8ocw{position:relative;display:inline-block;height:30px;padding:0 12px;font-size:14px;line-height:30px;color:#1772F6;vertical-align:top;border-radius:100px;background:rgba(23,114,246,0.1);}.css-ch8ocw:hover{background-color:rgba(23,114,246,0.15);}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1xlfegr">.css-1xlfegr{background:transparent;box-shadow:none;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1gomreu">.css-1gomreu{position:relative;display:inline-block;}</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion-css="1u7r5c9">.css-1u7r5c9{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#ffffff;width:40px;height:40px;border-radius:50%;}</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.Marquee_module_marquee__218919a6 {
  overflow: hidden;
}

.Marquee_module_marqueeText__218919a6 {
  position: relative;
  transition: all 0.5s ease-in-out;
}
.Marquee_module_noAnimation__218919a6 {
  transition: none;
}

.Marquee_module_marqueeItem__218919a6 {
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
  overflow: hidden;
  flex: 1;
}
</style><style class="darkreader darkreader--sync" media="screen"></style><style data-emotion="css"></style><style class="darkreader darkreader--sync" media="screen"></style><style>.MathJax_Preview ~ .math-holder {display: none}</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MathJax_Preview {color: #888; display: contents}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
.MathJax_SVG .noError {white-space: normal}
html[data-theme="dark"] .MathJax_SVG .noError {filter: invert(1)}
.ztext-math-scrollable .MathJax_SVG {max-width: 100%; overflow-x: auto; overflow-y: hidden}
.ztext-math-scrollable .MathJax_SVG svg {max-width: unset}
.MathJax_SVG svg {max-width: 100%}
div.MathJax_SVG_Display {display: none}
.MathJax_Preview ~ .math-holder {display: none}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MathJax_SVG_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax_SVG .MJX-monospace {font-family: monospace}
.MathJax_SVG .MJX-sans-serif {font-family: sans-serif}
#MathJax_SVG_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax_SVG {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax_SVG * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_SVG > div {display: inline-block}
.mjx-svg-href {fill: blue; stroke: blue}
.MathJax_SVG_Processing {visibility: hidden; position: absolute; top: 0; left: 0; width: 0; height: 0; overflow: hidden; display: block!important}
.MathJax_SVG_Processed {display: none!important}
.MathJax_SVG_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_SVG_test.mjx-test-display {display: table!important}
.MathJax_SVG_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_SVG_test.mjx-test-default {display: block!important; clear: both}
.MathJax_SVG_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.mjx-test-inline .MathJax_SVG_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_SVG_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_SVG_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax_SVG .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style class="darkreader darkreader--sync" media="screen"></style></head><body class="WhiteBg-body PostIndex-body Body--isAppleDevice" aria-basefontsize="16" data-rh="class"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; --darkreader-inline-border-top: 0px; --darkreader-inline-border-right: 0px; --darkreader-inline-border-bottom: 0px; --darkreader-inline-border-left: 0px;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><div id="MathJax_SVG_Hidden"></div><svg><defs id="MathJax_SVG_glyphs"><path stroke-width="1" id="MJMATHBI-43" d="M380 -17Q335 -17 293 -10T207 16T130 65T76 144T55 256Q55 306 70 361T122 476T211 582T345 663T525 702H545Q673 702 731 634L777 668Q783 672 789 677T800 685T808 691T814 695T818 698T822 700T825 702T828 703T830 703T833 703Q855 703 855 690Q855 686 823 558T789 426Q786 421 782 420T756 419Q734 420 729 421T724 432Q724 434 725 447T726 472Q726 552 678 604Q640 640 586 640H574Q533 640 494 632T409 604T324 541T260 437Q243 397 227 333T210 219Q210 152 237 117Q255 90 299 68T420 46H429Q506 46 580 100T678 234Q683 249 687 251T712 254H723Q743 254 743 240Q743 232 736 213T710 162T663 100T586 40T477 -5Q433 -17 380 -17Z"></path><path stroke-width="1" id="MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="MJMATHI-3B1" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path><path stroke-width="1" id="MJMATHBI-41" d="M65 0Q45 0 45 18Q48 52 61 60Q65 62 81 62Q155 62 165 74Q166 74 265 228T465 539T569 699Q576 707 583 709T611 711T637 710T649 700Q650 697 695 380L741 63L784 62H827Q839 50 839 45L835 29Q831 9 827 5T806 0Q803 0 790 0T743 1T657 2Q585 2 547 1T504 0Q481 0 481 17Q484 54 497 60Q501 62 541 62Q580 62 580 63Q580 68 573 121T564 179V181H308L271 124Q236 69 236 67T283 62H287Q316 62 316 46Q316 26 307 8Q302 3 295 0L262 1Q242 2 168 2Q119 2 93 1T65 0ZM537 372Q533 402 528 435T521 486T518 504V505Q517 505 433 375L348 244L451 243Q555 243 555 244L537 372Z"></path><path stroke-width="1" id="MJMATHBI-42" d="M258 624H235Q214 624 209 626T199 639Q203 678 216 684Q220 686 449 686H477H586Q684 686 733 677T817 634Q853 598 853 547Q853 499 826 460T761 401T695 371T654 360H653L662 358Q670 357 683 354T712 344T744 327T774 303T795 269T804 224Q804 148 732 79T533 1Q524 0 288 0H58Q47 5 43 15Q47 54 60 60Q64 62 113 62H162L302 623Q302 624 258 624ZM703 550Q703 571 695 586T675 609T656 619T643 623L545 624H447L417 504Q386 384 386 383T470 382Q554 383 565 385Q632 397 667 447T703 550ZM651 240Q651 265 645 282T626 309T608 322T592 329Q587 330 479 331H373L340 198Q307 65 306 64Q306 62 406 62L507 63L519 65Q565 76 596 107T639 171T651 240Z"></path><path stroke-width="1" id="MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path stroke-width="1" id="MJMATHI-3B2" d="M29 -194Q23 -188 23 -186Q23 -183 102 134T186 465Q208 533 243 584T309 658Q365 705 429 705H431Q493 705 533 667T573 570Q573 465 469 396L482 383Q533 332 533 252Q533 139 448 65T257 -10Q227 -10 203 -2T165 17T143 40T131 59T126 65L62 -188Q60 -194 42 -194H29ZM353 431Q392 431 427 419L432 422Q436 426 439 429T449 439T461 453T472 471T484 495T493 524T501 560Q503 569 503 593Q503 611 502 616Q487 667 426 667Q384 667 347 643T286 582T247 514T224 455Q219 439 186 308T152 168Q151 163 151 147Q151 99 173 68Q204 26 260 26Q302 26 349 51T425 137Q441 171 449 214T457 279Q457 337 422 372Q380 358 347 358H337Q258 358 258 389Q258 396 261 403Q275 431 353 431Z"></path><path stroke-width="1" id="MJMATHBI-79" d="M206 -150Q240 -150 268 -134T314 -95T344 -48T362 -7T367 14Q339 -7 280 -7Q230 -7 195 5T144 39T122 79T115 122Q115 175 152 274T189 388Q189 396 187 398T176 401Q148 398 125 372T89 304Q84 288 81 285T61 282H55H44Q24 282 24 296Q24 306 34 329T64 381T116 431T188 452Q239 452 273 427T308 361Q308 347 273 253T237 109Q237 43 291 43T388 98Q388 99 425 246T463 396Q471 414 490 429T534 444T573 430T587 399Q587 386 537 186T483 -25Q461 -84 410 -126T296 -188Q248 -202 204 -202Q127 -202 96 -175T64 -114Q64 -82 86 -57T144 -31Q169 -31 184 -45T199 -83Q199 -89 198 -94T196 -104T193 -113T189 -120T184 -128T179 -134T173 -141T168 -147Q189 -150 206 -150Z"></path><path stroke-width="1" id="MJMATHBI-78" d="M74 282H63Q43 282 43 296Q43 298 45 307T56 332T76 365T110 401T159 433Q200 451 233 451H236Q273 451 282 450Q358 437 382 400L392 410Q434 452 483 452Q538 452 568 421T599 346Q599 303 573 280T517 256Q494 256 478 270T462 308Q462 343 488 367Q501 377 520 385Q520 386 516 389T502 396T480 400T462 398Q429 383 415 341Q354 116 354 80T405 44Q449 44 485 74T535 142Q539 156 542 159T562 162H568H579Q599 162 599 148Q599 135 586 111T550 60T485 12T397 -8Q313 -8 266 35L258 44Q215 -7 161 -7H156Q99 -7 71 25T43 95Q43 143 70 165T125 188Q148 188 164 174T180 136Q180 101 154 77Q141 67 122 59Q124 54 136 49T161 43Q183 43 200 61T226 103Q287 328 287 364T236 400Q200 400 164 377T107 302Q103 288 100 285T80 282H74Z"></path><path stroke-width="1" id="MJMATHBI-44" d="M258 624H235Q214 624 209 626T199 639Q203 678 216 684Q220 686 437 686Q659 686 668 685Q727 680 772 662T842 621T883 568T905 517T913 475Q914 466 914 434Q914 373 892 307T828 179T712 69T548 7Q517 2 494 2T279 0H58Q47 5 43 15Q47 54 60 60Q64 62 113 62H162L302 623Q302 624 258 624ZM768 475Q768 515 753 544T718 588T666 611T613 622T563 624H538H532H452L382 344Q311 64 311 63T363 62H405Q490 62 545 76T656 142Q696 185 724 265T760 399T768 475Z"></path><path stroke-width="1" id="MJMATHBI-6D" d="M24 296Q25 302 27 312T41 350T65 397T104 435T159 452Q203 452 234 435Q268 419 285 384L295 392Q305 401 317 410T349 429T389 445Q411 451 446 451Q560 451 592 383Q593 380 594 379L595 375L604 384Q675 452 762 452Q893 452 916 367Q918 356 918 334Q918 285 881 183T841 66Q838 43 849 43Q876 43 901 69T940 138Q945 156 949 159T969 162H975H986Q1006 162 1006 148Q1006 138 996 115T966 63T914 13T841 -8Q794 -8 758 16T721 82Q721 96 758 199T796 351Q796 401 753 401Q702 401 662 369T599 298Q597 294 567 172T533 40Q525 22 506 7T462 -8Q435 -8 422 8T409 39Q409 48 425 114T458 248T476 320Q478 330 478 348T474 377T462 393T449 399T433 400H428Q380 400 336 363Q301 332 281 298Q278 293 247 170T214 40Q206 22 187 7T143 -8T104 7T90 39Q90 47 108 124T146 274L164 347Q166 355 166 372Q166 401 149 401Q129 401 115 379T89 306Q84 288 80 285T55 282H44Q24 282 24 296Z"></path><path stroke-width="1" id="MJMAINB-2C" d="M74 85Q74 120 97 145T159 171Q200 171 226 138Q258 101 258 37Q258 -5 246 -44T218 -109T183 -155T152 -184T135 -194Q129 -194 118 -183T106 -164Q106 -157 115 -149Q121 -145 130 -137T161 -100T195 -35Q197 -28 200 -17T204 3T205 11T199 9T183 3T159 0Q120 0 97 26T74 85Z"></path><path stroke-width="1" id="MJMATHBI-6E" d="M24 296Q25 302 27 312T41 350T65 397T104 435T159 452Q203 452 234 435Q268 419 285 384L293 391Q363 452 454 452Q575 446 597 367Q599 356 599 334Q599 285 562 183T522 66Q519 43 530 43Q557 43 582 69T621 138Q626 156 630 159T650 162H656H667Q687 162 687 148Q687 138 677 115T647 63T595 13T522 -8Q475 -8 439 16T402 82Q402 96 439 199T477 351Q477 401 434 401Q421 401 409 398Q341 388 285 305L278 295L247 170Q216 46 214 40Q206 22 187 7T143 -8T104 7T90 39Q90 47 108 124T146 274L164 347Q166 355 166 372Q166 401 149 401Q129 401 115 379T89 306Q84 288 80 285T55 282H44Q24 282 24 296Z"></path><path stroke-width="1" id="MJMATHBI-6B" d="M99 -8Q71 -8 58 9T45 39Q45 51 116 336L188 622H184Q183 622 179 622T169 623T157 624T146 624T136 624T131 625Q119 628 119 642Q119 647 123 661T129 679Q133 684 144 685T220 690Q293 694 307 694Q324 694 328 679Q328 674 280 482Q231 290 231 287Q231 285 234 286Q259 302 294 334T356 390T420 433T493 452Q528 452 546 427T564 364Q564 308 538 282T480 256Q456 256 441 269T425 308Q425 339 444 359T483 384L502 389Q502 395 496 398Q493 400 483 400Q465 400 449 395T409 374T373 347T323 305T268 257Q274 256 282 256Q312 251 329 247T371 232T411 202Q431 181 431 146Q431 132 427 110T422 73Q422 44 440 44H442Q462 44 478 64T502 102T514 141Q518 157 522 159T547 162H558Q578 162 578 148Q578 118 537 56T440 -7H432Q374 -7 337 21T299 94Q299 103 301 116T304 139Q304 164 281 181T235 202L212 206H211Q176 47 160 24Q137 -8 99 -8Z"></path></defs></svg></div><div id="MathJax_Message" style="display: none;"></div><a id="ariaTipText" role="pagedescription" aria-label="欢迎进入 cute 之 简单GEMM实现 - 知乎,盲人用户使用操作智能引导，请按快捷键Ctrl+Alt+R；阅读详细操作说明请按快捷键Ctrl+Alt+问号键。" aria-atomic="true" href="javascript:void(0)" class="skipAutoFix" style="width: 1px; height: 1px;"><img src="https://zhuanlan.zhihu.com/p/667521327" style="width:1px !important;height:1px !important;position:absolute;top:0;"></a><div id="root"><div class="App"><div class="LoadingBar  css-55n9hh"></div><div><span style="position:absolute;top:-10000px;left:-10000px" role="log" aria-live="assertive"></span></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;qyjdef&quot;}" data-zop="{&quot;authorName&quot;:&quot;reed&quot;,&quot;itemId&quot;:667521327,&quot;title&quot;:&quot;cute 之 简单GEMM实现&quot;,&quot;type&quot;:&quot;article&quot;}" data-za-detail-view-path-module="PostItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;667521327&quot;}}}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader is-fixed css-1l12z7y" style="width: 1718.86px; top: 0px; left: 0px;"><div class="ColumnPageHeader-content"><a href="https://www.zhihu.com/" aria-label="知乎"><svg viewBox="0 0 64 30" fill="#1772F6" width="64" height="30" class="css-1hlrcxk" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #0751bc;"><path d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z"></path><path d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z"></path><path d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z"></path></svg></a><i class="ColumnPageHeader-Line"></i><div class="ColumnPageHeader-Title"><div class="ColumnPageHeader-TitleName"><span class="ColumnPageHeader-TitleMeta">首发于</span><a class="ColumnLink ColumnPageHeader-TitleColumn" href="https://www.zhihu.com/column/c_1696937812497235968">CUDA高性能编程</a></div></div><div class="ColumnPageHeader-Button"><div class="Popover"><button title="更多" id="Popover1-toggle" aria-haspopup="true" aria-expanded="false" type="button" class="Button ColumnPageHeader-MenuToggler FEfUrdfMIKpQDJDqkjte Button--plain fEPKGkUK5jyc4fUuT0QP"><svg width="24" height="24" viewBox="0 0 24 24" class="Zi Zi--Dots" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></button></div><button type="button" class="Button ColumnPageHeader-WriteButton FEfUrdfMIKpQDJDqkjte Button--blue JmYzaky7MEPMFcJDLNMG"><svg width="24" height="24" viewBox="0 0 24 24" class="Zi Zi--EditSurround" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M4.352 6.804A2.554 2.554 0 0 1 6.905 4.25h6.072a.875.875 0 0 0 0-1.75H6.905a4.304 4.304 0 0 0-4.303 4.304v10.142a4.304 4.304 0 0 0 4.303 4.304h10.143a4.304 4.304 0 0 0 4.304-4.304v-6.071a.875.875 0 0 0-1.75 0v6.071a2.554 2.554 0 0 1-2.554 2.554H6.905a2.554 2.554 0 0 1-2.553-2.554V6.804Z"></path><path d="M20.595 4.731a.875.875 0 1 0-1.237-1.237l-7.763 7.762a.875.875 0 1 0 1.238 1.238l7.762-7.763Z"></path></svg>写文章</button></div></div><div class="ColumnPageHeader-profile"><div class="Popover AppHeader-menu"><button id="Popover4-toggle" aria-haspopup="true" aria-expanded="false" type="button" class="Button AppHeader-profileEntry FEfUrdfMIKpQDJDqkjte Button--plain fEPKGkUK5jyc4fUuT0QP"><img class="Avatar AppHeader-profileAvatar css-fnnb9l" src="./cute 之 简单GEMM实现 - 知乎_files/v2-c58ab06f0991ecef82f9d358f471cfd3_l.jpg" srcset="https://pica.zhimg.com/v2-c58ab06f0991ecef82f9d358f471cfd3_l.jpg?source=32738c0c 2x" alt="点击打开DefTruth的主页"></button></div><div class="Popover ddLajxN_Q0AuobBZjX9m AppHeaderProfileMenu-creatorHintPopover"><div class="AppHeaderProfileMenu-creatorHintToggler" id="Popover5-toggle" aria-haspopup="true" aria-expanded="false"></div></div></div></div><div class="Sticky--holder" style="position: relative; inset: 0px; display: block; float: none; margin: 0px; height: 52px;"></div></div></div><div class="css-78p1r9"><div class="css-18bmt9c"><div class="css-1ld0bim"><span style="box-sizing: border-box; display: block; overflow: hidden; width: initial; height: initial; background: none; opacity: 1; border: 0px; margin: 0px; padding: 0px; --darkreader-inline-bgimage: none; --darkreader-inline-bgcolor: initial; --darkreader-inline-border-top: 0px; --darkreader-inline-border-right: 0px; --darkreader-inline-border-bottom: 0px; --darkreader-inline-border-left: 0px;" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><picture><source type="image/avif" srcset="https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.avis?source=172ae18b&amp;biz_tag=Post 1x, https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.avis?source=172ae18b&amp;biz_tag=Post 2x" src="https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.avis?source=172ae18b&amp;biz_tag=Post"><source type="image/webp" srcset="https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.awebp?source=172ae18b&amp;biz_tag=Post 1x, https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.awebp?source=172ae18b&amp;biz_tag=Post 2x" src="https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.awebp?source=172ae18b&amp;biz_tag=Post"><img alt="cute 之 简单GEMM实现" decoding="async" style="position: absolute; inset: 0px; box-sizing: border-box; padding: 0px; border: none; margin: auto; display: block; width: 0px; height: 0px; min-width: 100%; max-width: 100%; min-height: 100%; max-height: 100%; --darkreader-inline-border-top: none; --darkreader-inline-border-right: none; --darkreader-inline-border-bottom: none; --darkreader-inline-border-left: none;" width="100%" src="./cute 之 简单GEMM实现 - 知乎_files/v2-689e4c7afc578c580763b34c7bed1d02_1440w.image" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="" srcset="https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.image?source=172ae18b&amp;biz_tag=Post 1x, https://pic1.zhimg.com/70/v2-689e4c7afc578c580763b34c7bed1d02_1440w.image?source=172ae18b&amp;biz_tag=Post 2x"></picture></span></div></div></div><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">cute 之 简单GEMM实现</h1><div class="Post-Author"><div class="AuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="AuthorInfo"><meta itemprop="name" content="reed"><meta itemprop="image" content="https://pic1.zhimg.com/v2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=172ae18b"><meta itemprop="url" content="https://www.zhihu.com/people/reed-84-49"><meta itemprop="zhihu:followerCount"><span class="UserLink AuthorInfo-avatarWrapper"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/reed-84-49" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar AuthorInfo-avatar css-1syywx2" src="./cute 之 简单GEMM实现 - 知乎_files/v2-e9c299bcbb6d098601ce529e9a358d82_l.jpg" srcset="https://pic1.zhimg.com/v2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=172ae18b 2x" alt="reed"></a></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/reed-84-49" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">reed</a></div><a href="https://www.zhihu.com/question/48510028" target="_blank" class="css-4gq0sj" aria-label="中国科学院大学 理学博士" data-tooltip="中国科学院大学 理学博士"><span style="display:inline-flex;align-items:center">​<svg width="18" height="18" fill="none" viewBox="0 0 24 24" class="ZDI ZDI--BadgeCertNewStrokeLightFill24 css-1ldqog6"><path fill="#fff" d="M12 2c-2.02.05-1.86 1.2-3.38 1.83-1.48.61-2.33-.26-3.69 1.1-1.39 1.47-.46 2.17-1.1 3.69C3.2 10.14 2.05 9.98 2 12c.05 2.02 1.2 1.86 1.83 3.38.63 1.52-.3 2.22 1.1 3.69 1.36 1.35 2.21.49 3.69 1.1 1.52.63 1.36 1.78 3.38 1.83 2.02-.05 1.86-1.2 3.38-1.83 1.48-.61 2.33.26 3.69-1.1 1.39-1.47.46-2.16 1.1-3.69.63-1.52 1.78-1.36 1.83-3.38-.05-2.02-1.2-1.86-1.83-3.38-.63-1.52.3-2.22-1.1-3.69-1.36-1.35-2.21-.49-3.69-1.1C13.86 3.2 14.02 2.05 12 2Z" style="fill: rgb(255, 255, 255); fill-opacity: 1; --darkreader-inline-fill: #e8e6e3;" data-darkreader-inline-fill=""></path><path fill="url(#id-106203557-a)" fill-rule="evenodd" d="M3 12c0 1.449 1.035 1.251 1.755 2.997s-.144 2.34.882 3.366c1.026 1.026 1.62.153 3.366.882C10.749 19.965 10.551 21 12 21c1.449 0 1.251-1.035 2.997-1.755s2.34.144 3.366-.882c1.026-1.026.153-1.62.882-3.366C19.965 13.251 21 13.44 21 12c0-1.449-1.035-1.251-1.755-2.997s.144-2.34-.882-3.366c-1.026-1.026-1.62-.153-3.366-.882C13.251 4.035 13.449 3 12 3c-1.449 0-1.251 1.035-2.997 1.755s-2.34-.144-3.366.882c-1.026 1.026-.153 1.62-.882 3.366C4.035 10.749 3 10.551 3 12Z" clip-rule="evenodd"></path><path fill="#fff" fill-rule="evenodd" d="m10.003 15.355-2.37-2.699s-.413-.634.217-1.226c.63-.591 1.195-.197 1.195-.197l1.758 1.92 4.226-4.439s.597-.313 1.17.178c.572.49.243 1.244.243 1.244s-3.12 3.472-4.839 5.204c-.881.837-1.6.015-1.6.015Z" clip-rule="evenodd" style="fill: rgb(255, 255, 255); fill-opacity: 1; --darkreader-inline-fill: #e8e6e3;" data-darkreader-inline-fill=""></path><defs><lineargradient id="id-106203557-a" x1="5.7" x2="15.6" y1="5.7" y2="19.2" gradientUnits="userSpaceOnUse"><stop stop-color="#47D3FF" style="stop-color: rgb(71, 211, 255); stop-opacity: 1; --darkreader-inline-stopcolor: #4bd4ff;" data-darkreader-inline-stopcolor=""></stop><stop offset="1" stop-color="#4A7DFF" style="--darkreader-inline-stopcolor: #002da0;" data-darkreader-inline-stopcolor=""></stop></lineargradient></defs></svg></span></a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="ztext AuthorInfo-badgeText css-0">中国科学院大学 理学博士</div></div></div></div></div></div><button type="button" class="Button FollowButton FEfUrdfMIKpQDJDqkjte Button--primary Button--grey epMJl0lFQuYbC7jrwr_o ZdfrHW7Ef5ZjwFiiBJuS">已关注</button></div><div class="LabelContainer-wrapper"><div class="LabelContainer css-36m2wi"><div><div class="css-vphnkw" style="cursor: pointer;"><div class="css-4rl99m"><div class="css-140fcia">创作声明：内容包含虚构创作</div></div><svg width="26" height="26" viewBox="0 0 24 24" fill="#09408e" class="Zi Zi--ArrowDown css-ouwgqw" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #7abbf7;"><path fill-rule="evenodd" d="M17.776 10.517a.875.875 0 0 1-.248 1.212l-5.05 3.335a.875.875 0 0 1-.964 0L6.47 11.73a.875.875 0 1 1 .965-1.46l4.56 3.015 4.568-3.016a.875.875 0 0 1 1.212.248Z" clip-rule="evenodd"></path></svg></div></div></div></div><div><div class="css-dvccr2"><div class="css-1lr85n">sonta、zzk again 等 156 人赞同了该文章</div></div></div><span class="css-z4ujak"></span></header><div class="Post-RichTextContainer"><div class="css-1od93p9"><div class="css-376mun"><div class="css-l44lgl"><div class="css-1sh34mk"><div class="css-s1xz2x"><div><div class="Catalog isCatalogV2 css-17v5fjs" data-za-detail-view-name="正文"><div class="css-8kjoqe"><div class="css-1e6hvbc"><div class="css-zkfaav"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--Catalog24" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M10 5a1 1 0 011-1h10a1 1 0 110 2H11a1 1 0 01-1-1zm4 6a1 1 0 100 2h7a1 1 0 100-2h-7zm0 7a1 1 0 100 2h7a1 1 0 100-2h-7zm-8.335.25a.915.915 0 01-.915-.915V12.75H10a.75.75 0 000-1.5H4.75V6.665c0-.505.41-.915.915-.915H7a.75.75 0 000-1.5H5.665A2.415 2.415 0 003.25 6.665v10.67a2.415 2.415 0 002.415 2.415H10a.75.75 0 000-1.5H5.665z"></path></svg></span><div class="css-5287jj">目录</div></div><div class="css-1ifd8ga">收起</div></div></div><div class="css-vm33ny"><div class="Catalog-content css-a3sv8e"><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_0" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">BLAS约定和深度学习约定</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_1" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">NVidia cuBLAS类库</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_2" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">Tensor表示</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_3" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">以C矩阵为中心的任务划分策略</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_4" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">TiledMMA：主机端选择指令，设备端将分块划分到线程</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_5" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">Loop Over K</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_6" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">实验性能对比</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_7" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">总结</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_667521327_8" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">参考</div></div></div></div></div></div></div></div></div></div><div class="RichText ztext Post-RichText css-1ygg4xu" options="[object Object]"><p data-first-child="" data-pid="GYpSx2rB">前面的文章我们对cute提供的核心数据结构和抽象进行了一系列的介绍，包括<a href="https://zhuanlan.zhihu.com/p/661182311" class="internal" data-za-detail-view-id="1043">Layout</a>、<a href="https://zhuanlan.zhihu.com/p/663093816" class="internal" data-za-detail-view-id="1043">Tensor</a>、<a href="https://zhuanlan.zhihu.com/p/663092747" class="internal" data-za-detail-view-id="1043">MMA</a>和<a href="https://zhuanlan.zhihu.com/p/666232173" class="internal" data-za-detail-view-id="1043">Copy</a>。本文我们将利用这些概念和抽象实现一个简单版本的矩阵乘法。在介绍具体实现之前，我们首先介绍BLAS约定和深度学习对矩阵乘法的需求和约定，然后介绍cuda上的矩阵库cuBLAS和矩阵乘法任务到硬件执行单元的划分策略，最后我们从Tensor构建、切块、划分，执行、拷贝等方面结合代码实现具体介绍了矩阵乘法的实现，同时我们对该版本的实现选取了实际场景中遇到的问题规模进行了实验并对比了该实现的效率。</p><h2 id="h_667521327_0" data-into-catalog-status="">BLAS约定和深度学习约定</h2><p data-pid="9l_wfPri">在科学计算和数值分析领域，经常需要解决矩阵特征值、线性方程（代数）等问题，形成了如EISPACK、LINPACK、LAPACK数学求解库。这些库解决的是偏上层的数学问题，它们共同依赖了更加底层的、更基础的数学库BLAS（<b>B</b>asic <b>L</b>inear <b>A</b>lgebra <b>S</b>ubprograms）。BLAS总共分为三个层次：</p><ul><li data-pid="rzG21vna">第一层是向量操作，如 <span class="ztext-math" data-eeimg="1" data-tex="\bm{y} = \alpha \bm{x} + \bm{y}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.701ex" height="2.148ex" viewBox="0 -667 5038 924.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.599ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-79" x="0" y="0"></use><use href="#MJMAIN-3D" x="868" y="0"></use><use href="#MJMATHI-3B1" x="1924" y="0"></use><use href="#MJMATHBI-78" x="2565" y="0"></use><use href="#MJMAIN-2B" x="3446" y="0"></use><use href="#MJMATHBI-79" x="4447" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">y</mi><mo>=</mo><mi>α</mi><mi mathvariant="bold-italic">x</mi><mo>+</mo><mi mathvariant="bold-italic">y</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-8">\bm{y} = \alpha \bm{x} + \bm{y}</script><span class="tex2jax_ignore math-holder">\bm{y} = \alpha \bm{x} + \bm{y}</span></span></span> 计算问题；</li><li data-pid="vvguv4X2">第二层向量-矩阵操作，如 <span class="ztext-math" data-eeimg="1" data-tex="\bm{y} = \alpha \bm{A} \bm{x} + \beta \bm{y}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;A&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.053ex" height="2.386ex" viewBox="0 -769.3 6481 1027.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.599ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-79" x="0" y="0"></use><use href="#MJMAIN-3D" x="868" y="0"></use><use href="#MJMATHI-3B1" x="1924" y="0"></use><use href="#MJMATHBI-41" x="2565" y="0"></use><use href="#MJMATHBI-78" x="3434" y="0"></use><use href="#MJMAIN-2B" x="4316" y="0"></use><use href="#MJMATHI-3B2" x="5317" y="0"></use><use href="#MJMATHBI-79" x="5890" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">y</mi><mo>=</mo><mi>α</mi><mi mathvariant="bold-italic">A</mi><mi mathvariant="bold-italic">x</mi><mo>+</mo><mi>β</mi><mi mathvariant="bold-italic">y</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-2">\bm{y} = \alpha \bm{A} \bm{x} + \beta \bm{y}</script><span class="tex2jax_ignore math-holder">\bm{y} = \alpha \bm{A} \bm{x} + \beta \bm{y}</span></span></span> 计算问题；</li><li data-pid="i9xYW530">第三层矩阵-矩阵操作，如 <span class="ztext-math" data-eeimg="1" data-tex="\bm{C} = \alpha \bm{A} \bm{B} + \beta \bm{C}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;C&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;A&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;B&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.764ex" height="2.386ex" viewBox="0 -769.3 7218 1027.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.599ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-43" x="0" y="0"></use><use href="#MJMAIN-3D" x="1133" y="0"></use><use href="#MJMATHI-3B1" x="2189" y="0"></use><use href="#MJMATHBI-41" x="2830" y="0"></use><use href="#MJMATHBI-42" x="3699" y="0"></use><use href="#MJMAIN-2B" x="4788" y="0"></use><use href="#MJMATHI-3B2" x="5789" y="0"></use><use href="#MJMATHBI-43" x="6362" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">C</mi><mo>=</mo><mi>α</mi><mi mathvariant="bold-italic">A</mi><mi mathvariant="bold-italic">B</mi><mo>+</mo><mi>β</mi><mi mathvariant="bold-italic">C</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-7">\bm{C} = \alpha \bm{A} \bm{B} + \beta \bm{C}</script><span class="tex2jax_ignore math-holder">\bm{C} = \alpha \bm{A} \bm{B} + \beta \bm{C}</span></span></span> 。</li></ul><p data-pid="5yx1uoKk"><span class="ztext-math" data-eeimg="1" data-tex="\bm{C} = \alpha \bm{A} \bm{B} + \beta \bm{C}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;C&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;A&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;B&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.764ex" height="2.386ex" viewBox="0 -769.3 7218 1027.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.599ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-43" x="0" y="0"></use><use href="#MJMAIN-3D" x="1133" y="0"></use><use href="#MJMATHI-3B1" x="2189" y="0"></use><use href="#MJMATHBI-41" x="2830" y="0"></use><use href="#MJMATHBI-42" x="3699" y="0"></use><use href="#MJMAIN-2B" x="4788" y="0"></use><use href="#MJMATHI-3B2" x="5789" y="0"></use><use href="#MJMATHBI-43" x="6362" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">C</mi><mo>=</mo><mi>α</mi><mi mathvariant="bold-italic">A</mi><mi mathvariant="bold-italic">B</mi><mo>+</mo><mi>β</mi><mi mathvariant="bold-italic">C</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-1">\bm{C} = \alpha \bm{A} \bm{B} + \beta \bm{C}</script><span class="tex2jax_ignore math-holder">\bm{C} = \alpha \bm{A} \bm{B} + \beta \bm{C}</span></span></span> 就是我们常说的GEMM（<b>GE</b>neral <b>M</b>atrix <b>M</b>ultiplication）问题，它也是BLAS第三层次要求解的问题。其中的广义来自于 <span class="ztext-math" data-eeimg="1" data-tex="\alpha"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.488ex" height="1.435ex" viewBox="0 -513.5 640.5 617.9" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.242ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHI-3B1" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-10">\alpha</script><span class="tex2jax_ignore math-holder">\alpha</span></span></span> <span class="ztext-math" data-eeimg="1" data-tex="\beta"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.332ex" height="2.386ex" viewBox="0 -769.3 573.5 1027.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.599ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHI-3B2" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-3">\beta</script><span class="tex2jax_ignore math-holder">\beta</span></span></span>可以是任意数值，<span class="ztext-math" data-eeimg="1" data-tex="\bm{A}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;A&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.019ex" height="2.029ex" viewBox="0 -769.3 869.5 873.6" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.242ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-41" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">A</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-5">\bm{A}</script><span class="tex2jax_ignore math-holder">\bm{A}</span></span></span>和<span class="ztext-math" data-eeimg="1" data-tex="\bm{B}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;B&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.013ex" height="2.029ex" viewBox="0 -769.3 866.5 873.6" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.242ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-42" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">B</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-4">\bm{B}</script><span class="tex2jax_ignore math-holder">\bm{B}</span></span></span>可以是转置的也可以是非转置的，数值精度方面可以是单精度浮点数、双精度浮点数等。BLAS早期实现的时候采用的是数值计算领域的Fortran语言，在Fortran语言中二维数组是列主序的（列优先），所以在BLAS的API中针对AB矩阵的转置情况描述而言，列优先称为Normal（简写为N），行优先则称为Transpose（简写为T），值得注意的是转置与否是针对A B矩阵而言的， <span class="ztext-math" data-eeimg="1" data-tex="\bm{C}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.987ex" height="2.029ex" viewBox="0 -769.3 855.5 873.6" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.242ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-43" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">C</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-9">\bm{C}</script><span class="tex2jax_ignore math-holder">\bm{C}</span></span></span> <span class="ztext-math" data-eeimg="1" data-tex="\bm{D}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.18ex" height="2.029ex" viewBox="0 -769.3 938.5 873.6" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.242ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-44" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">D</mi></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-6">\bm{D}</script><span class="tex2jax_ignore math-holder">\bm{D}</span></span></span> 矩阵必须是列优先的。同时为了区分不同的数值精度，BLAS规定了不同的简写，如单精度浮点为s（缩写自single precision）, 双精度浮点为d （缩写自double precision），单精度复数为c （缩写自complex），双精度浮点复数记为z。所以在附加上数据类型（如单精度浮点）之后函数名字就由gemm变为了sgemm（single precision general matrix multiplation）。同时BLAS约定了矩阵的维度，表示为 <span class="ztext-math" data-eeimg="1" data-tex="\bm{D_{m,n}} = \alpha \bm{A_{m, k}} \bm{B_{k, n}} + \beta \bm{C_{m,n}}"><span></span><span><span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit;" data-darkreader-inline-color=""></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;D&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;m&lt;/mi&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;A&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;m&lt;/mi&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;k&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;B&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;k&lt;/mi&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;C&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;m&lt;/mi&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="30.485ex" height="2.623ex" viewBox="0 -769.3 13125.4 1129.4" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.836ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" data-darkreader-inline-fill="" data-darkreader-inline-stroke="" style="--darkreader-inline-fill: currentColor; --darkreader-inline-stroke: currentColor;"><use href="#MJMATHBI-44" x="0" y="0"></use><g transform="translate(938,-150)"><use transform="scale(0.707)" href="#MJMATHBI-6D" x="0" y="0"></use><use transform="scale(0.707)" href="#MJMAINB-2C" x="1032" y="0"></use><use transform="scale(0.707)" href="#MJMATHBI-6E" x="1352" y="0"></use></g><use href="#MJMAIN-3D" x="2776" y="0"></use><use href="#MJMATHI-3B1" x="3833" y="0"></use><g transform="translate(4473,0)"><use href="#MJMATHBI-41" x="0" y="0"></use><g transform="translate(869,-150)"><use transform="scale(0.707)" href="#MJMATHBI-6D" x="0" y="0"></use><use transform="scale(0.707)" href="#MJMAINB-2C" x="1032" y="0"></use><use transform="scale(0.707)" href="#MJMATHBI-6B" x="1352" y="0"></use></g></g><g transform="translate(6826,0)"><use href="#MJMATHBI-42" x="0" y="0"></use><g transform="translate(866,-150)"><use transform="scale(0.707)" href="#MJMATHBI-6B" x="0" y="0"></use><use transform="scale(0.707)" href="#MJMAINB-2C" x="604" y="0"></use><use transform="scale(0.707)" href="#MJMATHBI-6E" x="924" y="0"></use></g></g><use href="#MJMAIN-2B" x="9173" y="0"></use><use href="#MJMATHI-3B2" x="10173" y="0"></use><g transform="translate(10747,0)"><use href="#MJMATHBI-43" x="0" y="0"></use><g transform="translate(817,-150)"><use transform="scale(0.707)" href="#MJMATHBI-6D" x="0" y="0"></use><use transform="scale(0.707)" href="#MJMAINB-2C" x="1032" y="0"></use><use transform="scale(0.707)" href="#MJMATHBI-6E" x="1352" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="bold-italic">D</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold-italic">m</mi><mo mathvariant="bold">,</mo><mi mathvariant="bold-italic">n</mi></mrow></msub><mo>=</mo><mi>α</mi><msub><mi mathvariant="bold-italic">A</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold-italic">m</mi><mo mathvariant="bold">,</mo><mi mathvariant="bold-italic">k</mi></mrow></msub><msub><mi mathvariant="bold-italic">B</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold-italic">k</mi><mo mathvariant="bold">,</mo><mi mathvariant="bold-italic">n</mi></mrow></msub><mo>+</mo><mi>β</mi><msub><mi mathvariant="bold-italic">C</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold-italic">m</mi><mo mathvariant="bold">,</mo><mi mathvariant="bold-italic">n</mi></mrow></msub></math></span></span><script type="math/tex;mode=inline" id="MathJax-Element-11">\bm{D_{m,n}} = \alpha \bm{A_{m, k}} \bm{B_{k, n}} + \beta \bm{C_{m,n}}</script><span class="tex2jax_ignore math-holder">\bm{D_{m,n}} = \alpha \bm{A_{m, k}} \bm{B_{k, n}} + \beta \bm{C_{m,n}}</span></span></span> ,</p><p data-pid="o6sc2zTP">其中的m，n表示行列数目，k为reduce轴上的数据维度。</p><p data-pid="npo3KM0R">深度学习中也有矩阵乘法所表达的网络层（如Pytorch中Linear层、Tensorflow中的Dense层），但是神经网络中该层的公式可以表达为 <span class="ztext-math" data-eeimg="1" data-tex="y = x \bm{A} + b"><span></span><span><script type="math/tex;mode=inline">y = x \bm{A} + b</script><span class="tex2jax_ignore math-holder">y = x \bm{A} + b</span></span></span>，其中x为input，维度一般为（N, Cin）y为output维度为（N, Cout），b为bias（一般是boardcast语义，此处我们忽略掉）。我们在忽略掉bias同时采用BLAS的矩阵形式描述，则其公式可以变更为 <span class="ztext-math" data-eeimg="1" data-tex="\bm{D} = \bm{A}\bm{B}"><span></span><span><script type="math/tex;mode=inline">\bm{D} = \bm{A}\bm{B}</script><span class="tex2jax_ignore math-holder">\bm{D} = \bm{A}\bm{B}</span></span></span> ，我们可以发现深度学习中需要的也是矩阵乘法的语义，和BLAS类似但是又不完全相同，不同点一深度学习中的公式没有BLAS公式中的 <span class="ztext-math" data-eeimg="1" data-tex="\alpha"><span></span><span><script type="math/tex;mode=inline">\alpha</script><span class="tex2jax_ignore math-holder">\alpha</span></span></span>, 不同点二深度学习中公式没有BLAS中的加法右侧项，不同点三输出的D是行优先的而非BLAS中的列优先。除了公式层面的差异外，深度学习中的层为了计算效率会选用比传统的BLAS中的数据类型更低的精度如半精度和整数量化精度。</p><p data-pid="L1XDpeXf">由于深度学习的输出要求的是行优先的，而BLAS中的约定中输出矩阵D是列优先的，因此当我们借助BLAS类函数完成深度学习的矩阵乘法时，需要对BLAS的公式进行转置变换，即</p><p data-pid="ImvDTE46"><span class="ztext-math" data-eeimg="1" data-tex="\bm{D^{T}} = \alpha \bm{B^TA^T} + \beta \bm{C^{T}}"><span></span><span><script type="math/tex;mode=inline">\bm{D^{T}} = \alpha \bm{B^TA^T} + \beta \bm{C^{T}}</script><span class="tex2jax_ignore math-holder">\bm{D^{T}} = \alpha \bm{B^TA^T} + \beta \bm{C^{T}}</span></span></span> ，同时设置 <span class="ztext-math" data-eeimg="1" data-tex="\alpha"><span></span><span><script type="math/tex;mode=inline">\alpha</script><span class="tex2jax_ignore math-holder">\alpha</span></span></span> 为1， <span class="ztext-math" data-eeimg="1" data-tex="\beta"><span></span><span><script type="math/tex;mode=inline">\beta</script><span class="tex2jax_ignore math-holder">\beta</span></span></span> 为0。由于转置矩阵AB的顺序也发生了变化。使用BLAS实现深度学习矩阵乘法的伪代码调用如下</p><div class="highlight"><pre><code class="language-cpp"><span class="c1">// blas_gemm(D, A, B, trans_a, trans_b, m, n, k, alpha, beta) API specifaction;
</span><span class="c1">//  D = alpha op(A) op(B) + beta C;
</span><span class="c1">// op can be 'N'ormal or 'T'ranspose
</span><span class="c1">// output:
</span><span class="c1">//    D(m, n) column major
</span><span class="c1">// input: 
</span><span class="c1">//    A(m, k) column major
</span><span class="c1">//    B(k, n) column major
</span><span class="c1">//    C(m, n) column major
</span><span class="c1"></span>
<span class="c1">// D(m, n) row major
</span><span class="c1">// A(m, k) row major
</span><span class="c1">// B(k, n) column major
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">linear_layer</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">D</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="o">*</span><span class="n">B</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">T</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">blas_gemm</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="sc">'T'</span><span class="p">,</span> <span class="sc">'N'</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h2 id="h_667521327_1" data-into-catalog-status="">NVidia cuBLAS类库</h2><p data-pid="kdzvl7dj">NVidia使用GPU进行了BLAS加速实现，形成了cuBLAS加速库，cuBLAS除了实现BLAS中的API（Application Programming Interface）还扩展实现了多Batch支持、多GPU支持和针对深度学习加速的混合精度、低精度实现。对于我们深度学习中常用半精度（half precision）的gemm类似于之前的sgemm，在cuBLAS中提供了hgemm（half precision general matrix multiplation）。本质而言cuBLAS是一个大的kernel仓库，其中存储了NVidia针对不同数据类型，计算精度、矩阵维度、地址对齐等维度综合考虑的高度优化的kernel。当用户调用其进行矩阵运算时，cuBLAS会使用特定的方法从这些kernel中选择出一个针对该问题规模和约束的性能较好的实现版本。除了cuBLAS外，NVidia同时针对不同功能需求和性能追求提供了cuBLASLt库等，如图1所示，其对比了NVidia提供的BLAS类库的API复杂度和融合后处理能力。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-6572d63d39e3574bda8adc194429f89f_b.jpg" data-size="normal" data-rawwidth="1900" data-rawheight="596" class="origin_image zh-lightbox-thumb" width="1900" data-original="https://pic4.zhimg.com/v2-6572d63d39e3574bda8adc194429f89f_r.jpg"/></noscript><div><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1900&#39; height=&#39;596&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1900" data-rawheight="596" class="origin_image zh-lightbox-thumb lazy" width="1900" data-original="https://pic4.zhimg.com/v2-6572d63d39e3574bda8adc194429f89f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-6572d63d39e3574bda8adc194429f89f_b.jpg" data-original-token="v2-57e68f14a48698a3f6da8a6c6bac70c9"></div><figcaption>Figure 1. NVidia提供的BLAS类的库对比（引用自参考5）</figcaption></figure><p data-pid="MHdzcZHC">cuBLASLt库是cuBLAS库的基础上提供针对人工智能和机器学习更灵活的应用，它允许用户指定更复杂的输入输出类型、计算类型（解决混合精度的多类型指定问题）等，同时它还提供了启发式算法，允许用户选择底层实现的性能更好的kernel。后续的文章中我们的实验会利用cuBLASLt的这种选择kernel能力，选择候选kernel中最好的那一个作为我们的baseline。本文中实验我们使用cuBLAS选定的kenrel作为baseline。</p><h2 id="h_667521327_2" data-into-catalog-status="">Tensor表示</h2><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-65b6eca19ecac2ba80db7d37354a14f7_b.jpg" data-size="normal" data-rawwidth="1163" data-rawheight="1037" class="origin_image zh-lightbox-thumb" width="1163" data-original="https://pic4.zhimg.com/v2-65b6eca19ecac2ba80db7d37354a14f7_r.jpg"/></noscript><div><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1163&#39; height=&#39;1037&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1163" data-rawheight="1037" class="origin_image zh-lightbox-thumb lazy" width="1163" data-original="https://pic4.zhimg.com/v2-65b6eca19ecac2ba80db7d37354a14f7_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-65b6eca19ecac2ba80db7d37354a14f7_b.jpg" data-original-token="v2-940cc958a5a716f4dbb11cecf4d0efdb"></div><figcaption>Figure 2.  矩阵乘法问题的Tensor表示及其属性</figcaption></figure><p data-pid="FBySY9sa">如图2所示，本文我们研究深度学习中常用的<code>C = AB</code>的矩阵乘法问题，其中矩阵A、B存储在GPU的全局内存中，输出C矩阵将会被存储在全局内存中；维度方面A为m行k列，B为k行n列，输出C为m行n列；数据存储Layout方面，A为行优先，B为列优先，C为行优先。数据类型方面A、B、C都位16bit的半精度浮点数，在cuda中表示为half类型（cute封装为cute::half_t类型）。我们将矩阵ABC的信息形成如下表格，同时将row/column major表示为stride形式，填充上指针变量名称</p><table data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal"><tbody><tr><th>·矩阵</th><th>指针变量</th><th>存储位置</th><th>shape</th><th>stride</th><th>数据类型</th></tr><tr><td>A</td><td>Aptr</td><td>global memory</td><td>(m, k)</td><td>(k, 1)</td><td>half</td></tr><tr><td>B</td><td>Bptr</td><td>global memory</td><td>(k, n)</td><td>(1, k)</td><td>half</td></tr><tr><td>C</td><td>Cptr</td><td>global memory</td><td>(m, n)</td><td>(n, 1)</td><td>half</td></tr></tbody></table><p data-pid="uiYjGtbF">我们将ABC表示为Tensor形式，则可以写出如下kernel代码</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">__global__</span> <span class="kt">void</span> <span class="n">gemm_simple</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">Cptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Aptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Bptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Tensor</span> <span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Aptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Bptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">C</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Cptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span> 
<span class="p">}</span>
</code></pre></div><p data-pid="UJmzWN1L">其中<code>make_gmem_ptr()</code> 函数用于标识tensor指针的存储层次，方便后续使用时能从指针中取出该指针的存储层次。同时，我们修改了Tensor B的矩阵表示形式把它的形状表示(n, k)，对应的stride 为(k, 1); 这样后续的循环的时候我们就可以写成reduce的形式。为了编译时决策和优化，我们把stride中的连续维度1表示为编译时常量的形式，即Int&lt;1&gt;{}，这样后续对矩阵进行操作的时候如果需要用到stride的计算则可以利用编译时的决策和优化减少不必要的运行时运算。</p><h2 id="h_667521327_3" data-into-catalog-status="">以C矩阵为中心的任务划分策略</h2><p data-pid="BDeRLAEo">GPU中有多个SM（Stream Multiprocessor）我们编程时以grid、block的软件层级进行编程来利用这些SM，在矩阵计算中，我们以输出矩阵C作为划分thead block的单元进行任务拆分，也就是说一个thread block完成C矩阵中的一个小块（TileC）的计算任务，如图3所示，我们定义矩阵TileC的大小为kTileM、kTileN，分别表示小块矩阵包含元素的行数目和列数目，根据块状矩阵乘法的公式完成TileC的计算需要A矩阵中的绿色高亮部分和B矩阵的黄色高亮部分，它们的形状分别为(kTileM, k)和(kTileN, k)。我们对AB矩阵的k轴按照kTileK的大小进行分块，则可以将TileC矩阵表达为AB矩阵块的点积运算</p><p data-pid="Rem3fGoy"><span class="ztext-math" data-eeimg="1" data-tex="TileC = \sum_{itile = 0}^{num\_tile}{TileA_{itile} TileB_{itile}}"><span></span><span><script type="math/tex;mode=inline">TileC = \sum_{itile = 0}^{num\_tile}{TileA_{itile} TileB_{itile}}</script><span class="tex2jax_ignore math-holder">TileC = \sum_{itile = 0}^{num\_tile}{TileA_{itile} TileB_{itile}}</span></span></span> </p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-ae0180df02c9320c4bd22cb692a24809_b.jpg" data-size="normal" data-rawwidth="1967" data-rawheight="1175" class="origin_image zh-lightbox-thumb" width="1967" data-original="https://pic2.zhimg.com/v2-ae0180df02c9320c4bd22cb692a24809_r.jpg"/></noscript><div><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1967&#39; height=&#39;1175&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1967" data-rawheight="1175" class="origin_image zh-lightbox-thumb lazy" width="1967" data-original="https://pic2.zhimg.com/v2-ae0180df02c9320c4bd22cb692a24809_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-ae0180df02c9320c4bd22cb692a24809_b.jpg" data-original-token="v2-2d32f6327ef830db3112db2d60789317"></div><figcaption>Figure 3. sliced-k模式的C矩阵为中心的任务划分方法</figcaption></figure><p data-pid="VuOV9-vt">如此，我们在k轴上移动kTileK得到AB上的小块 <span class="ztext-math" data-eeimg="1" data-tex="TileA_{itile}"><span></span><span><script type="math/tex;mode=inline">TileA_{itile}</script><span class="tex2jax_ignore math-holder">TileA_{itile}</span></span></span> 和 <span class="ztext-math" data-eeimg="1" data-tex="TileB_{itile}"><span></span><span><script type="math/tex;mode=inline">TileB_{itile}</script><span class="tex2jax_ignore math-holder">TileB_{itile}</span></span></span> 将他们相乘的积累加到TileC上，便可以得到TileC的计算结果。这种沿着k轴移动的策略称sliced-k方法。这样我们使用一个block（坐标如图blockIdx.x, blockIdx.y）便可以完成C矩阵中一个小块的完整的计算。通过block维度的扩展，如图所示的矩阵C中M轴方向的blockIdx.y和N轴方向的blockIdx.x的扩展，便可以完成整个C矩阵的计算。由此我们可以计算出完成整个C矩阵所需要的gird维度：grid.x = N / kTileN, grid.y = M / kTileM (此处暂时不考虑不可整除的情形)。根据上面的计算过程我们可以继续完善代码，</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileM</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileN</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileK</span><span class="o">&gt;</span>
<span class="n">__global__</span> <span class="kt">void</span> <span class="n">gemm_simple</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">Cptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Aptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Bptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Tensor</span> <span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Aptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Bptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">C</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Cptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>

  <span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iy</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

  <span class="n">Tensor</span> <span class="n">gA</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileM</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileK</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>
  <span class="n">Tensor</span> <span class="n">gB</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileN</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileK</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>
  <span class="n">Tensor</span> <span class="n">gC</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileM</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileN</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">dim3</span> <span class="n">grid</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">kTileN</span><span class="p">,</span> <span class="n">m</span> <span class="o">/</span> <span class="n">kTileM</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div><p data-pid="Zs6T7YQe">如我们上面所述，我们在模版参数中给定划块的超参kTileM、kTileN、kTileK，同时使用Tensor章节中介绍local_tile方法对矩阵进行固定大小的分块，同时通过指定坐标的的全slice方法，得到当前thread block要处理的Tensor gA, gB, gC。和构造Tensor A时类似，我们在进行Tensor分块的时候也将编译时能确定的量进行了<code>Int&lt;&gt;</code>化，用以指示该维度信息是编译时常量，编译器可以在编译阶段完成必要的路径决策和优化计算，避免运行时的开销。同时我们在主函数中给出了grid的大小（如上代码）。值得注意的是，经过<code>local_tile</code>函数我们得到的gA, gB, gC的维度信息如下表格</p><table data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal"><tbody><tr><th>Tensor</th><th>shape</th></tr><tr><td>gA</td><td>(kTileM, kTileK, num_tile_k)</td></tr><tr><td>gB</td><td>(kTileN, kTileK, num_tile_k)</td></tr><tr><td>gC</td><td>(kTileM, kTileN)</td></tr></tbody></table><p data-pid="qsUB3VOj">先选定TileC，然后沿着k轴移动小块进行累加求和的策略为sliced-k，它对于m、n维度较大的场景（m n分块所需要的block数目足以填充所有的SM）比较有效。对于k比较大，而m、n比较小的场景，由于m、n较小而我们根据C来划分thread block，这时需要的thread block数目比较小，当这个数目无法填充所有的SM时，则存在很多SM无任务，而有任务的SM需却又需要循环多次的问题，这时候可以考虑将k轴拆分成多段，每一段都计算一个TileC结果，最后再通过额外的累加过程将多段的结果进行求和，这种模式的任务划分方法成为split-k方法。如图4，把k拆分成两段，由不同的计算单元来完成不同段段段计算，如此则得到多份C，最后将多个C进行累加求和得到最终结果。该方法在特殊场景下有用，而且实现不困难，本文暂不实现该策略。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-d19cbe757a80b24d375ace320fbe52cc_b.jpg" data-size="normal" data-rawwidth="1465" data-rawheight="1259" class="origin_image zh-lightbox-thumb" width="1465" data-original="https://pic1.zhimg.com/v2-d19cbe757a80b24d375ace320fbe52cc_r.jpg"/></noscript><div><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1465&#39; height=&#39;1259&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1465" data-rawheight="1259" class="origin_image zh-lightbox-thumb lazy" width="1465" data-original="https://pic1.zhimg.com/v2-d19cbe757a80b24d375ace320fbe52cc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-d19cbe757a80b24d375ace320fbe52cc_b.jpg" data-original-token="v2-4a3101b8229dff1f06dd26c97bd53bfb"></div><figcaption>Figure 4. split-k策略的计算逻辑</figcaption></figure><p data-pid="vRpR6Hby">除了sliced-k、split-k策略在任务划分方面还有stream-k方法，stream-k方法作者们指出sliced-k或者split-k方法都是静态的划分任务，在划分的任务数目和SM执行单元不能整除的时候，总会在存在某轮（wave）计算中存在SM空闲的问题。stream-k则是抛弃以任务为中心的划分逻辑，而是变成了以计算资源为核心的分配任务方式，使得SM的任务量基本相当，如图5，其展示了假设只有4个SM的情况下，不同任务划分逻辑的差异，其中stream-k对计算资源的利用效果最好，具体可以参考发表在PPoPP‘23上的poster。现阶段cuBLAS中的kernel依然多为sliced-k和split-k实现。本文暂不实现该策略。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-160c03adccbb2bebc40b596b8ecd2214_b.jpg" data-size="normal" data-rawwidth="3000" data-rawheight="1190" class="origin_image zh-lightbox-thumb" width="3000" data-original="https://pic1.zhimg.com/v2-160c03adccbb2bebc40b596b8ecd2214_r.jpg"/></noscript><div><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;3000&#39; height=&#39;1190&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="3000" data-rawheight="1190" class="origin_image zh-lightbox-thumb lazy" width="3000" data-original="https://pic1.zhimg.com/v2-160c03adccbb2bebc40b596b8ecd2214_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-160c03adccbb2bebc40b596b8ecd2214_b.jpg" data-original-token="v2-bdb3faaa1c712497cf182aa71945c53d"></div><figcaption>Figure 5. stream-k策略任务划分逻辑（引用自PPoPP23: Stream-K）</figcaption></figure><h2 id="h_667521327_4" data-into-catalog-status="">TiledMMA：主机端选择指令，设备端将分块划分到线程</h2><p data-pid="gpco-EVL">前面经过把C++ pointer封装成Tensor，然后利用<code>local_tile</code>将Tensor划分成小块，我们便可以得到一个thread block需要处理的任务。这时，假设我们通过前面MMA章节构造了一个TiledMMA能力，则借助其方法我们便可以通过ThrMMA的partition_A/B/C方法实现对TileA、TileB、TileC、的划分，通过partition_fragment_A/B/C便可以构造矩阵乘所需要的寄存器表示。通过cute::gemm方法便可以完成线程级别寄存器表示的矩阵乘法。具体的kernel代码为</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileM</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileN</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileK</span><span class="p">,</span> <span class="k">typename</span> <span class="n">TiledMMA</span><span class="o">&gt;</span>
<span class="n">__global__</span> <span class="kt">void</span> <span class="n">gemm_simple</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">Cptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Aptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Bptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Tensor</span> <span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Aptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Bptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">C</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Cptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>

  <span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iy</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

  <span class="n">Tensor</span> <span class="n">gA</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileM</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileK</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>
  <span class="n">Tensor</span> <span class="n">gB</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileN</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileK</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>
  <span class="n">Tensor</span> <span class="n">gC</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileM</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileN</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">));</span>
  <span class="c1">//  gA(kTileM, kTileK, num_tile_k)
</span><span class="c1"></span>  <span class="c1">//  gB(kTileN, kTileK, num_tile_k)
</span><span class="c1"></span>  <span class="c1">//  gC(kTileM, kTileN) 
</span><span class="c1"></span>
  <span class="n">TiledMMA</span> <span class="n">tiled_mma</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">thr_mma</span> <span class="o">=</span> <span class="n">tiled_mma</span><span class="p">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">tAgA</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_A</span><span class="p">(</span><span class="n">gA</span><span class="p">);</span>  <span class="c1">// (MMA, MMA_M, MMA_K, num_tile_k)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tBgB</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_B</span><span class="p">(</span><span class="n">gB</span><span class="p">);</span>  <span class="c1">// (MMA, MMA_N, MMA_K, num_tile_k)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tCgC</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_C</span><span class="p">(</span><span class="n">gC</span><span class="p">);</span>  <span class="c1">// (MMA, MMA_M, MMA_N)
</span><span class="c1"></span>
  <span class="k">auto</span> <span class="n">tArA</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_fragment_A</span><span class="p">(</span><span class="n">gA</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>  <span class="c1">// (MMA, MMA_M, MMA_K)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tBrB</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_fragment_B</span><span class="p">(</span><span class="n">gB</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>  <span class="c1">// (MMA, MMA_N, MMA_K)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tCrC</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_fragment_C</span><span class="p">(</span><span class="n">gC</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>     <span class="c1">// (MMA, MMA_M, MMA_N)
</span><span class="c1"></span> 
  <span class="n">clear</span><span class="p">(</span><span class="n">tCrC</span><span class="p">);</span> 
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="n">mma_op</span> <span class="o">=</span> <span class="n">SM80_16x8x16_F16F16F16F16_TN</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">mma_traits</span> <span class="o">=</span> <span class="n">MMA_Traits</span><span class="o">&lt;</span><span class="n">mma_op</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">mma_atom</span> <span class="o">=</span> <span class="n">MMA_Atom</span><span class="o">&lt;</span><span class="n">mma_traits</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="k">auto</span> <span class="n">MMA</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="n">make_tiled_mma</span><span class="p">(</span><span class="n">mma_atom</span><span class="p">{},</span> 
                      <span class="n">make_layout</span><span class="p">(</span><span class="n">Shape</span><span class="o">&lt;</span><span class="n">_2</span><span class="p">,</span> <span class="n">_2</span><span class="p">,</span> <span class="n">_1</span><span class="o">&gt;</span><span class="p">{}),</span> 
                      <span class="n">make_layout</span><span class="p">(</span><span class="n">Shape</span><span class="o">&lt;</span><span class="n">_1</span><span class="p">,</span> <span class="n">_2</span><span class="p">,</span> <span class="n">_1</span><span class="o">&gt;</span><span class="p">{})));</span>
  <span class="n">dim3</span> <span class="n">block</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">MMA</span><span class="p">{}));</span>
  <span class="n">dim3</span> <span class="n">grid</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">kTileN</span><span class="p">,</span> <span class="n">m</span> <span class="o">/</span> <span class="n">kTileM</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div><p data-pid="9lKQo5lV">其中<code>get_slice</code>函数能够将TiledMMA能力根据具体的线程id得到每一个线程所需要的layout信息。利用partition函数实现对gA gB gC的矩阵在线程级别的分解，经过partition后得到的维度信息为(MMA, MMA_M, MMA_K, num_tile_k)，其中MMA表示TiledMMA一次能做的矩阵运算所需要的数据，MMA_M、MMA_K表示(kTileM, kTileK)按照TiledMMA能力去划分的时候，M方向和K方向需要重复多少次才能完成该矩阵乘法，即M K方向需要循环多少遍TildMMA才能完成计算，而num_tile_k则为将gA的维度自然带入下来。也就是说partition_A的逻辑本质上是将Tensor的前两维进行划分，划分后得到一个三维的结果，其中第一维度表示TiledMMA单次所能处理的数据，接下来的两维表示两个方向上的重复，而如果被partition的维度再多，则后续的维度自然的继承下来即可。partition_fragment类函数和前面的类似，只是其返回的是寄存器声明。同时我们注意到对于partition_fragment_A/B，我们输入的gA时保留了前两个维度，对第三个维度我们选择了位置0，这就等价于传递给partition_fragment_A/B的是形状为(kTileM, kTileK)、（kTileN, kTileK）的Tensor。自然的其返回的结果形状也是类似的：第一维表示TiledMMA单次能力所需的数据，接下来的两维表示对TileMMA能力在M方向和K方向的重复次数。在得到TileC的寄存器表示后，我们使用clear方法将其初始化为0，以备后面进行矩阵乘法时的累加操作。</p><p data-pid="JWOP7I3C">在main函数中，我们选择使用Ampere架构提供的16x8x16的Tensor Core矩阵乘法指令，数据精度和计算精度都为fp16。然后通过MMA_Traits得到mma_traits，继续将traits转换成MMA_Atom。我们知道SM80的Tensor Core执行是warp level的，也就是说这个MMA_Atom是32个线程，我们对MMA_Atom能力通过增加线程的方式进行M、N方向的重复，同时我们让B矩阵C矩阵使用更多寄存器在N方向扩展2次，得到main函数中的MMA类型。这样，我们便可以得到TiledMMA需要32x2x2 = 128线程，其能处理的矩阵的大小: M = 16 x 2 x 1 = 32, N = 8 x 2 x 2 = 32, K = 16 x 1 x 1 = 16, 即TiledMMA能处理的MNK为32x32x16。</p><h2 id="h_667521327_5" data-into-catalog-status="">Loop Over K</h2><p data-pid="Upnm7ESm">有了TiledMMA的数据划分之后，我们调用<code>cute::gemm</code>即可以完成 <code>C[kTileM, kTileN] =A[kTileM, kTilleK] B[kTileN, kTileK]</code>利用Tensor Core进行矩阵乘的能力，我们对其进行这个块沿着k方向循环便可以得到最总的矩阵计算结果，实现如下</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileM</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileN</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kTileK</span><span class="p">,</span> <span class="k">typename</span> <span class="n">TiledMMA</span><span class="o">&gt;</span>
<span class="n">__global__</span> <span class="kt">void</span> <span class="n">gemm_simple</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">Cptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Aptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">Bptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Tensor</span> <span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Aptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Bptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>
  <span class="n">Tensor</span> <span class="n">C</span> <span class="o">=</span> <span class="n">make_tensor</span><span class="p">(</span><span class="n">make_gmem_ptr</span><span class="p">(</span><span class="n">Cptr</span><span class="p">),</span> <span class="n">make_shape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">make_stride</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Int</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">{}));</span>

  <span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iy</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

  <span class="n">Tensor</span> <span class="n">gA</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileM</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileK</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>
  <span class="n">Tensor</span> <span class="n">gB</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileN</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileK</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>
  <span class="n">Tensor</span> <span class="n">gC</span> <span class="o">=</span> <span class="n">local_tile</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">make_tile</span><span class="p">(</span><span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileM</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">Int</span><span class="o">&lt;</span><span class="n">kTileN</span><span class="o">&gt;</span><span class="p">{}),</span> <span class="n">make_coord</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">));</span>
  <span class="c1">//  gA(kTileM, kTileK, num_tile_k)
</span><span class="c1"></span>  <span class="c1">//  gB(kTileN, kTileK, num_tile_k)
</span><span class="c1"></span>  <span class="c1">//  gC(kTileM, kTileN) 
</span><span class="c1"></span>
  <span class="n">TiledMMA</span> <span class="n">tiled_mma</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">thr_mma</span> <span class="o">=</span> <span class="n">tiled_mma</span><span class="p">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">tAgA</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_A</span><span class="p">(</span><span class="n">gA</span><span class="p">);</span>  <span class="c1">// (MMA, MMA_M, MMA_K, num_tile_k)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tBgB</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_B</span><span class="p">(</span><span class="n">gB</span><span class="p">);</span>  <span class="c1">// (MMA, MMA_N, MMA_K, num_tile_k)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tCgC</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_C</span><span class="p">(</span><span class="n">gC</span><span class="p">);</span>  <span class="c1">// (MMA, MMA_M, MMA_N)
</span><span class="c1"></span>
  <span class="k">auto</span> <span class="n">tArA</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_fragment_A</span><span class="p">(</span><span class="n">gA</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>  <span class="c1">// (MMA, MMA_M, MMA_K)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tBrB</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_fragment_B</span><span class="p">(</span><span class="n">gB</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>  <span class="c1">// (MMA, MMA_N, MMA_K)
</span><span class="c1"></span>  <span class="k">auto</span> <span class="n">tCrC</span> <span class="o">=</span> <span class="n">thr_mma</span><span class="p">.</span><span class="n">partition_fragment_C</span><span class="p">(</span><span class="n">gC</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>     <span class="c1">// (MMA, MMA_M, MMA_N)
</span><span class="c1"></span> 
  <span class="n">clear</span><span class="p">(</span><span class="n">tCrC</span><span class="p">);</span>
  
  <span class="kt">int</span> <span class="n">num_tile_k</span> <span class="o">=</span> <span class="n">size</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">gA</span><span class="p">);</span>
<span class="cp">#pragma unroll 1
</span><span class="cp"></span>  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">itile</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">itile</span> <span class="o">&lt;</span> <span class="n">num_tile_k</span><span class="p">;</span> <span class="o">++</span><span class="n">itle</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cute</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">tAgA</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">itile</span><span class="p">),</span> <span class="n">tArA</span><span class="p">);</span>
    <span class="n">cute</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">tBgB</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">itile</span><span class="p">),</span> <span class="n">tBrB</span><span class="p">);</span>

    <span class="n">cute</span><span class="o">::</span><span class="n">gemm</span><span class="p">(</span><span class="n">tiled_mma</span><span class="p">,</span> <span class="n">tCrC</span><span class="p">,</span> <span class="n">tArA</span><span class="p">,</span> <span class="n">tBrB</span><span class="p">,</span> <span class="n">tCrC</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">cute</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">tCrC</span><span class="p">,</span> <span class="n">tCgC</span><span class="p">);</span> 
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="n">mma_op</span> <span class="o">=</span> <span class="n">SM80_16x8x16_F16F16F16F16_TN</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">mma_traits</span> <span class="o">=</span> <span class="n">MMA_Traits</span><span class="o">&lt;</span><span class="n">mma_op</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">mma_atom</span> <span class="o">=</span> <span class="n">MMA_Atom</span><span class="o">&lt;</span><span class="n">mma_traits</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="k">auto</span> <span class="n">MMA</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="n">make_tiled_mma</span><span class="p">(</span><span class="n">mma_atom</span><span class="p">{},</span> 
                      <span class="n">make_layout</span><span class="p">(</span><span class="n">Shape</span><span class="o">&lt;</span><span class="n">_2</span><span class="p">,</span> <span class="n">_2</span><span class="p">,</span> <span class="n">_1</span><span class="o">&gt;</span><span class="p">{}),</span> 
                      <span class="n">make_layout</span><span class="p">(</span><span class="n">Shape</span><span class="o">&lt;</span><span class="n">_1</span><span class="p">,</span> <span class="n">_2</span><span class="p">,</span> <span class="n">_1</span><span class="o">&gt;</span><span class="p">{})));</span>
  <span class="n">dim3</span> <span class="n">block</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">MMA</span><span class="p">{}));</span>
  <span class="n">dim3</span> <span class="n">grid</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">kTileN</span><span class="p">,</span> <span class="n">m</span> <span class="o">/</span> <span class="n">kTileM</span><span class="p">);</span>
  <span class="n">gemm_simple</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">kTileM</span><span class="p">,</span> <span class="n">kTileN</span><span class="p">,</span> <span class="n">kTileK</span><span class="p">,</span> <span class="n">MMA</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Cptr</span><span class="p">,</span> <span class="n">Aptr</span><span class="p">,</span> <span class="n">Bptr</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div><p data-pid="vp4LBla4">通过gA我们可以获取k方向的tile需要循环的次数num_tile_k，然后利用sliced-k模式循环k方向的tile，通过<code>cute::copy</code>实现全局内存到寄存器到直接copy，数据拷贝到寄存器后通过<code>cute::gemm</code>完成Tile块的矩阵乘法。在循环结束后再次利用<code>cute::copy</code>实现寄存器到全局内存的写出。<code>cute::copy</code>在不指定Copy_Atom时采用<code>UniversalCopy</code>实现，即简单的cuda语言层面的<code>T d = s</code>形式。到此，我们已经可以使用TileMMA 和 cute::copy实现简单的矩阵乘法。</p><h2 id="h_667521327_6" data-into-catalog-status="">实验性能对比</h2><p data-pid="YotiEynG">我们选定了一个实际深度学习推理中会使用到的矩阵的大小(M, N, K) = （81920，256，256），选定(kTileM, kTileN, kTileK) = (128, 128, 32)，在RTX 3090显卡上进行了相应的实验，其中操作系统版本为Ubuntu 20.04.6 LTS，CUDA 驱动版本为535.113.01，编译器NVCC版本为V11.7.64。我们实现的kernel和cuBLAS选定的kernel分别调用100次取kernel平均的耗时，得到如下表格，实现及测试代码见<a href="https://link.zhihu.com/?target=https%3A//github.com/reed-lau/cute-gemm" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/reed-lau/cut</span><span class="invisible">e-gemm</span><span class="ellipsis"></span></a>。</p><table data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal"><tbody><tr><th>方法</th><th>平均耗时(us)（实验100次取平均）</th></tr><tr><td>gemm_simple</td><td>218</td></tr><tr><td>ampere_h16816gemm_256x128_ldg8_stages_32x3_tn</td><td>138</td></tr></tbody></table><p data-pid="_F7yuBBB">我们看到cuBLAS中选择的kernel为ampere架构的实现，我们的简单实现版本比cuBLAS中的实现还有很大差距，在后续的文章中我们会通过在该实现上进行优化最终达到甚至超越这个实现效率。</p><h2 id="h_667521327_7" data-into-catalog-status="">总结</h2><p data-pid="laoc42BR">本文我们介绍了cuBLAS的矩阵乘法约定和深度学习中的约定，介绍了矩阵任务向硬件模型划分任务的常用方法，最后通过cute提供的Layout、Tensor，TiledMMA和Copy功能实现了简单的gemm，针对特定的规格进行了性能对比实验，结果显示该简单实现可以达到cuBLAS的60%的效率。后续我们会在该版本基础上进行进一步优化，最终实现SOTA的gemm能力。</p><h2 id="h_667521327_8" data-into-catalog-status="">参考</h2><p data-pid="S6BGP8GO"><a href="https://link.zhihu.com/?target=http%3A//history.siam.org/pdfs2/Dongarra_%2520returned_SIAM_copy.pdf" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">history.siam.org/pdfs2/</span><span class="invisible">Dongarra_%20returned_SIAM_copy.pdf</span><span class="ellipsis"></span></a></p><p data-pid="f8jLMNaR"><a href="https://link.zhihu.com/?target=https%3A//pytorch.org/docs/stable/generated/torch.nn.Linear.html" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">pytorch.org/docs/stable</span><span class="invisible">/generated/torch.nn.Linear.html</span><span class="ellipsis"></span></a></p><p data-pid="dX4vXDyv"><a href="https://link.zhihu.com/?target=https%3A//www.tensorflow.org/api_docs/python/tf/keras/layers/Dense" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">tensorflow.org/api_docs</span><span class="invisible">/python/tf/keras/layers/Dense</span><span class="ellipsis"></span></a></p><p data-pid="wzF4d4Ws"><a href="https://link.zhihu.com/?target=https%3A//developer.nvidia.com/cublas" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">developer.nvidia.com/cu</span><span class="invisible">blas</span><span class="ellipsis"></span></a></p><p data-pid="d4PcaA_n"><a href="https://link.zhihu.com/?target=https%3A//developer.nvidia.com/blog/new-cublas-12-0-features-and-matrix-multiplication-performance-on-nvidia-hopper-gpus" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">developer.nvidia.com/bl</span><span class="invisible">og/new-cublas-12-0-features-and-matrix-multiplication-performance-on-nvidia-hopper-gpus</span><span class="ellipsis"></span></a></p><p data-pid="5gKRYC8S"><a href="https://link.zhihu.com/?target=https%3A//dl.acm.org/doi/10.1145/3572848.3577479" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">dl.acm.org/doi/10.1145/</span><span class="invisible">3572848.3577479</span><span class="ellipsis"></span></a></p></div></div></div></div><div role="button" tabindex="0" class="ContentItem-time">编辑于 2023-11-19 15:11<!-- -->・IP 属地中国香港</div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic css-ch8ocw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19570902&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19570902" target="_blank"><div class="css-1gomreu">GPU 通用计算</div></a></span></div><div class="Tag Topic css-ch8ocw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19608622&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19608622" target="_blank"><div class="css-1gomreu">高性能计算</div></a></span></div><div class="Tag Topic css-ch8ocw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19551275&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19551275" target="_blank"><div class="css-1gomreu">人工智能</div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-fixed is-bottom" style="width: 690px; bottom: 0px; left: 514.429px;"><div class="ContentItem-actions" data-za-detail-view-path-module="BottomBar" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;667521327&quot;,&quot;token&quot;:&quot;667521327&quot;}}}"><span><button aria-label="已赞同 156 " aria-live="polite" type="button" class="Button VoteButton VoteButton--up is-active FEfUrdfMIKpQDJDqkjte"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023Z" clip-rule="evenodd"></path></svg></span>已赞同 156</button><button aria-label="反对" aria-live="polite" type="button" class="Button VoteButton VoteButton--down FEfUrdfMIKpQDJDqkjte"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" class="Zi Zi--TriangleDown" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M13.792 20.319c-.781 1.406-2.803 1.406-3.584 0L2.418 6.296c-.76-1.367.228-3.046 1.791-3.046h15.582c1.563 0 2.55 1.68 1.791 3.046l-7.79 14.023Z" clip-rule="evenodd"></path></svg></span></button></span><button type="button" class="Button BottomActions-CommentBtn FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Comment Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>43 条评论</button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover2-toggle" aria-haspopup="true" aria-expanded="false"><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Share Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M19.47 1.914a.8.8 0 0 1 1.204.778l-1.872 16.386a.9.9 0 0 1-1.204.743l-4.615-1.692a.7.7 0 0 0-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 0 1 .179-.504l5.808-7.148a.595.595 0 0 0-.897-.781l-5.93 6.354a1.1 1.1 0 0 1-1.258.252L2.57 13.46a.8.8 0 0 1-.08-1.415l16.98-10.13Z"></path></svg></span>分享</button></div></div><button aria-live="polite" type="button" class="Button ContentItem-action FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Heart Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Star Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M10.484 3.307c.673-1.168 2.358-1.168 3.032 0l2.377 4.122a.25.25 0 0 0 .165.12l4.655.987c1.319.28 1.84 1.882.937 2.884l-3.186 3.535a.25.25 0 0 0-.063.193l.5 4.733c.142 1.34-1.222 2.33-2.453 1.782l-4.346-1.938a.25.25 0 0 0-.204 0l-4.346 1.938c-1.231.549-2.595-.442-2.453-1.782l.5-4.733a.25.25 0 0 0-.064-.193L2.35 11.42c-.903-1.002-.382-2.604.937-2.884l4.655-.987a.25.25 0 0 0 .164-.12l2.378-4.122Z"></path></svg></span>收藏</button><button type="button" class="Button ContentItem-action FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Deliver Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><g fill-rule="evenodd" clip-rule="evenodd"><path d="M7.821 12a.75.75 0 0 1 .75-.75h6.857a.75.75 0 0 1 0 1.5H8.571a.75.75 0 0 1-.75-.75ZM8.965 8a.75.75 0 0 1 .75-.75h4.571a.75.75 0 0 1 0 1.5H9.715a.75.75 0 0 1-.75-.75Z"></path><path d="M7.527 3.15a2.35 2.35 0 0 0-2.309 1.91L3.165 15.84a.85.85 0 0 0-.015.16v2.5a2.35 2.35 0 0 0 2.35 2.35h13a2.35 2.35 0 0 0 2.35-2.35V16a.848.848 0 0 0-.015-.16L18.78 5.06a2.35 2.35 0 0 0-2.308-1.91H7.527Zm0 1.7a.65.65 0 0 0-.639.528l-1.88 9.872h13.984l-1.88-9.872a.65.65 0 0 0-.64-.528H7.528Z"></path></g></svg></span>申请转载</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="Popover3-toggle" aria-haspopup="true" aria-expanded="false"><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--iconOnly fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY hIwDV_tcL6XN1HprrnAq"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Dots Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></span></button></div></div></div></div><div class="Post-SideActions" style="opacity: 1;"><button class="like active"><div class="Post-SideActions-icon"><svg width="16" height="16" viewBox="0 0 24 24" class="Zi Zi--TriangleUp Post-SideActions-upIcon" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023Z" clip-rule="evenodd"></path></svg></div><div class="likeCount"><div class="likeCount-inner" data-previous="赞同 155">已赞同 156</div></div></button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover10-toggle" aria-haspopup="true" aria-expanded="false"><button><div class="Post-SideActions-icon"><span style="display: inline-flex; align-items: center;">​<svg width="20" height="20" viewBox="0 0 24 24" class="Zi Zi--Share" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M19.47 1.914a.8.8 0 0 1 1.204.778l-1.872 16.386a.9.9 0 0 1-1.204.743l-4.615-1.692a.7.7 0 0 0-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 0 1 .179-.504l5.808-7.148a.595.595 0 0 0-.897-.781l-5.93 6.354a1.1 1.1 0 0 1-1.258.252L2.57 13.46a.8.8 0 0 1-.08-1.415l16.98-10.13Z"></path></svg></span></div>分享</button></div></div></div></div><div class="Sticky--holder" style="position: static; inset: auto auto 0px 0px; display: block; float: none; margin: 0px 0px 10px; height: 53.7143px;"></div></div></article><div class="Post-Sub Post-NormalSub"><div style="overflow: unset;" data-za-detail-view-path-module="CommentList" data-za-extra-module="{}"><div class="Comments-container css-plbgu"><div class="css-79elbk"><div><div class="css-1fo89v5"><img class="Avatar css-m4psdq" src="./cute 之 简单GEMM实现 - 知乎_files/v2-c58ab06f0991ecef82f9d358f471cfd3_l.jpg" srcset="https://pica.zhimg.com/v2-c58ab06f0991ecef82f9d358f471cfd3_l.jpg?source=32738c0c 2x"><div class="css-14zbeoe"><div class="css-i6bazn"><div class="css-0"><div class="InputLike css-1rl4wxv Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 38px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-9c3gn" style="white-space: pre-wrap;">理性发言，友善互动</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-9c3gn" class="notranslate public-DraftEditor-content" contenteditable="true" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word; --darkreader-inline-outline: initial;" data-darkreader-inline-outline="" role="textbox"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="9c3gn" data-offset-key="4r3if-0-0"><div data-offset-key="4r3if-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="4r3if-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;"></div></div></div></div></div></div><div class="css-u76jt1"><div class="css-1onritu"><div class="css-r4op92"><div class="css-1k10w8f">43 条评论</div></div><div class="css-59erns"></div><div class="css-97fdvh"><div class="css-m0zh86">默认</div><div class="css-1fjr6cy">最新</div></div></div><div class="css-840pn3"><div class="css-18ld3w0"><div data-id="10732833015"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/c79dd4640405a26cfa1c2fc65b03ba62" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-34de08be03d3e6e5d1dc32d45ed4a5bb_l.jpg" srcset="https://picx.zhimg.com/v2-34de08be03d3e6e5d1dc32d45ed4a5bb_l.jpg?source=06d4cd63 2x" alt="kenjewu" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/c79dd4640405a26cfa1c2fc65b03ba62" target="_blank" class="css-10u695f">kenjewu</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>写得很好，逻辑也很清晰，期待后续把 SharedMemory, BankConflict, Double Buffer 这些优化技巧逐步写上来。真的很赞.<img src="./cute 之 简单GEMM实现 - 知乎_files/v2-c71427010ca7866f9b08c37ec20672e0.png" class="sticker" alt="[赞]"></p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-11-20</span><span> · </span><span class="css-ntkn7q" href="">IP 属地四川</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>5</button></div></div></div></div></div><div data-id="10733869058"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/236dedf0a4bc04040b68aea7e2e6e06a" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-8700f69f73463e7575b7a58c7ccc95e2_l.jpg" srcset="https://pica.zhimg.com/v2-8700f69f73463e7575b7a58c7ccc95e2_l.jpg?source=06d4cd63 2x" alt="zzk again" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/236dedf0a4bc04040b68aea7e2e6e06a" target="_blank" class="css-10u695f">zzk again</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-8v0dsd" href="">我关注的人</span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>写的非常赞，这么看下来cute确实比cutlass本身清晰简单很多。。<img src="./cute 之 简单GEMM实现 - 知乎_files/v2-76c864a7fd5ddc110965657078812811.png" class="sticker" alt="[调皮]"></p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-11-21</span><span> · </span><span class="css-ntkn7q" href="">IP 属地广东</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>4</button></div></div></div></div></div><div data-id="10742920920"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/319207f87f154964fafae2135d60b420" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-e5aeb4872c80f1b3edccc46617dfe3de_l.jpg" srcset="https://pica.zhimg.com/v2-e5aeb4872c80f1b3edccc46617dfe3de_l.jpg?source=06d4cd63 2x" alt="Ohge" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/319207f87f154964fafae2135d60b420" target="_blank" class="css-10u695f">Ohge</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>auto MMA = decltype(make_tiled_mma(mma_atom{}, <br>                      make_layout(Shape&lt;_2, _2, _1&gt;{}), <br>                      make_layout(Shape&lt;_1, _2, _1&gt;{})));<br><br>请教一下这里的两个Shape是什么意思呢？</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-12-03</span><span> · </span><span class="css-ntkn7q" href="">IP 属地上海</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>2</button></div></div></div></div><div data-id="10831049423"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/defc5241d77d0c549fa1962460fb8183" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-47edc3a0c442f9e393c552fde4bcb2e6_l.jpg" srcset="https://pica.zhimg.com/v2-47edc3a0c442f9e393c552fde4bcb2e6_l.jpg?source=06d4cd63 2x" alt="Jayce" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/defc5241d77d0c549fa1962460fb8183" target="_blank" class="css-10u695f">Jayce</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>       对应于作者前文提到的，共有两种方法来将原子能力Atom扩展到Tiled，而这里的两个shape便代表这个。对应于作者前面发的<a href="https://zhuanlan.zhihu.com/p/663092747" class="internal css-2ietpx" target="_blank"><span class="invisible">https://</span><span class="visible">zhuanlan.zhihu.com/p/66</span><span class="invisible">3092747</span><span class="ellipsis"></span></a>中的TiledMMA中的AtomLayoutMNK和ValLayoutMNK，也就是通过叠加多个原子能力以及每线程负责多个值（同样可参考上述链接中的MMAOperation下面的图，可以看到对于每个线程Tn，他都会有两个值V0和V1）这两种方法来从“小块到大块”。<br>       而对于一个GEMM来说有三个维度，顺序是MNK，而这两个shape中的三个数字就代表每个维度重复几次，第一行make_layout(Shape&lt;_2, _2, _1&gt;{})代表着，通过使用AtomLayoutMNK来叠加多个原子能力，对M维度重复2次，N维重复2次，K维重复1次；而第二行make_layout(Shape&lt;_1, _2, _1&gt;{})代表着，通过使用ValLayoutMNK来让每个线程负责多个值来进行重复（我猜测就是对应于本文中提到的“使用更多寄存器”），即M维度重复1次，N维度重复2次，K维度重复一次。<br>       通过同时使用这两种方法，共可以使M维度重复2×1=2次，N维度重复2×2=4次，K维度重复1×1=1次，所以对应于文中使用的“Ampere架构提供的16×8×16的Tensor Core矩阵乘法指令”，就可以得出“这样，我们便可以得到TiledMMA需要32×2×2 = 128线程，其能处理的矩阵的大小: M = 16×2×1 = 32, N = 8×2×2 = 32, K = 16×1×1 = 16, 即TiledMMA能处理的MNK为32×32×16”。<br>       对于上述提到的128个线程，我们知道对于一个MMA_Atom原子操作使用32个线程，而TiledMMA的线程数与前文提到的重复多少次有关，而只有AtomLayoutMNK重复次数会影响线程数，ValLayoutMNK只会影响每线程负责的值数，所以最终只有Shape&lt;_2, _2, _1&gt;{}影响TiledMMA的线程数，即32×2×2×1=128个线程；而对于TiledMMA能处理多大的矩阵就同时与AtomLayoutMNK和ValLayoutMNK重复次数有关，即本回复前文提到的“通过同时使用这两种方法，共可以使M维度重复2×1=2次，N维度重复2×2=4次，K维度重复1×1=1次”，所以对于一个MMA_Atom使用的M×N×K=16×8×16的矩阵乘法可以得出，一个TiledMMA能处理的MNK为(16×2)×(8×4)×(16×1)=32×32×16。<br><br>写的太长太啰嗦，但是我自认为能用上述语言把自己讲通，希望能有帮助<img src="./cute 之 简单GEMM实现 - 知乎_files/v2-0942128ebfe78f000e84339fbb745611.png" class="sticker" alt="[爱]"></p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">03-19</span><span> · </span><span class="css-ntkn7q" href="">IP 属地北京</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>15</button></div></div></div></div></div><div data-id="10819853863"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/236dedf0a4bc04040b68aea7e2e6e06a" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-8700f69f73463e7575b7a58c7ccc95e2_l.jpg" srcset="https://pica.zhimg.com/v2-8700f69f73463e7575b7a58c7ccc95e2_l.jpg?source=06d4cd63 2x" alt="zzk again" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/236dedf0a4bc04040b68aea7e2e6e06a" target="_blank" class="css-10u695f">zzk again</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-8v0dsd" href="">我关注的人</span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>附一个官方discussion，但我也没看太懂 <a href="http://link.zhihu.com/?target=https%3A//github.com/NVIDIA/cutlass/discussions/1345" class=" external css-2ietpx" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/NVIDIA/cutla</span><span class="invisible">ss/discussions/1345</span><span class="ellipsis"></span></a></p><p><img src="./cute 之 简单GEMM实现 - 知乎_files/v2-b62e608e405aeb33cd52830218f561ea.png" class="sticker" alt="[捂脸]"></p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">03-06</span><span> · </span><span class="css-ntkn7q" href="">IP 属地广东</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>3</button></div></div></div></div></div><button type="button" class="Button Button--secondary Button--grey css-7dh30y">查看全部 7 条回复<span style="display: inline-flex; align-items: center;">​<svg width="24" height="24" viewBox="0 0 24 24" class="ZDI ZDI--ArrowRightSmall24" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M10.518 6.224a.875.875 0 0 1 1.212.248l3.335 5.05a.875.875 0 0 1 0 .964l-3.334 5.043a.875.875 0 0 1-1.46-.965l3.015-4.56-3.016-4.568a.875.875 0 0 1 .248-1.212Z" clip-rule="evenodd"></path></svg></span></button></div><div data-id="10732711264"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e4207cbc0bbbf18138cb69416f7d2346" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://pic1.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="番茄加上西红柿" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e4207cbc0bbbf18138cb69416f7d2346" target="_blank" class="css-10u695f">番茄加上西红柿</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>大伙不要光点赞，要积极提问呀！！！！</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-11-20</span><span> · </span><span class="css-ntkn7q" href="">IP 属地浙江</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>2</button></div></div></div></div><div data-id="10732425630"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e4207cbc0bbbf18138cb69416f7d2346" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="番茄加上西红柿" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e4207cbc0bbbf18138cb69416f7d2346" target="_blank" class="css-10u695f">番茄加上西红柿</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>快快快！支楞起来！！！</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-11-20</span><span> · </span><span class="css-ntkn7q" href="">IP 属地浙江</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>2</button></div></div></div></div></div></div><div data-id="10740325878"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/319207f87f154964fafae2135d60b420" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-e5aeb4872c80f1b3edccc46617dfe3de_l(1).jpg" srcset="https://picx.zhimg.com/v2-e5aeb4872c80f1b3edccc46617dfe3de_l.jpg?source=06d4cd63 2x" alt="Ohge" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/319207f87f154964fafae2135d60b420" target="_blank" class="css-10u695f">Ohge</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>为啥我在cute官方example看到的矩阵乘法实现用的是gemm呢？您这里又是thr_mma。。。？<a href="http://link.zhihu.com/?target=https%3A//github.com/NVIDIA/cutlass/blob/main/examples/cute/tutorial/sgemm_nt_1.cu" class=" external css-2ietpx" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/NVIDIA/cutla</span><span class="invisible">ss/blob/main/examples/cute/tutorial/sgemm_nt_1.cu</span><span class="ellipsis"></span></a></p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-11-29</span><span> · </span><span class="css-ntkn7q" href="">IP 属地上海</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>1</button></div></div></div></div></div><div data-id="10884785330"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/8df1846ce6bc7db8da8decf00bf32754" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://pic1.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="HPCer" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/8df1846ce6bc7db8da8decf00bf32754" target="_blank" class="css-10u695f">HPCer</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>请问一下，这个代码里面考虑的矩阵A,B数据类型都是half，我看网上对于tensor core和cutlass似乎都是考虑half类型的矩阵乘法，是否有针对float类型的矩阵乘法呢</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">05-22</span><span> · </span><span class="css-ntkn7q" href="">IP 属地北京</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div><div data-id="10885368253"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2600b0313c76a175aa9e09a235382b79" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-e9c299bcbb6d098601ce529e9a358d82_l(1).jpg" srcset="https://pic1.zhimg.com/v2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=06d4cd63 2x" alt="reed" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2600b0313c76a175aa9e09a235382b79" target="_blank" class="css-10u695f">reed</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-8v0dsd" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><defs><lineargradient id="biz-badges-blue" x1="0" y1="0" x2="100%" y2="73.32%"><stop offset="15%" stop-color="#47D3FF" data-darkreader-inline-stopcolor="" style="--darkreader-inline-stopcolor: #007ba1;"></stop><stop offset="81.54%" stop-color="#4A7DFF" data-darkreader-inline-stopcolor="" style="--darkreader-inline-stopcolor: #002da0;"></stop></lineargradient></defs><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#ffffff" width="30" height="30" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #e8e6e3;"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="url(#biz-badges-blue)"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #e8e6e3;"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt">tensor core的支持输入和计算类型会有一些限制，fp16基本满足大多数网络计算的需求，更高性能要求的网络会倾向更低精度，如int8，fp8。对于科学计算而言，如果你需要fp32类型，可以考虑的方向有：1. tf32是否满足精度需求，2. 考虑tensorcore上的fp64精度计算。</div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">05-22</span><span> · </span><span class="css-ntkn7q" href="">IP 属地北京</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div><div data-id="10885151534"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/8df1846ce6bc7db8da8decf00bf32754" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="HPCer" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/8df1846ce6bc7db8da8decf00bf32754" target="_blank" class="css-10u695f">HPCer</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div><svg width="12" height="12" viewBox="0 0 16 16" class="ZDI ZDI--ArrowRightAlt16 css-gx7lzm" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M10.727 7.48a.63.63 0 0 1 0 1.039l-4.299 2.88c-.399.268-.926-.028-.926-.519V5.12c0-.491.527-.787.926-.52l4.299 2.881Z"></path></svg><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2600b0313c76a175aa9e09a235382b79" target="_blank" class="css-10u695f">reed</a></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p><img src="./cute 之 简单GEMM实现 - 知乎_files/v2-b62e608e405aeb33cd52830218f561ea.png" class="sticker" alt="[捂脸]">好吧，感谢</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">05-22</span><span> · </span><span class="css-ntkn7q" href="">IP 属地北京</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div></div><div data-id="10840879845"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/65298c783b3990531216a750ee9d1bd4" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="Arsmart" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/65298c783b3990531216a750ee9d1bd4" target="_blank" class="css-10u695f">Arsmart</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>请教一下，MMA只能算32x32x16的块，但是一个block算的是128x128，这是怎么扩展的呢？</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">03-30</span><span> · </span><span class="css-ntkn7q" href="">IP 属地美国</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div><div data-id="10871370539"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2600b0313c76a175aa9e09a235382b79" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-e9c299bcbb6d098601ce529e9a358d82_l(2).jpg" srcset="https://pica.zhimg.com/v2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=06d4cd63 2x" alt="reed" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2600b0313c76a175aa9e09a235382b79" target="_blank" class="css-10u695f">reed</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-8v0dsd" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><defs><lineargradient id="biz-badges-blue" x1="0" y1="0" x2="100%" y2="73.32%"><stop offset="15%" stop-color="#47D3FF" data-darkreader-inline-stopcolor="" style="--darkreader-inline-stopcolor: #007ba1;"></stop><stop offset="81.54%" stop-color="#4A7DFF" data-darkreader-inline-stopcolor="" style="--darkreader-inline-stopcolor: #002da0;"></stop></lineargradient></defs><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#ffffff" width="30" height="30" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #e8e6e3;"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="url(#biz-badges-blue)"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #e8e6e3;"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt">参考下这个系列文章中 cute高效gemm实现 中的figure 2，看看那张图能否解决你的困惑.</div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">05-06</span><span> · </span><span class="css-ntkn7q" href="">IP 属地北京</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div></div><div data-id="10840847255"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/65298c783b3990531216a750ee9d1bd4" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://pic1.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="Arsmart" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/65298c783b3990531216a750ee9d1bd4" target="_blank" class="css-10u695f">Arsmart</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>大佬关于MMA的用法是不是和官方有点区别？<br>``<br>template &lt;class MMA_Op,<br>          class MMAThrLayout = Layout&lt;Shape&lt;_1,_1,_1&gt;&gt;,<br>          class Permutations = Tile&lt;Underscore,Underscore,Underscore&gt;&gt;<br>CUTE_HOST_DEVICE constexpr<br>auto<br>make_tiled_mma(MMA_Atom&lt;MMA_Op&gt; const&amp; mma_atom,<br>               MMAThrLayout     const&amp; thr_layout   = {},<br>               Permutations     const&amp; permutations = {})<br>```<br>上面是官方代码，大佬您的代码是：<br> ``<br>using MMA = decltype(make_tiled_mma(mma_atom{}, <br>                      make_layout(Shape&lt;_2, _2, _1&gt;{}), <br>                      make_layout(Shape&lt;_1, _2, _1&gt;{})));<br>``` </p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">03-30</span><span> · </span><span class="css-ntkn7q" href="">IP 属地美国</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div><div data-id="10840421780"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/65298c783b3990531216a750ee9d1bd4" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="Arsmart" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/65298c783b3990531216a750ee9d1bd4" target="_blank" class="css-10u695f">Arsmart</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>请教一下 我增大了ValLayoutMNK的值，但是没有增加寄存器使用，减少之后也没有减少寄存器，为什么呢？<img src="./cute 之 简单GEMM实现 - 知乎_files/v2-7f09d05d34f03eab99e820014c393070.png" class="sticker" alt="[发呆]"></p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">03-30</span><span> · </span><span class="css-ntkn7q" href="">IP 属地美国</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div><div data-id="10759123948"><div class="css-jp43l4"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/6fa31431ebc144844aa833506d7f1615" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="呼哧呼哧" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/6fa31431ebc144844aa833506d7f1615" target="_blank" class="css-10u695f">呼哧呼哧</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>您好，我想问一下关于gemm计算中相关线程索引和地址的偏移计算都是通过layout来实现的吗？谢谢</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-12-24</span><span> · </span><span class="css-ntkn7q" href="">IP 属地河南</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div><div data-id="10759554458"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2600b0313c76a175aa9e09a235382b79" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-e9c299bcbb6d098601ce529e9a358d82_l(1).jpg" srcset="https://pic1.zhimg.com/v2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=06d4cd63 2x" alt="reed" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2600b0313c76a175aa9e09a235382b79" target="_blank" class="css-10u695f">reed</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-8v0dsd" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><defs><lineargradient id="biz-badges-blue" x1="0" y1="0" x2="100%" y2="73.32%"><stop offset="15%" stop-color="#47D3FF" data-darkreader-inline-stopcolor="" style="--darkreader-inline-stopcolor: #007ba1;"></stop><stop offset="81.54%" stop-color="#4A7DFF" data-darkreader-inline-stopcolor="" style="--darkreader-inline-stopcolor: #002da0;"></stop></lineargradient></defs><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#ffffff" width="30" height="30" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #e8e6e3;"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="url(#biz-badges-blue)"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #e8e6e3;"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt">是的</div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-12-24</span><span> · </span><span class="css-ntkn7q" href="">IP 属地北京</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div><div data-id="10759412505"><div class="css-1kwt8l8"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/6fa31431ebc144844aa833506d7f1615" target="_blank" class="css-1dxejhk"><img class="Avatar css-1ljippv" src="./cute 之 简单GEMM实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://pic1.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="呼哧呼哧" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/6fa31431ebc144844aa833506d7f1615" target="_blank" class="css-10u695f">呼哧呼哧</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div><svg width="12" height="12" viewBox="0 0 16 16" class="ZDI ZDI--ArrowRightAlt16 css-gx7lzm" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M10.727 7.48a.63.63 0 0 1 0 1.039l-4.299 2.88c-.399.268-.926-.028-.926-.519V5.12c0-.491.527-.787.926-.52l4.299 2.881Z"></path></svg><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/6fa31431ebc144844aa833506d7f1615" target="_blank" class="css-10u695f">呼哧呼哧</a></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg></div><div class="CommentContent css-1jpzztt"><p>再请教一个问题，如果我想更改对应支持的tensor core的指令，那么相应的从内存中取数的偏移和地址索引也需要更改这些是通过去改哪一部分呢？还是说其都是通过layout实现的，更改偏移和索引需要更改layout中的shape和stride？谢谢</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">2023-12-24</span><span> · </span><span class="css-ntkn7q" href="">IP 属地河南</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div><button type="button" class="Button Button--secondary Button--grey css-7dh30y">展开其他 1 条回复<span style="display: inline-flex; align-items: center;">​<svg width="24" height="24" viewBox="0 0 24 24" class="ZDI ZDI--ArrowRightSmall24" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M10.518 6.224a.875.875 0 0 1 1.212.248l3.335 5.05a.875.875 0 0 1 0 .964l-3.334 5.043a.875.875 0 0 1-1.46-.965l3.015-4.56-3.016-4.568a.875.875 0 0 1 .248-1.212Z" clip-rule="evenodd"></path></svg></span></button></div><div></div></div></div><div class="css-wu78cf"><div class="css-vurnku">点击查看全部评论</div><svg width="24" height="24" viewBox="0 0 24 24" class="ZDI ZDI--ArrowRightSmall24" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M10.518 6.224a.875.875 0 0 1 1.212.248l3.335 5.05a.875.875 0 0 1 0 .964l-3.334 5.043a.875.875 0 0 1-1.46-.965l3.015-4.56-3.016-4.568a.875.875 0 0 1 .248-1.212Z" clip-rule="evenodd"></path></svg></div></div><div class="css-l8iyjs"></div><div class="css-kt4t4n" style="position: relative; box-shadow: 0px 0px;" data-darkreader-inline-boxshadow=""><div><div class="css-59erns"><img class="Avatar css-m4psdq" src="./cute 之 简单GEMM实现 - 知乎_files/v2-c58ab06f0991ecef82f9d358f471cfd3_l.jpg" srcset="https://pica.zhimg.com/v2-c58ab06f0991ecef82f9d358f471cfd3_l.jpg?source=32738c0c 2x"><div class="css-14zbeoe"><div class="css-i6bazn"><div class="css-1ryozpy"><div class="InputLike css-1rl4wxv Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 38px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-hh8d" style="white-space: pre-wrap;">理性发言，友善互动</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-hh8d" class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word; --darkreader-inline-outline: initial;" data-darkreader-inline-outline=""><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="hh8d" data-offset-key="32rv1-0-0"><div data-offset-key="32rv1-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="32rv1-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;"></div></div></div></div></div></div></div><div></div></div></div></div><div class="PostIndex-Contributions" data-za-detail-view-path-module="ColumnList" data-za-detail-view-path-module_name="文章被以下专栏收录" data-za-extra-module="{}"><h3 class="BlockTitle">文章被以下专栏收录</h3><ul><div class="ContentItem Column-ColumnItem"><div class="ContentItem-main"><div class="ContentItem-image"><a class="ColumnLink" href="https://www.zhihu.com/column/c_1696937812497235968"><div class="css-1gomreu"><img class="Avatar css-1u7r5c9" src="./cute 之 简单GEMM实现 - 知乎_files/4b70deef7_l.jpg" srcset="https://picx.zhimg.com/4b70deef7_l.jpg?source=172ae18b 2x" alt="CUDA高性能编程"></div></a></div><div class="ContentItem-head"><h2 class="ContentItem-title"><span><a class="ColumnLink ColumnItem-Title" href="https://www.zhihu.com/column/c_1696937812497235968"><div class="css-1gomreu">CUDA高性能编程</div></a></span></h2><div class="ContentItem-meta">高性能计算中CUDA软硬件体系</div></div></div></div></ul></div><div role="complementary" aria-label="推荐阅读" class="Recommendations-Main" style="width: 1719px;"><h3 class="BlockTitle Recommendations-BlockTitle">推荐阅读</h3><ul class="Recommendations-List"><button class="PagingButton PagingButton-Previous" disabled="" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" fill="#d3d3d3" class="Zi Zi--ArrowLeft" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #313537;"><path fill-rule="evenodd" d="M14.609 6.322c.349.335.36.889.026 1.237l-4.253 4.438 4.254 4.444a.875.875 0 1 1-1.264 1.21l-4.834-5.05a.875.875 0 0 1 0-1.21l4.834-5.043a.875.875 0 0 1 1.237-.026Z" clip-rule="evenodd"></path></svg></button><a href="https://zhuanlan.zhihu.com/p/106565692" class="PostItem"><div><h1 class="PostItem-Title">如何为Lumerical FDTD软件编写自定义材料插件</h1><p class="PostItem-Summary">Lumerical 公司的FDTD软件在无源线性器件仿真方面非常方便，但在非线性、增益或其它性质的材料方面，却不一定有符合我们需求的材料插件，这限制了我们进一步的仿真工作。幸运的是FDTD软件提…</p><div class="PostItem-Footer"><span>洒脱道长</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/397799549" class="PostItem"><div><img src="./cute 之 简单GEMM实现 - 知乎_files/v2-21422a538ddfffdb89b2b9c3263684bd_250x0.jpg" srcset="https://picx.zhimg.com/v2-21422a538ddfffdb89b2b9c3263684bd_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="R语言ggplot2绘制箱线图(Box plot)"><h1 class="PostItem-Title">R语言ggplot2绘制箱线图(Box plot)</h1><div class="PostItem-Footer"><span>Rooki...</span><span class="PostItem-FooterTitle">发表于R语言vs...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/364299055" class="PostItem"><div><img src="./cute 之 简单GEMM实现 - 知乎_files/v2-c1adc41115c36ea6151fb88b91a1d677_250x0.jpg" srcset="https://pica.zhimg.com/v2-c1adc41115c36ea6151fb88b91a1d677_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="【Altium Designer】 3 SchLib原理图库元器件的绘制"><h1 class="PostItem-Title">【Altium Designer】 3 SchLib原理图库元器件的绘制</h1><div class="PostItem-Footer"><span>LongYorke</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/340762882" class="PostItem"><div><img src="./cute 之 简单GEMM实现 - 知乎_files/v2-2684b2e5a88a23b0b1707c28cb99e1a1_250x0.jpg" srcset="https://picx.zhimg.com/v2-2684b2e5a88a23b0b1707c28cb99e1a1_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="lammps案例：聚乙烯剪切过程分子动力学模拟"><h1 class="PostItem-Title">lammps案例：聚乙烯剪切过程分子动力学模拟</h1><div class="PostItem-Footer"><span>小马老师</span><span class="PostItem-FooterTitle">发表于lammp...</span></div></div></a><button class="PagingButton PagingButton-Next" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" fill="#d3d3d3" class="Zi Zi--ArrowRight" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #313537;"><path fill-rule="evenodd" d="M10.518 6.224a.875.875 0 0 1 1.212.248l3.335 5.05a.875.875 0 0 1 0 .964l-3.334 5.043a.875.875 0 0 1-1.46-.965l3.015-4.56-3.016-4.568a.875.875 0 0 1 .248-1.212Z" clip-rule="evenodd"></path></svg></button></ul></div></div></div></main><div role="complementary"><div class="CornerButtons"><div class="CornerAnimayedFlex CornerAnimayedFlex--hidden"><button data-tooltip="回到顶部" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部" type="button" class="Button CornerButton Button--plain css-4lspwd"><svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="Zi Zi--BackToTop" fill="currentColor" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"><path fill-rule="evenodd" d="M13.204 3.107a1.75 1.75 0 0 0-2.408 0L3.806 9.73c-1.148 1.088-.378 3.02 1.204 3.02h2.24V20c0 .966.784 1.75 1.75 1.75h6A1.75 1.75 0 0 0 16.75 20v-7.25h2.24c1.582 0 2.353-1.932 1.204-3.02l-6.99-6.623Z" clip-rule="evenodd"></path></svg></button></div></div></div></div></div><script id="js-clientConfig" type="text/json">{"fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","lens":"https:\u002F\u002Flens.zhihu.com","zhida":"https:\u002F\u002Fzhida.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fapi\u002F","walletpay":"https:\u002F\u002Fwalletpay.zhihu.com","captcha":"https:\u002F\u002Fcaptcha.zhihu.com","vzuu":"https:\u002F\u002Fv.vzuu.com","openapi":"https:\u002F\u002Fopenapi.zhihu.com","svip":"https:\u002F\u002Fsvip.zhihu.com"},"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","videoHost":"video.zhihu.com","zhuanlanHost":"zhuanlan.zhihu.com","allowSignUp":true,"refreshValidityPeriod":"30","release":"1460-273bc90e","currentEntry":"column","isMobileEntry":false,"apollo":{"env":"prod","globalSilence":"","ncgModeSign":"3f8e56febda4fb3bbea72e379d76de1e","topstory_rec_adp":"1","topstory_hot_adp":"1","editor_adapt_native":"0","editor_auto_rotate":"0","enable_request_filter":"1","content_publish_pin":"0","content_publish_answer":"1","content_publish_question":"1","content_publish_article":"1","content_publish_zvideo":"1","balanceModalSign":"ChYHAcB5ihJECkAFnhDAYmdhsTWVJoNc","reportBackendPublishError":"1","dynamic_font_schema":"1","enable_vzuu_login":"on","test_canary":"member|0-100,1-0","use_new_player":"member|0-100,1-0","player_vendor":"member|0-100,1-0,2-0","use_hevc":"member|0-0,1-100","upload_use_signature":"member|0-0,1-100","use_backdrop_blur":"member|0-0,1-100","article_title_imagex":"member|0-0,1-100","play_station":"member|0-0,1-100","use_cached_supported_countries":"device|1-100,0-0","contentItem_cover_imagex":"member|0-0,1-100","use_qrcode_login_v2":"device|1-100,0-0"}}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{},"cities":{"cityData":[]}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false,"article\u002FloadPostSearchEntity\u002F":false}},"entities":{"users":{"d4901200cbf4b641d3bc073c37356443":{"uid":783097360782868500,"userType":"people","id":"d4901200cbf4b641d3bc073c37356443"},"reed-84-49":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82.jpg?source=172ae18b","uid":"1064511094718017536","userType":"people","isFollowing":true,"urlToken":"reed-84-49","id":"2600b0313c76a175aa9e09a235382b79","description":"https:\u002F\u002Freed-lau.github.io","name":"reed","isAdvertiser":false,"headline":"从科学计算到高性能计算系统","gender":1,"url":"\u002Fpeople\u002F2600b0313c76a175aa9e09a235382b79","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"中国科学院大学 理学博士"}],"badgeV2":{"title":"中国科学院大学 理学博士","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"中国科学院大学 理学博士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"中国科学院大学 理学博士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"},"exposedMedal":{"medalId":"972477022068568064","medalName":"备受瞩目","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-6da117205088242db9cd82e48b28640d_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-6da117205088242db9cd82e48b28640d_l.png?source=172ae18b","description":"被 1000 个人关注","medalAvatarFrame":""}}},"questions":{},"answers":{},"articles":{"667521327":{"entityWords":[],"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fcontent_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=BiBUKF0xBSkqGGRVA2F6CF5wRvRrVR3EE00=&idfa=__IDFA__&imei=__IMEI__&androidid=__ANDROIDID__&oaid=__OAID__&ci=__CREATIVEID__&zid=__ZONEID__"],"id":667521327,"title":"cute 之 简单GEMM实现","type":"article","articleType":"normal","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F667521327","imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-689e4c7afc578c580763b34c7bed1d02_720w.jpg?source=172ae18b","titleImage":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-689e4c7afc578c580763b34c7bed1d02_720w.jpg?source=172ae18b","excerpt":"\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-57e68f14a48698a3f6da8a6c6bac70c9_200x112.png\" data-caption=\"Figure 1. NVidia提供的BLAS类的库对比（引用自参考5）\" data-size=\"normal\" data-rawwidth=\"1900\" data-rawheight=\"596\" data-watermark=\"watermark\" data-original-src=\"v2-57e68f14a48698a3f6da8a6c6bac70c9\" data-watermark-src=\"v2-6572d63d39e3574bda8adc194429f89f\" data-private-watermark-src=\"\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-57e68f14a48698a3f6da8a6c6bac70c9_r.png\" class=\"origin_image inline-img zh-lightbox-thumb\"\u002F\u003E前面的文章我们对cute提供的核心数据结构和抽象进行了一系列的介绍，包括 \u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F661182311\" class=\"internal\"\u003ELayout\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F663093816\" class=\"internal\"\u003ETensor\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F663092747\" class=\"internal\"\u003EMMA\u003C\u002Fa\u003E和\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F666232173\" class=\"internal\"\u003ECopy\u003C\u002Fa\u003E。本文我们将利用这些概念和抽象实现一个简单版本的矩阵乘法。在介绍具体实现之前，我们首先介绍BLAS约定和深度学习对矩阵乘法的需求和约定，然后介绍cuda…","created":1700325538,"updated":1700377908,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82.jpg?source=172ae18b","uid":"1064511094718017536","userType":"people","isFollowing":true,"urlToken":"reed-84-49","id":"2600b0313c76a175aa9e09a235382b79","description":"https:\u002F\u002Freed-lau.github.io","name":"reed","isAdvertiser":false,"headline":"从科学计算到高性能计算系统","gender":1,"url":"\u002Fpeople\u002F2600b0313c76a175aa9e09a235382b79","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"中国科学院大学 理学博士"}],"badgeV2":{"title":"中国科学院大学 理学博士","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"中国科学院大学 理学博士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"中国科学院大学 理学博士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"},"exposedMedal":{"medalId":"972477022068568064","medalName":"备受瞩目","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-6da117205088242db9cd82e48b28640d_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-6da117205088242db9cd82e48b28640d_l.png?source=172ae18b","description":"被 1000 个人关注","medalAvatarFrame":""}},"commentPermission":"all","copyrightPermission":"need_review","state":"published","ipInfo":"IP 属地中国香港","imageWidth":1948,"imageHeight":1238,"content":"\u003Cp data-pid=\"GYpSx2rB\"\u003E前面的文章我们对cute提供的核心数据结构和抽象进行了一系列的介绍，包括\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F661182311\" class=\"internal\"\u003ELayout\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F663093816\" class=\"internal\"\u003ETensor\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F663092747\" class=\"internal\"\u003EMMA\u003C\u002Fa\u003E和\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F666232173\" class=\"internal\"\u003ECopy\u003C\u002Fa\u003E。本文我们将利用这些概念和抽象实现一个简单版本的矩阵乘法。在介绍具体实现之前，我们首先介绍BLAS约定和深度学习对矩阵乘法的需求和约定，然后介绍cuda上的矩阵库cuBLAS和矩阵乘法任务到硬件执行单元的划分策略，最后我们从Tensor构建、切块、划分，执行、拷贝等方面结合代码实现具体介绍了矩阵乘法的实现，同时我们对该版本的实现选取了实际场景中遇到的问题规模进行了实验并对比了该实现的效率。\u003C\u002Fp\u003E\u003Ch2\u003EBLAS约定和深度学习约定\u003C\u002Fh2\u003E\u003Cp data-pid=\"9l_wfPri\"\u003E在科学计算和数值分析领域，经常需要解决矩阵特征值、线性方程（代数）等问题，形成了如EISPACK、LINPACK、LAPACK数学求解库。这些库解决的是偏上层的数学问题，它们共同依赖了更加底层的、更基础的数学库BLAS（\u003Cb\u003EB\u003C\u002Fb\u003Easic \u003Cb\u003EL\u003C\u002Fb\u003Einear \u003Cb\u003EA\u003C\u002Fb\u003Elgebra \u003Cb\u003ES\u003C\u002Fb\u003Eubprograms）。BLAS总共分为三个层次：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"rzG21vna\"\u003E第一层是向量操作，如 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7By%7D+%3D+%5Calpha+%5Cbm%7Bx%7D+%2B+%5Cbm%7By%7D\" alt=\"\\bm{y} = \\alpha \\bm{x} + \\bm{y}\" eeimg=\"1\"\u002F\u003E 计算问题；\u003C\u002Fli\u003E\u003Cli data-pid=\"vvguv4X2\"\u003E第二层向量-矩阵操作，如 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7By%7D+%3D+%5Calpha+%5Cbm%7BA%7D+%5Cbm%7Bx%7D+%2B+%5Cbeta+%5Cbm%7By%7D\" alt=\"\\bm{y} = \\alpha \\bm{A} \\bm{x} + \\beta \\bm{y}\" eeimg=\"1\"\u002F\u003E 计算问题；\u003C\u002Fli\u003E\u003Cli data-pid=\"i9xYW530\"\u003E第三层矩阵-矩阵操作，如 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BC%7D+%3D+%5Calpha+%5Cbm%7BA%7D+%5Cbm%7BB%7D+%2B+%5Cbeta+%5Cbm%7BC%7D\" alt=\"\\bm{C} = \\alpha \\bm{A} \\bm{B} + \\beta \\bm{C}\" eeimg=\"1\"\u002F\u003E 。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"5yx1uoKk\"\u003E\u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BC%7D+%3D+%5Calpha+%5Cbm%7BA%7D+%5Cbm%7BB%7D+%2B+%5Cbeta+%5Cbm%7BC%7D\" alt=\"\\bm{C} = \\alpha \\bm{A} \\bm{B} + \\beta \\bm{C}\" eeimg=\"1\"\u002F\u003E 就是我们常说的GEMM（\u003Cb\u003EGE\u003C\u002Fb\u003Eneral \u003Cb\u003EM\u003C\u002Fb\u003Eatrix \u003Cb\u003EM\u003C\u002Fb\u003Eultiplication）问题，它也是BLAS第三层次要求解的问题。其中的广义来自于 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Calpha\" alt=\"\\alpha\" eeimg=\"1\"\u002F\u003E \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbeta\" alt=\"\\beta\" eeimg=\"1\"\u002F\u003E可以是任意数值，\u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BA%7D\" alt=\"\\bm{A}\" eeimg=\"1\"\u002F\u003E和\u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BB%7D\" alt=\"\\bm{B}\" eeimg=\"1\"\u002F\u003E可以是转置的也可以是非转置的，数值精度方面可以是单精度浮点数、双精度浮点数等。BLAS早期实现的时候采用的是数值计算领域的Fortran语言，在Fortran语言中二维数组是列主序的（列优先），所以在BLAS的API中针对AB矩阵的转置情况描述而言，列优先称为Normal（简写为N），行优先则称为Transpose（简写为T），值得注意的是转置与否是针对A B矩阵而言的， \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BC%7D\" alt=\"\\bm{C}\" eeimg=\"1\"\u002F\u003E \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BD%7D\" alt=\"\\bm{D}\" eeimg=\"1\"\u002F\u003E 矩阵必须是列优先的。同时为了区分不同的数值精度，BLAS规定了不同的简写，如单精度浮点为s（缩写自single precision）, 双精度浮点为d （缩写自double precision），单精度复数为c （缩写自complex），双精度浮点复数记为z。所以在附加上数据类型（如单精度浮点）之后函数名字就由gemm变为了sgemm（single precision general matrix multiplation）。同时BLAS约定了矩阵的维度，表示为 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BD_%7Bm%2Cn%7D%7D+%3D+%5Calpha+%5Cbm%7BA_%7Bm%2C+k%7D%7D+%5Cbm%7BB_%7Bk%2C+n%7D%7D+%2B+%5Cbeta+%5Cbm%7BC_%7Bm%2Cn%7D%7D\" alt=\"\\bm{D_{m,n}} = \\alpha \\bm{A_{m, k}} \\bm{B_{k, n}} + \\beta \\bm{C_{m,n}}\" eeimg=\"1\"\u002F\u003E ,\u003C\u002Fp\u003E\u003Cp data-pid=\"o6sc2zTP\"\u003E其中的m，n表示行列数目，k为reduce轴上的数据维度。\u003C\u002Fp\u003E\u003Cp data-pid=\"npo3KM0R\"\u003E深度学习中也有矩阵乘法所表达的网络层（如Pytorch中Linear层、Tensorflow中的Dense层），但是神经网络中该层的公式可以表达为 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=y+%3D+x+%5Cbm%7BA%7D+%2B+b\" alt=\"y = x \\bm{A} + b\" eeimg=\"1\"\u002F\u003E，其中x为input，维度一般为（N, Cin）y为output维度为（N, Cout），b为bias（一般是boardcast语义，此处我们忽略掉）。我们在忽略掉bias同时采用BLAS的矩阵形式描述，则其公式可以变更为 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BD%7D+%3D+%5Cbm%7BA%7D%5Cbm%7BB%7D\" alt=\"\\bm{D} = \\bm{A}\\bm{B}\" eeimg=\"1\"\u002F\u003E ，我们可以发现深度学习中需要的也是矩阵乘法的语义，和BLAS类似但是又不完全相同，不同点一深度学习中的公式没有BLAS公式中的 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Calpha\" alt=\"\\alpha\" eeimg=\"1\"\u002F\u003E, 不同点二深度学习中公式没有BLAS中的加法右侧项，不同点三输出的D是行优先的而非BLAS中的列优先。除了公式层面的差异外，深度学习中的层为了计算效率会选用比传统的BLAS中的数据类型更低的精度如半精度和整数量化精度。\u003C\u002Fp\u003E\u003Cp data-pid=\"L1XDpeXf\"\u003E由于深度学习的输出要求的是行优先的，而BLAS中的约定中输出矩阵D是列优先的，因此当我们借助BLAS类函数完成深度学习的矩阵乘法时，需要对BLAS的公式进行转置变换，即\u003C\u002Fp\u003E\u003Cp data-pid=\"ImvDTE46\"\u003E\u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbm%7BD%5E%7BT%7D%7D+%3D+%5Calpha+%5Cbm%7BB%5ETA%5ET%7D+%2B+%5Cbeta+%5Cbm%7BC%5E%7BT%7D%7D\" alt=\"\\bm{D^{T}} = \\alpha \\bm{B^TA^T} + \\beta \\bm{C^{T}}\" eeimg=\"1\"\u002F\u003E ，同时设置 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Calpha\" alt=\"\\alpha\" eeimg=\"1\"\u002F\u003E 为1， \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbeta\" alt=\"\\beta\" eeimg=\"1\"\u002F\u003E 为0。由于转置矩阵AB的顺序也发生了变化。使用BLAS实现深度学习矩阵乘法的伪代码调用如下\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F blas_gemm(D, A, B, trans_a, trans_b, m, n, k, alpha, beta) API specifaction;\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F  D = alpha op(A) op(B) + beta C;\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F op can be &#39;N&#39;ormal or &#39;T&#39;ranspose\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F output:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F    D(m, n) column major\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F input: \n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F    A(m, k) column major\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F    B(k, n) column major\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F    C(m, n) column major\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E\u002F\u002F D(m, n) row major\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F A(m, k) row major\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F B(k, n) column major\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Elinear_layer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ED\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealpha\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebeta\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eblas_gemm\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ED\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;T&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;N&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealpha\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebeta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003ENVidia cuBLAS类库\u003C\u002Fh2\u003E\u003Cp data-pid=\"kdzvl7dj\"\u003ENVidia使用GPU进行了BLAS加速实现，形成了cuBLAS加速库，cuBLAS除了实现BLAS中的API（Application Programming Interface）还扩展实现了多Batch支持、多GPU支持和针对深度学习加速的混合精度、低精度实现。对于我们深度学习中常用半精度（half precision）的gemm类似于之前的sgemm，在cuBLAS中提供了hgemm（half precision general matrix multiplation）。本质而言cuBLAS是一个大的kernel仓库，其中存储了NVidia针对不同数据类型，计算精度、矩阵维度、地址对齐等维度综合考虑的高度优化的kernel。当用户调用其进行矩阵运算时，cuBLAS会使用特定的方法从这些kernel中选择出一个针对该问题规模和约束的性能较好的实现版本。除了cuBLAS外，NVidia同时针对不同功能需求和性能追求提供了cuBLASLt库等，如图1所示，其对比了NVidia提供的BLAS类库的API复杂度和融合后处理能力。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6572d63d39e3574bda8adc194429f89f_b.jpg\" data-size=\"normal\" data-rawwidth=\"1900\" data-rawheight=\"596\" class=\"origin_image zh-lightbox-thumb\" width=\"1900\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6572d63d39e3574bda8adc194429f89f_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1900&#39; height=&#39;596&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"1900\" data-rawheight=\"596\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1900\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6572d63d39e3574bda8adc194429f89f_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6572d63d39e3574bda8adc194429f89f_b.jpg\" data-original-token=\"v2-57e68f14a48698a3f6da8a6c6bac70c9\"\u002F\u003E\u003Cfigcaption\u003EFigure 1. NVidia提供的BLAS类的库对比（引用自参考5）\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"MHdzcZHC\"\u003EcuBLASLt库是cuBLAS库的基础上提供针对人工智能和机器学习更灵活的应用，它允许用户指定更复杂的输入输出类型、计算类型（解决混合精度的多类型指定问题）等，同时它还提供了启发式算法，允许用户选择底层实现的性能更好的kernel。后续的文章中我们的实验会利用cuBLASLt的这种选择kernel能力，选择候选kernel中最好的那一个作为我们的baseline。本文中实验我们使用cuBLAS选定的kenrel作为baseline。\u003C\u002Fp\u003E\u003Ch2\u003ETensor表示\u003C\u002Fh2\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-65b6eca19ecac2ba80db7d37354a14f7_b.jpg\" data-size=\"normal\" data-rawwidth=\"1163\" data-rawheight=\"1037\" class=\"origin_image zh-lightbox-thumb\" width=\"1163\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-65b6eca19ecac2ba80db7d37354a14f7_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1163&#39; height=&#39;1037&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"1163\" data-rawheight=\"1037\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1163\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-65b6eca19ecac2ba80db7d37354a14f7_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-65b6eca19ecac2ba80db7d37354a14f7_b.jpg\" data-original-token=\"v2-940cc958a5a716f4dbb11cecf4d0efdb\"\u002F\u003E\u003Cfigcaption\u003EFigure 2.  矩阵乘法问题的Tensor表示及其属性\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"FBySY9sa\"\u003E如图2所示，本文我们研究深度学习中常用的\u003Ccode\u003EC = AB\u003C\u002Fcode\u003E的矩阵乘法问题，其中矩阵A、B存储在GPU的全局内存中，输出C矩阵将会被存储在全局内存中；维度方面A为m行k列，B为k行n列，输出C为m行n列；数据存储Layout方面，A为行优先，B为列优先，C为行优先。数据类型方面A、B、C都位16bit的半精度浮点数，在cuda中表示为half类型（cute封装为cute::half_t类型）。我们将矩阵ABC的信息形成如下表格，同时将row\u002Fcolumn major表示为stride形式，填充上指针变量名称\u003C\u002Fp\u003E\u003Ctable data-draft-node=\"block\" data-draft-type=\"table\" data-size=\"normal\" data-row-style=\"normal\"\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Cth\u003E·矩阵\u003C\u002Fth\u003E\u003Cth\u003E指针变量\u003C\u002Fth\u003E\u003Cth\u003E存储位置\u003C\u002Fth\u003E\u003Cth\u003Eshape\u003C\u002Fth\u003E\u003Cth\u003Estride\u003C\u002Fth\u003E\u003Cth\u003E数据类型\u003C\u002Fth\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003EA\u003C\u002Ftd\u003E\u003Ctd\u003EAptr\u003C\u002Ftd\u003E\u003Ctd\u003Eglobal memory\u003C\u002Ftd\u003E\u003Ctd\u003E(m, k)\u003C\u002Ftd\u003E\u003Ctd\u003E(k, 1)\u003C\u002Ftd\u003E\u003Ctd\u003Ehalf\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003EB\u003C\u002Ftd\u003E\u003Ctd\u003EBptr\u003C\u002Ftd\u003E\u003Ctd\u003Eglobal memory\u003C\u002Ftd\u003E\u003Ctd\u003E(k, n)\u003C\u002Ftd\u003E\u003Ctd\u003E(1, k)\u003C\u002Ftd\u003E\u003Ctd\u003Ehalf\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003EC\u003C\u002Ftd\u003E\u003Ctd\u003ECptr\u003C\u002Ftd\u003E\u003Ctd\u003Eglobal memory\u003C\u002Ftd\u003E\u003Ctd\u003E(m, n)\u003C\u002Ftd\u003E\u003Ctd\u003E(n, 1)\u003C\u002Ftd\u003E\u003Ctd\u003Ehalf\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003Cp data-pid=\"uiYjGtbF\"\u003E我们将ABC表示为Tensor形式，则可以写出如下kernel代码\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003E__global__\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egemm_simple\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"UJmzWN1L\"\u003E其中\u003Ccode\u003Emake_gmem_ptr()\u003C\u002Fcode\u003E 函数用于标识tensor指针的存储层次，方便后续使用时能从指针中取出该指针的存储层次。同时，我们修改了Tensor B的矩阵表示形式把它的形状表示(n, k)，对应的stride 为(k, 1); 这样后续的循环的时候我们就可以写成reduce的形式。为了编译时决策和优化，我们把stride中的连续维度1表示为编译时常量的形式，即Int&lt;1&gt;{}，这样后续对矩阵进行操作的时候如果需要用到stride的计算则可以利用编译时的决策和优化减少不必要的运行时运算。\u003C\u002Fp\u003E\u003Ch2\u003E以C矩阵为中心的任务划分策略\u003C\u002Fh2\u003E\u003Cp data-pid=\"BDeRLAEo\"\u003EGPU中有多个SM（Stream Multiprocessor）我们编程时以grid、block的软件层级进行编程来利用这些SM，在矩阵计算中，我们以输出矩阵C作为划分thead block的单元进行任务拆分，也就是说一个thread block完成C矩阵中的一个小块（TileC）的计算任务，如图3所示，我们定义矩阵TileC的大小为kTileM、kTileN，分别表示小块矩阵包含元素的行数目和列数目，根据块状矩阵乘法的公式完成TileC的计算需要A矩阵中的绿色高亮部分和B矩阵的黄色高亮部分，它们的形状分别为(kTileM, k)和(kTileN, k)。我们对AB矩阵的k轴按照kTileK的大小进行分块，则可以将TileC矩阵表达为AB矩阵块的点积运算\u003C\u002Fp\u003E\u003Cp data-pid=\"Rem3fGoy\"\u003E\u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=TileC+%3D+%5Csum_%7Bitile+%3D+0%7D%5E%7Bnum%5C_tile%7D%7BTileA_%7Bitile%7D+TileB_%7Bitile%7D%7D\" alt=\"TileC = \\sum_{itile = 0}^{num\\_tile}{TileA_{itile} TileB_{itile}}\" eeimg=\"1\"\u002F\u003E \u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ae0180df02c9320c4bd22cb692a24809_b.jpg\" data-size=\"normal\" data-rawwidth=\"1967\" data-rawheight=\"1175\" class=\"origin_image zh-lightbox-thumb\" width=\"1967\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ae0180df02c9320c4bd22cb692a24809_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1967&#39; height=&#39;1175&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"1967\" data-rawheight=\"1175\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1967\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ae0180df02c9320c4bd22cb692a24809_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ae0180df02c9320c4bd22cb692a24809_b.jpg\" data-original-token=\"v2-2d32f6327ef830db3112db2d60789317\"\u002F\u003E\u003Cfigcaption\u003EFigure 3. sliced-k模式的C矩阵为中心的任务划分方法\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"VuOV9-vt\"\u003E如此，我们在k轴上移动kTileK得到AB上的小块 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=TileA_%7Bitile%7D\" alt=\"TileA_{itile}\" eeimg=\"1\"\u002F\u003E 和 \u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=TileB_%7Bitile%7D\" alt=\"TileB_{itile}\" eeimg=\"1\"\u002F\u003E 将他们相乘的积累加到TileC上，便可以得到TileC的计算结果。这种沿着k轴移动的策略称sliced-k方法。这样我们使用一个block（坐标如图blockIdx.x, blockIdx.y）便可以完成C矩阵中一个小块的完整的计算。通过block维度的扩展，如图所示的矩阵C中M轴方向的blockIdx.y和N轴方向的blockIdx.x的扩展，便可以完成整个C矩阵的计算。由此我们可以计算出完成整个C矩阵所需要的gird维度：grid.x = N \u002F kTileN, grid.y = M \u002F kTileM (此处暂时不考虑不可整除的情形)。根据上面的计算过程我们可以继续完善代码，\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003E__global__\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egemm_simple\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EblockIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EblockIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Edim3\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egrid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"Zs6T7YQe\"\u003E如我们上面所述，我们在模版参数中给定划块的超参kTileM、kTileN、kTileK，同时使用Tensor章节中介绍local_tile方法对矩阵进行固定大小的分块，同时通过指定坐标的的全slice方法，得到当前thread block要处理的Tensor gA, gB, gC。和构造Tensor A时类似，我们在进行Tensor分块的时候也将编译时能确定的量进行了\u003Ccode\u003EInt&lt;&gt;\u003C\u002Fcode\u003E化，用以指示该维度信息是编译时常量，编译器可以在编译阶段完成必要的路径决策和优化计算，避免运行时的开销。同时我们在主函数中给出了grid的大小（如上代码）。值得注意的是，经过\u003Ccode\u003Elocal_tile\u003C\u002Fcode\u003E函数我们得到的gA, gB, gC的维度信息如下表格\u003C\u002Fp\u003E\u003Ctable data-draft-node=\"block\" data-draft-type=\"table\" data-size=\"normal\" data-row-style=\"normal\"\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Cth\u003ETensor\u003C\u002Fth\u003E\u003Cth\u003Eshape\u003C\u002Fth\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003EgA\u003C\u002Ftd\u003E\u003Ctd\u003E(kTileM, kTileK, num_tile_k)\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003EgB\u003C\u002Ftd\u003E\u003Ctd\u003E(kTileN, kTileK, num_tile_k)\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003EgC\u003C\u002Ftd\u003E\u003Ctd\u003E(kTileM, kTileN)\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003Cp data-pid=\"qsUB3VOj\"\u003E先选定TileC，然后沿着k轴移动小块进行累加求和的策略为sliced-k，它对于m、n维度较大的场景（m n分块所需要的block数目足以填充所有的SM）比较有效。对于k比较大，而m、n比较小的场景，由于m、n较小而我们根据C来划分thread block，这时需要的thread block数目比较小，当这个数目无法填充所有的SM时，则存在很多SM无任务，而有任务的SM需却又需要循环多次的问题，这时候可以考虑将k轴拆分成多段，每一段都计算一个TileC结果，最后再通过额外的累加过程将多段的结果进行求和，这种模式的任务划分方法成为split-k方法。如图4，把k拆分成两段，由不同的计算单元来完成不同段段段计算，如此则得到多份C，最后将多个C进行累加求和得到最终结果。该方法在特殊场景下有用，而且实现不困难，本文暂不实现该策略。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d19cbe757a80b24d375ace320fbe52cc_b.jpg\" data-size=\"normal\" data-rawwidth=\"1465\" data-rawheight=\"1259\" class=\"origin_image zh-lightbox-thumb\" width=\"1465\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d19cbe757a80b24d375ace320fbe52cc_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1465&#39; height=&#39;1259&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"1465\" data-rawheight=\"1259\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1465\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d19cbe757a80b24d375ace320fbe52cc_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d19cbe757a80b24d375ace320fbe52cc_b.jpg\" data-original-token=\"v2-4a3101b8229dff1f06dd26c97bd53bfb\"\u002F\u003E\u003Cfigcaption\u003EFigure 4. split-k策略的计算逻辑\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"vRpR6Hby\"\u003E除了sliced-k、split-k策略在任务划分方面还有stream-k方法，stream-k方法作者们指出sliced-k或者split-k方法都是静态的划分任务，在划分的任务数目和SM执行单元不能整除的时候，总会在存在某轮（wave）计算中存在SM空闲的问题。stream-k则是抛弃以任务为中心的划分逻辑，而是变成了以计算资源为核心的分配任务方式，使得SM的任务量基本相当，如图5，其展示了假设只有4个SM的情况下，不同任务划分逻辑的差异，其中stream-k对计算资源的利用效果最好，具体可以参考发表在PPoPP‘23上的poster。现阶段cuBLAS中的kernel依然多为sliced-k和split-k实现。本文暂不实现该策略。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-160c03adccbb2bebc40b596b8ecd2214_b.jpg\" data-size=\"normal\" data-rawwidth=\"3000\" data-rawheight=\"1190\" class=\"origin_image zh-lightbox-thumb\" width=\"3000\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-160c03adccbb2bebc40b596b8ecd2214_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;3000&#39; height=&#39;1190&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"3000\" data-rawheight=\"1190\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"3000\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-160c03adccbb2bebc40b596b8ecd2214_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-160c03adccbb2bebc40b596b8ecd2214_b.jpg\" data-original-token=\"v2-bdb3faaa1c712497cf182aa71945c53d\"\u002F\u003E\u003Cfigcaption\u003EFigure 5. stream-k策略任务划分逻辑（引用自PPoPP23: Stream-K）\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003ETiledMMA：主机端选择指令，设备端将分块划分到线程\u003C\u002Fh2\u003E\u003Cp data-pid=\"gpco-EVL\"\u003E前面经过把C++ pointer封装成Tensor，然后利用\u003Ccode\u003Elocal_tile\u003C\u002Fcode\u003E将Tensor划分成小块，我们便可以得到一个thread block需要处理的任务。这时，假设我们通过前面MMA章节构造了一个TiledMMA能力，则借助其方法我们便可以通过ThrMMA的partition_A\u002FB\u002FC方法实现对TileA、TileB、TileC、的划分，通过partition_fragment_A\u002FB\u002FC便可以构造矩阵乘所需要的寄存器表示。通过cute::gemm方法便可以完成线程级别寄存器表示的矩阵乘法。具体的kernel代码为\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETiledMMA\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003E__global__\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egemm_simple\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EblockIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EblockIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"c1\"\u003E\u002F\u002F  gA(kTileM, kTileK, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F  gB(kTileN, kTileK, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F  gC(kTileM, kTileN) \n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETiledMMA\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etiled_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etiled_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget_slice\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EthreadIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtAgA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_A\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_K, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtBgB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_B\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_N, MMA_K, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtCgC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_C\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_N)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtArA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_fragment_A\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_K)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtBrB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_fragment_B\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_N, MMA_K)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtCrC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_fragment_C\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E     \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_N)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E \n  \u003Cspan class=\"n\"\u003Eclear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EtCrC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emma_op\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESM80_16x8x16_F16F16F16F16_TN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emma_traits\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMMA_Traits\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emma_op\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emma_atom\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMMA_Atom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emma_traits\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMMA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edecltype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_tiled_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emma_atom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \n                      \u003Cspan class=\"n\"\u003Emake_layout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EShape\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \n                      \u003Cspan class=\"n\"\u003Emake_layout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EShape\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{})));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Edim3\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eblock\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMMA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Edim3\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egrid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"9lKQo5lV\"\u003E其中\u003Ccode\u003Eget_slice\u003C\u002Fcode\u003E函数能够将TiledMMA能力根据具体的线程id得到每一个线程所需要的layout信息。利用partition函数实现对gA gB gC的矩阵在线程级别的分解，经过partition后得到的维度信息为(MMA, MMA_M, MMA_K, num_tile_k)，其中MMA表示TiledMMA一次能做的矩阵运算所需要的数据，MMA_M、MMA_K表示(kTileM, kTileK)按照TiledMMA能力去划分的时候，M方向和K方向需要重复多少次才能完成该矩阵乘法，即M K方向需要循环多少遍TildMMA才能完成计算，而num_tile_k则为将gA的维度自然带入下来。也就是说partition_A的逻辑本质上是将Tensor的前两维进行划分，划分后得到一个三维的结果，其中第一维度表示TiledMMA单次所能处理的数据，接下来的两维表示两个方向上的重复，而如果被partition的维度再多，则后续的维度自然的继承下来即可。partition_fragment类函数和前面的类似，只是其返回的是寄存器声明。同时我们注意到对于partition_fragment_A\u002FB，我们输入的gA时保留了前两个维度，对第三个维度我们选择了位置0，这就等价于传递给partition_fragment_A\u002FB的是形状为(kTileM, kTileK)、（kTileN, kTileK）的Tensor。自然的其返回的结果形状也是类似的：第一维表示TiledMMA单次能力所需的数据，接下来的两维表示对TileMMA能力在M方向和K方向的重复次数。在得到TileC的寄存器表示后，我们使用clear方法将其初始化为0，以备后面进行矩阵乘法时的累加操作。\u003C\u002Fp\u003E\u003Cp data-pid=\"JWOP7I3C\"\u003E在main函数中，我们选择使用Ampere架构提供的16x8x16的Tensor Core矩阵乘法指令，数据精度和计算精度都为fp16。然后通过MMA_Traits得到mma_traits，继续将traits转换成MMA_Atom。我们知道SM80的Tensor Core执行是warp level的，也就是说这个MMA_Atom是32个线程，我们对MMA_Atom能力通过增加线程的方式进行M、N方向的重复，同时我们让B矩阵C矩阵使用更多寄存器在N方向扩展2次，得到main函数中的MMA类型。这样，我们便可以得到TiledMMA需要32x2x2 = 128线程，其能处理的矩阵的大小: M = 16 x 2 x 1 = 32, N = 8 x 2 x 2 = 32, K = 16 x 1 x 1 = 16, 即TiledMMA能处理的MNK为32x32x16。\u003C\u002Fp\u003E\u003Ch2\u003ELoop Over K\u003C\u002Fh2\u003E\u003Cp data-pid=\"Upnm7ESm\"\u003E有了TiledMMA的数据划分之后，我们调用\u003Ccode\u003Ecute::gemm\u003C\u002Fcode\u003E即可以完成 \u003Ccode\u003EC[kTileM, kTileN] =A[kTileM, kTilleK] B[kTileN, kTileK]\u003C\u002Fcode\u003E利用Tensor Core进行矩阵乘的能力，我们对其进行这个块沿着k方向循环便可以得到最总的矩阵计算结果，实现如下\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETiledMMA\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003E__global__\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egemm_simple\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tensor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_gmem_ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_shape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_stride\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EblockIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EblockIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETensor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EgC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elocal_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_tile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emake_coord\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eiy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"c1\"\u003E\u002F\u002F  gA(kTileM, kTileK, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F  gB(kTileN, kTileK, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F  gC(kTileM, kTileN) \n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ETiledMMA\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etiled_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etiled_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget_slice\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EthreadIdx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtAgA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_A\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_K, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtBgB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_B\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_N, MMA_K, num_tile_k)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtCgC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_C\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_N)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtArA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_fragment_A\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_K)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtBrB\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_fragment_B\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_N, MMA_K)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtCrC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethr_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epartition_fragment_C\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E     \u003Cspan class=\"c1\"\u003E\u002F\u002F (MMA, MMA_M, MMA_N)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E \n  \u003Cspan class=\"n\"\u003Eclear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EtCrC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enum_tile_k\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"cp\"\u003E#pragma unroll 1\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eitile\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eitile\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enum_tile_k\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eitle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecute\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecopy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EtAgA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eitile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtArA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecute\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecopy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EtBgB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eitile\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtBrB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Ecute\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Egemm\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etiled_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtCrC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtArA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtBrB\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtCrC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ecute\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecopy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EtCrC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EtCgC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emma_op\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESM80_16x8x16_F16F16F16F16_TN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emma_traits\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMMA_Traits\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emma_op\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emma_atom\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMMA_Atom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emma_traits\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMMA\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edecltype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_tiled_mma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emma_atom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \n                      \u003Cspan class=\"n\"\u003Emake_layout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EShape\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}),\u003C\u002Fspan\u003E \n                      \u003Cspan class=\"n\"\u003Emake_layout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EShape\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{})));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Edim3\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eblock\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMMA\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{}));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Edim3\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egrid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Egemm_simple\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EkTileK\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMMA\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EAptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ek\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"vp4LBla4\"\u003E通过gA我们可以获取k方向的tile需要循环的次数num_tile_k，然后利用sliced-k模式循环k方向的tile，通过\u003Ccode\u003Ecute::copy\u003C\u002Fcode\u003E实现全局内存到寄存器到直接copy，数据拷贝到寄存器后通过\u003Ccode\u003Ecute::gemm\u003C\u002Fcode\u003E完成Tile块的矩阵乘法。在循环结束后再次利用\u003Ccode\u003Ecute::copy\u003C\u002Fcode\u003E实现寄存器到全局内存的写出。\u003Ccode\u003Ecute::copy\u003C\u002Fcode\u003E在不指定Copy_Atom时采用\u003Ccode\u003EUniversalCopy\u003C\u002Fcode\u003E实现，即简单的cuda语言层面的\u003Ccode\u003ET d = s\u003C\u002Fcode\u003E形式。到此，我们已经可以使用TileMMA 和 cute::copy实现简单的矩阵乘法。\u003C\u002Fp\u003E\u003Ch2\u003E实验性能对比\u003C\u002Fh2\u003E\u003Cp data-pid=\"YotiEynG\"\u003E我们选定了一个实际深度学习推理中会使用到的矩阵的大小(M, N, K) = （81920，256，256），选定(kTileM, kTileN, kTileK) = (128, 128, 32)，在RTX 3090显卡上进行了相应的实验，其中操作系统版本为Ubuntu 20.04.6 LTS，CUDA 驱动版本为535.113.01，编译器NVCC版本为V11.7.64。我们实现的kernel和cuBLAS选定的kernel分别调用100次取kernel平均的耗时，得到如下表格，实现及测试代码见\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Freed-lau\u002Fcute-gemm\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Egithub.com\u002Freed-lau\u002Fcut\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Ee-gemm\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Ctable data-draft-node=\"block\" data-draft-type=\"table\" data-size=\"normal\" data-row-style=\"normal\"\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Cth\u003E方法\u003C\u002Fth\u003E\u003Cth\u003E平均耗时(us)（实验100次取平均）\u003C\u002Fth\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003Egemm_simple\u003C\u002Ftd\u003E\u003Ctd\u003E218\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003Eampere_h16816gemm_256x128_ldg8_stages_32x3_tn\u003C\u002Ftd\u003E\u003Ctd\u003E138\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003Cp data-pid=\"_F7yuBBB\"\u003E我们看到cuBLAS中选择的kernel为ampere架构的实现，我们的简单实现版本比cuBLAS中的实现还有很大差距，在后续的文章中我们会通过在该实现上进行优化最终达到甚至超越这个实现效率。\u003C\u002Fp\u003E\u003Ch2\u003E总结\u003C\u002Fh2\u003E\u003Cp data-pid=\"laoc42BR\"\u003E本文我们介绍了cuBLAS的矩阵乘法约定和深度学习中的约定，介绍了矩阵任务向硬件模型划分任务的常用方法，最后通过cute提供的Layout、Tensor，TiledMMA和Copy功能实现了简单的gemm，针对特定的规格进行了性能对比实验，结果显示该简单实现可以达到cuBLAS的60%的效率。后续我们会在该版本基础上进行进一步优化，最终实现SOTA的gemm能力。\u003C\u002Fp\u003E\u003Ch2\u003E参考\u003C\u002Fh2\u003E\u003Cp data-pid=\"S6BGP8GO\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fhistory.siam.org\u002Fpdfs2\u002FDongarra_%2520returned_SIAM_copy.pdf\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ehistory.siam.org\u002Fpdfs2\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003EDongarra_%20returned_SIAM_copy.pdf\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"f8jLMNaR\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fpytorch.org\u002Fdocs\u002Fstable\u002Fgenerated\u002Ftorch.nn.Linear.html\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Epytorch.org\u002Fdocs\u002Fstable\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u002Fgenerated\u002Ftorch.nn.Linear.html\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"dX4vXDyv\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.tensorflow.org\u002Fapi_docs\u002Fpython\u002Ftf\u002Fkeras\u002Flayers\u002FDense\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Etensorflow.org\u002Fapi_docs\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u002Fpython\u002Ftf\u002Fkeras\u002Flayers\u002FDense\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"wzF4d4Ws\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdeveloper.nvidia.com\u002Fcublas\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Edeveloper.nvidia.com\u002Fcu\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eblas\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"d4PcaA_n\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdeveloper.nvidia.com\u002Fblog\u002Fnew-cublas-12-0-features-and-matrix-multiplication-performance-on-nvidia-hopper-gpus\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Edeveloper.nvidia.com\u002Fbl\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eog\u002Fnew-cublas-12-0-features-and-matrix-multiplication-performance-on-nvidia-hopper-gpus\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"5gKRYC8S\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdl.acm.org\u002Fdoi\u002F10.1145\u002F3572848.3577479\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Edl.acm.org\u002Fdoi\u002F10.1145\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E3572848.3577479\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E","contentNeedTruncated":false,"adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19570902","type":"topic","id":"19570902","name":"GPU 通用计算"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19608622","type":"topic","id":"19608622","name":"高性能计算"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19551275","type":"topic","id":"19551275","name":"人工智能"}],"voteupCount":156,"voting":1,"heavyUpStatus":"allow_heavy_up","column":{"description":"","canManage":false,"intro":"高性能计算中CUDA软硬件体系","isFollowing":false,"urlToken":"c_1696937812497235968","id":"c_1696937812497235968","articlesCount":14,"acceptSubmission":false,"title":"CUDA高性能编程","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1696937812497235968","commentPermission":"all","created":1697361502,"updated":1697361502,"imageUrl":"https:\u002F\u002Fpicx.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82.jpg?source=172ae18b","uid":"1064511094718017536","userType":"people","isFollowing":false,"urlToken":"reed-84-49","id":"2600b0313c76a175aa9e09a235382b79","description":"https:\u002F\u002Freed-lau.github.io","name":"reed","isAdvertiser":false,"headline":"从科学计算到高性能计算系统","gender":1,"url":"\u002Fpeople\u002F2600b0313c76a175aa9e09a235382b79","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=172ae18b","isOrg":false,"type":"people","badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""}},"followers":1,"type":"column"},"commentCount":43,"contributions":[{"id":47115832,"state":"accepted","type":"first_publish","column":{"description":"","canManage":false,"intro":"高性能计算中CUDA软硬件体系","isFollowing":false,"urlToken":"c_1696937812497235968","id":"c_1696937812497235968","articlesCount":14,"acceptSubmission":false,"title":"CUDA高性能编程","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1696937812497235968","commentPermission":"all","created":1697361502,"updated":1697361502,"imageUrl":"https:\u002F\u002Fpicx.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82.jpg?source=172ae18b","uid":"1064511094718017536","userType":"people","isFollowing":false,"urlToken":"reed-84-49","id":"2600b0313c76a175aa9e09a235382b79","description":"https:\u002F\u002Freed-lau.github.io","name":"reed","isAdvertiser":false,"headline":"从科学计算到高性能计算系统","gender":1,"url":"\u002Fpeople\u002F2600b0313c76a175aa9e09a235382b79","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=172ae18b","isOrg":false,"type":"people","badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""}},"followers":1,"type":"column"}}],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":false,"tipjarorsCount":0,"isLabeled":true,"hasPublishingDraft":false,"isFavorited":true,"favlistsCount":274,"isNormal":true,"status":0,"activityToppingInfo":{"state":"untopped"},"shareText":"cute 之 简单GEMM实现 - 来自知乎专栏「CUDA高性能编程」，作者: reed https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F667521327 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":17,"hasColumn":true,"republishers":[],"isNewLinkCard":true,"emojiReaction":{"likeCount":17,"likeHasSet":false},"abParam":{"pnNbtoolbar":"0","qaFotoolbar":"1","qaHiddenVoteup":"1","qaNewdownvote":"1","rsInterest1":"","zpZhiStyle":""},"attachedInfo":"kgIkCgkyMzY0NjgyNzcSCTY2NzUyMTMyNxgHIgpJTUFHRV9URVhU","shareGuide":{"hasPositiveBubble":false,"hasTimeBubble":false,"hitShareGuideCluster":false},"settings":{"tableOfContents":{"enabled":true}},"canReference":false,"reactionInstruction":{},"reaction":{"statistics":{"upVoteCount":156,"downVoteCount":3,"likeCount":17,"commentCount":43,"shareCount":0,"playCount":0,"interestPlayCount":0,"favorites":274,"pvCount":0,"bulletCount":0,"applaudCount":0,"questionFollowerCount":0,"questionAnswerCount":0,"plaincontentVoteUpCount":0,"plaincontentLikeCount":0,"imgLikeCount":{"v22d32f6327ef830db3112db2d60789317":0,"v24a3101b8229dff1f06dd26c97bd53bfb":0,"v257e68f14a48698a3f6da8a6c6bac70c9":0,"v2689e4c7afc578c580763b34c7bed1d02":0,"v2Bdb3faaa1c712497cf182aa71945c53d":0}},"relation":{"isAuthor":false,"vote":"UP","liked":false,"imgLiked":{"v22d32f6327ef830db3112db2d60789317":false,"v24a3101b8229dff1f06dd26c97bd53bfb":false,"v257e68f14a48698a3f6da8a6c6bac70c9":false,"v2689e4c7afc578c580763b34c7bed1d02":false,"v2Bdb3faaa1c712497cf182aa71945c53d":false},"faved":true},"imageReactions":{"v22d32f6327ef830db3112db2d60789317":{"likeCount":0,"isLiked":false},"v24a3101b8229dff1f06dd26c97bd53bfb":{"likeCount":0,"isLiked":false},"v257e68f14a48698a3f6da8a6c6bac70c9":{"likeCount":0,"isLiked":false},"v2689e4c7afc578c580763b34c7bed1d02":{"likeCount":0,"isLiked":false},"v2Bdb3faaa1c712497cf182aa71945c53d":{"likeCount":0,"isLiked":false}}},"interactionBarPlugins":[{"type":"comment","comment":{"enable":true,"placeholder":"发条带图评论"}}],"barPluginsFlipTime":3000}},"columns":{"c_1696937812497235968":{"description":"","canManage":false,"intro":"高性能计算中CUDA软硬件体系","isFollowing":false,"urlToken":"c_1696937812497235968","id":"c_1696937812497235968","articlesCount":14,"acceptSubmission":false,"title":"CUDA高性能编程","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1696937812497235968","commentPermission":"all","created":1697361502,"updated":1697361502,"imageUrl":"https:\u002F\u002Fpicx.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82.jpg?source=172ae18b","uid":"1064511094718017536","userType":"people","isFollowing":false,"urlToken":"reed-84-49","id":"2600b0313c76a175aa9e09a235382b79","description":"https:\u002F\u002Freed-lau.github.io","name":"reed","isAdvertiser":false,"headline":"从科学计算到高性能计算系统","gender":1,"url":"\u002Fpeople\u002F2600b0313c76a175aa9e09a235382b79","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-e9c299bcbb6d098601ce529e9a358d82_l.jpg?source=172ae18b","isOrg":false,"type":"people","badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""}},"followers":1,"type":"column"}},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"zvideos":{},"zvideoContributions":{},"eduCourses":{}},"currentUser":"d4901200cbf4b641d3bc073c37356443","account":{"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false},"cardUserInfo":{"vipInfo":{}},"handleWidget":{},"widgetList":[],"userWidgetId":""},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{},"batchUsers":{},"profileInfinity":null},"env":{"abV2":{"config":{"paramMap":{"ws_qiangzhisafe":{"value":"1","abId":"rl-qiangzhisafe_copy-1"},"ws_video_publish":{"value":"1","abId":"rl-video_contentpub-1"},"ws_publish_post":{"value":"1","abId":"rl-publish_article-1"},"ws_is_show":{"value":"0"},"pc_mou_cre_remove":{"value":"1","abId":"rl-mou_create_remove-1"},"ws_must_login":{"value":"0","abId":"must_login-0"},"ws_group":{"value":"0"},"ws_publish_ask":{"value":"1","abId":"rl-pc_publish_ask-1"},"ws_publish_answer":{"value":"1","abId":"rl-pc_pub_answer_2-1"},"ws_platform_new":{"value":"1","abId":"author_platform-1"}},"abMap":{"rl-qiangzhisafe_copy-1":{"abId":"rl-qiangzhisafe_copy-1","layerId":"rl-qiangzhisafe_copy"},"rl-video_contentpub-1":{"abId":"rl-video_contentpub-1","layerId":"rl-video_contentpub","diversionType":2},"rl-publish_article-1":{"abId":"rl-publish_article-1","layerId":"rl-publish_article","diversionType":2},"rl-mou_create_remove-1":{"abId":"rl-mou_create_remove-1","layerId":"rl-mou_create_remove","diversionType":2},"must_login-0":{"abId":"must_login-0","layerId":"web_standard_domain_layer2"},"rl-pc_publish_ask-1":{"abId":"rl-pc_publish_ask-1","layerId":"rl-pc_publish_ask","diversionType":2},"rl-pc_pub_answer_2-1":{"abId":"rl-pc_pub_answer_2-1","layerId":"rl-pc_pub_answer_2","diversionType":2},"author_platform-1":{"abId":"author_platform-1","layerId":"author_platform_layer","diversionType":2}}},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"HarmonyOS":false,"iOS":false,"isAppleDevice":true,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Quark":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F126.0.0.0 Safari\u002F537.36"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F667521327","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F667521327","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"beijing":false,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"oppoSearch":false,"baiduSearch":false,"googleSearch":false,"shenma":false,"miniProgram":false,"xiaomi":false,"huaweiSearch":false},"theme":"light","appHeaderTheme":{"current":"normal","disable":true,"normal":{"bgColor":"GBK99A"},"custom":{"bgColor":"GBK99A"}},"enableShortcut":true,"referer":"","xUDId":"AGAQrYF5yRiPTg-1l2ERiyXvjJVrbIJnf3U=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{"cityName":"广州","countryName":"中国","regionName":"广东","countryCode":"CN"},"logged":true,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0}},"recommend":{"recommendTimes":{}}},"explore":{},"levelUpperLimit":10,"mcn":{},"mcnManage":{},"tasks":{},"announcement":{},"creatorsRecommendInfo":{}},"creators":{"common":{"applyStatus":{},"rightsStatus":{}},"bayesDomains":{"status":{},"options":{"topDomains":null,"allDomains":null,"editable":0},"contents":null},"school":{"tabs":[],"contents":[],"banner":null,"entities":{}},"faq":{"tabs":[],"article":{}},"knowledgeIncome":{},"safeguardRights":{},"analytics":{"all":{},"answer":{},"zvideo":{},"article":{},"pin":{},"singleContent":{}},"account":{"growthLevel":{}},"KMResource":{},"training":{},"ToolsQuestion":{"goodatTopics":[]},"ToolsHotspot":{"domains":[]},"ToolsRecommend":{},"ToolsCustomPromotion":{"itemLists":{},"baseInfo":{}},"ToolsSearchQuestion":{},"editorSetting":{},"MCNManage":{},"knowledgeTasks":{},"incomeAnalysis":{"income":{"aggregation":{}}},"creationManage":{"editModal":{"status":false}},"activity":{},"announcement":{},"home":{"currentCreatorUrlToken":null,"rights":[],"newRights":[],"scoreInfo":{},"menusShowControlByServer":{"bVipRecomend":false,"creationRelationship":false},"newTasks":{"creatorTask":{"tasks":[],"des":[]}},"bannerList":[],"recentlyCreated":[],"homecard":{},"homeData":{}},"videoSupport":{"textBenefit":{}},"videoDistribution":{},"profilePoster":{"creatorPosterConfig":{},"creatorPosterData":{}}},"answers":{"voters":{},"upvoters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"entityWords":{},"paidContent":{},"settings":{},"relationEndorsement":{},"interests":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{},"upvoters":{},"relationEndorsement":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotList":[],"hotListHeadZone":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}},"banner":{},"commercialBanner":{"show":false,"banner":{},"trackData":{}},"video":{"items":[],"next":null,"isLoading":false,"isDrained":false}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"c_1696937812497235968"]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[]},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"columnCollection":{},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0,"infinity":0},"visible":false},"linkCardLimit":0},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"zvideos":{"campaignVideoList":{},"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"qyActivityData":{},"talkActivityData":{},"party2022ActivityData":{},"batchVideos":{},"contribution":{"selectedContribution":null,"campaign":null,"configs":{},"contributionLists":{},"recommendQuestions":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]},"questionSearchResults":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]}},"creationReferences":{},"zvideoCollection":{},"zvideoGrant":{},"collectData":{"isFetching":false,"list":[]},"videoSource":{"isLoaded":false}},"republish":{},"commentPermission":{},"creatorRightStatus":{"list":[]},"adPromotion":{"answer":{},"article":{}}},"fetchHost":"www.zhihu.com","subAppName":"column","spanName":"Post","canaryConfig":{"test_canary":"0","use_new_player":"0","player_vendor":"0","use_hevc":"1","upload_use_signature":"1","use_backdrop_blur":"1","article_title_imagex":"1","play_station":"1","use_cached_supported_countries":"1"}}</script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/vendor.b2043823c211547b094b.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/react.production.min.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/react-dom.production.min.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/react-dom-server.browser.production.min.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/runtime.app.5bd37fc1293b7bf52664.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-75fc9c18.app.3db651c252e14ef6658e.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-29107295.app.42d07f814b7b05187671.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-79b5cf47.app.8b6b6bf4b6d894db9b07.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-330004dc.app.7437cf54ac28fca0e302.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-f3572862.app.d7ec7e2db90ddb91c8f1.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-0e5ce61e.app.b22b78c2be57c983262f.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-83b0f42f.app.e34e650850a4762e3d73.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-38cf5c11.app.0ef475c02226ac0ff291.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-2ec050f6.app.3130baf54e01ef0a8956.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/lib-9b20c40c.app.e400308f4969b7849daf.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/1907.app.d9386c63ba90d5e0d998.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/column.app.b14fe13639a65f8c96c4.js"></script><script defer="" src="./cute 之 简单GEMM实现 - 知乎_files/aria.js" id="ariascripts" wapforceoldfixed="false" loaddata="false"></script><script src="./cute 之 简单GEMM实现 - 知乎_files/hm.js" async=""></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/zap.js"></script><div><div style="display: none;"><i>想来知乎工作？请发送邮件到 jobs@zhihu.com</i></div></div><script src="./cute 之 简单GEMM实现 - 知乎_files/push.js"></script><div><div><div class="css-8pdeid"></div></div></div><script src="./cute 之 简单GEMM实现 - 知乎_files/MathJax.js"></script><script crossorigin="" src="./cute 之 简单GEMM实现 - 知乎_files/emoticon.js"></script><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete7-0" id="Popover6-toggle" aria-haspopup="true" class="Input" placeholder="选择语言" value=""><svg width="24" height="24" viewBox="0 0 24 24" fill="#afbdcf" class="Zi Zi--Select" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #a7baca;"><path fill-rule="evenodd" d="M12.53 3.47a.75.75 0 0 0-1.06 0l-5 5a.75.75 0 0 0 1.06 1.06L12 5.06l4.47 4.47a.75.75 0 1 0 1.06-1.06l-5-5Zm-5 11a.75.75 0 0 0-1.06 1.06l5 5a.75.75 0 0 0 1.06 0l5-5a.75.75 0 1 0-1.06-1.06L12 18.94l-4.47-4.47Z" clip-rule="evenodd"></path></svg></label></div></div></div></div></div><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete9-0" id="Popover8-toggle" aria-haspopup="true" class="Input" placeholder="选择语言" value=""><svg width="24" height="24" viewBox="0 0 24 24" fill="#afbdcf" class="Zi Zi--Select" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #a7baca;"><path fill-rule="evenodd" d="M12.53 3.47a.75.75 0 0 0-1.06 0l-5 5a.75.75 0 0 0 1.06 1.06L12 5.06l4.47 4.47a.75.75 0 1 0 1.06-1.06l-5-5Zm-5 11a.75.75 0 0 0-1.06 1.06l5 5a.75.75 0 0 0 1.06 0l5-5a.75.75 0 1 0-1.06-1.06L12 18.94l-4.47-4.47Z" clip-rule="evenodd"></path></svg></label></div></div></div></div></div></body></html>